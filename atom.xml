<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jonty&#39;s Blog</title>
  
  <subtitle>记录搬砖生活</subtitle>
  <link href="https://jonty.top/atom.xml" rel="self"/>
  
  <link href="https://jonty.top/"/>
  <updated>2023-10-16T02:02:27.352Z</updated>
  <id>https://jonty.top/</id>
  
  <author>
    <name>JontyWang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【分享】IP 基础知识“全家桶”</title>
    <link href="https://jonty.top/2023/08/27/about-of-IP/"/>
    <id>https://jonty.top/2023/08/27/about-of-IP/</id>
    <published>2023-08-27T01:58:00.000Z</published>
    <updated>2023-10-16T02:02:27.352Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>以下文章来源于小林coding ，作者小林coding</p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前段时间，有读者希望我写一篇关于 IP 分类地址、子网划分等的文章，他反馈常常混淆，摸不着头脑。</p><p>那么，说来就来！而且要盘就盘全一点，顺便挑战下小林的图解功力，所以就来个 <strong>IP 基础知识全家桶</strong>。</p><p>吃完这个 IP 基础知识全家桶全家桶，包你撑着肚子喊出：“<strong>真香！</strong>”</p><p>不多说，直接上菜，共分为<strong>三道菜</strong>：</p><ul><li>首先是前菜 「 IP 基本认识 」</li><li>其次是主菜 「IP 地址的基础知识」</li><li>最后是点心 「IP 协议相关技术」</li></ul><p><img data-src="https://cdn.jonty.top/img/%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="IP基础知识全家桶"></p><hr><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="前菜-——-IP-基本认识"><a href="#前菜-——-IP-基本认识" class="headerlink" title="前菜 —— IP 基本认识"></a>前菜 —— IP 基本认识</h3><p>IP 在 TCP/IP 参考模型中处于第三层，也就是<strong>网络层</strong>。</p><p>网络层的主要作用是：<strong>实现主机与主机之间的通信，也叫点对点（end to end）通信。</strong></p><p><img data-src="https://cdn.jonty.top/img/640.png" alt="IP的作用"></p><blockquote><p>网络层与数据链路层有什么关系呢？</p></blockquote><p>有的小伙伴分不清 IP（网络层） 和 MAC （数据链路层）之间的区别和关系。</p><p>其实很容易区分，在上面我们知道 IP 的作用是主机之间通信中的，而 <strong>MAC 的作用则是实现「直连」的两个设备之间通信，而 IP 则负责在「没有直连」的两个网络之间进行通信传输。</strong></p><p>举个生活的栗子，小林要去一个很远的地方旅行，制定了一个行程表，其间需先后乘坐飞机、地铁、公交车才能抵达目的地，为此小林需要买飞机票，地铁票等。</p><p>飞机票和地铁票都是去往特定的地点的，每张票只能够在某一限定区间内移动，此处的「区间内」就如同通信网络中数据链路。</p><p>在区间内移动相当于数据链路层，充当区间内两个节点传输的功能，区间内的出发点好比源 MAC 地址，目标地点好比目的 MAC 地址。</p><p>整个旅游行程表就相当于网络层，充当远程定位的功能，行程的开始好比源 IP，行程的终点好比目的 IP 地址。</p><p><img data-src="https://cdn.jonty.top/img/202308272207889.png" alt="IP 的作用与 MAC 的作用"></p><p>如果小林只有行程表而没有车票，就无法搭乘交通工具到达目的地。相反，如果除了车票而没有行程表，恐怕也很难到达目的地。因为小林不知道该坐什么车，也不知道该在哪里换乘。</p><p>因此，只有两者兼备，既有某个区间的车票又有整个旅行的行程表，才能保证到达目的地。与此类似，<strong>计算机网络中也需要「数据链路层」和「网络层」这个分层才能实现向最终目标地址的通信。</strong></p><p>还有重要一点，旅行途中我们虽然不断变化了交通工具，但是旅行行程的起始地址和目的地址始终都没变。其实，在网络中数据包传输中也是如此，<strong>源IP地址和目标IP地址在传输过程中是不会变化的，只有源 MAC 地址和目标 MAC 一直在变化。</strong></p><hr><h3 id="主菜-——-IP-地址的基础知识"><a href="#主菜-——-IP-地址的基础知识" class="headerlink" title="主菜 —— IP 地址的基础知识"></a>主菜 —— IP 地址的基础知识</h3><p>在 TCP/IP 网络通信时，为了保证能正常通信，每个设备都需要配置正确的 IP 地址，否则无法实现正常的通信。</p><p>IP 地址（IPv4 地址）由 <code>32</code> 位正整数来表示，IP 地址在计算机是以二进制的方式处理的。</p><p>而人类为了方便记忆采用了<strong>点分十进制</strong>的标记方式，也就是将 32 位 IP 地址以每 8 位为组，共分为 <code>4</code> 组，每组以「<code>.</code>」隔开，再将每组转换成十进制。</p><p><img data-src="https://cdn.jonty.top/img/202308272208690.png" alt="点分十进制"></p><p>那么，IP 地址最大值也就是</p><p><img data-src="https://cdn.jonty.top/img/202308272209488.png"></p><p>也就说，最大允许 43 亿台计算机连接到网络。</p><p>实际上，IP 地址并不是根据主机台数来配置的，而是以网卡。像服务器、路由器等设备都是有 2 个以上的网卡，也就是它们会有 2 个以上的 IP 地址。</p><p><img data-src="https://cdn.jonty.top/img/202309071006166.png" alt="每块网卡可以分配一个以上的IP地址"></p><p>因此，让 43 亿台计算机全部连网其实是不可能的，更何况 IP 地址是由「网络标识」和「主机标识」这两个部分组成的，所以实际能够连接到网络的计算机个数更是少了很多。</p><blockquote><p>可能有的小伙伴提出了疑问，现在不仅电脑配了 IP， 手机、IPad 等电子设备都配了 IP 呀，照理来说肯定会超过 43 亿啦，那是怎么能够支持这么多 IP 的呢？</p></blockquote><p>因为会根据一种可以更换 IP 地址的技术 <code>NAT</code>，使得可连接计算机数超过 43 亿台。<code>NAT</code> 技术后续会进一步讨论和说明。</p><h4 id="IP-地址的分类"><a href="#IP-地址的分类" class="headerlink" title="IP 地址的分类"></a>IP 地址的分类</h4><p>互联网诞生之初，IP 地址显得很充裕，于是计算机科学家们设计了<strong>分类地址</strong>。</p><p>IP 地址分类成了 5 种类型，分别是 A 类、B 类、C 类、D 类、E 类。</p><p><img data-src="https://cdn.jonty.top/img/202309071006808.png" alt="IP 地址分类"></p><p>上图中黄色部是分类号，用以区分 IP 地址类别。</p><blockquote><p>什么是 A、B、C 类地址？</p></blockquote><p>其中对于 A、B、C 类主要分为两个部分，分别是<strong>网络号和主机号</strong>。这很好理解，好比小林是 A 小区 1 栋 101 号，你是 B 小区 1 栋 101 号。</p><p>我们可以用下面这个表格， 就能很清楚的知道 A、B、C 分类对应的地址范围、最大主机个数。</p><p><img data-src="https://cdn.jonty.top/img/202309071006375.png" alt="A、B、C 分类地址"></p><blockquote><p>A、B、C 分类地址最大主机个数是如何计算的呢？</p></blockquote><p>最大主机个数，就是要看主机号的位数，如 C 类地址的主机号占 8 位，那么 C 类地址的最大主机个数：</p><p><img data-src="https://cdn.jonty.top/img/202309071007734.png"></p><p>为什么要减 2 呢？</p><p>因为在 IP 地址中，有两个 IP 是特殊的，分别是主机号全为 1 和 全为 0 地址。</p><p><img data-src="https://cdn.jonty.top/img/202309071007166.png"></p><ul><li>主机号全为 1 指定某个网络下的所有主机，用于广播</li><li>主机号全为 0 指定某个网络</li></ul><p>因此，在分配过程中，应该去掉这两种情况。</p><blockquote><p>广播地址用于什么？</p></blockquote><p>广播地址用于在<strong>同一个链路中相互连接的主机之间发送数据包</strong>。</p><p>学校班级中就有广播的例子，在准备上课的时候，通常班长会喊：“上课， 全体起立！”，班里的同学听到这句话是不是全部都站起来了？这个句话就有广播的含义。</p><p>当主机号全为 1 时，就表示该网络的广播地址。例如把 <code>172.20.0.0/16</code> 用二进制表示如下：</p><p>10101100.00010100.00000000.00000000</p><p>将这个地址的<strong>主机部分全部改为 1</strong>，则形成广播地址：</p><p>10101100.00010100.<strong>11111111.11111111</strong></p><p>再将这个地址用十进制表示，则为 <code>172.20.255.255</code>。</p><p>广播地址可以分为本地广播和直接广播两种。</p><ul><li><strong>在本网络内广播的叫做本地广播</strong>。例如网络地址为 192.168.0.0/24 的情况下，广播地址是 192.168.0.255 。因为这个广播地址的 IP 包会被路由器屏蔽，所以不会到达 192.168.0.0/24 以外的其他链路上。</li><li><strong>在不同网络之间的广播叫做直接广播</strong>。例如网络地址为 192.168.0.0/24 的主机向 192.168.1.255/24 的目标地址发送 IP 包。收到这个包的路由器，将数据转发给192.168.1.0/24，从而使得所有 192.168.1.1~192.168.1.254 的主机都能收到这个包（由于直接广播有一定的安全问题，多数情况下会在路由器上设置为不转发）。</li></ul><p><img data-src="https://cdn.jonty.top/img/202309071007094.jpg" alt="本地广播与直接广播"></p><blockquote><p>什么是 D、E 类地址？</p></blockquote><p>而 D 类和 E 类地址是没有主机号的，所以不可用于主机 IP，D 类常被用于<strong>多播</strong>，E 类是预留的分类，暂时未使用。</p><p><img data-src="https://cdn.jonty.top/img/202309071007132.png" alt="D、E 分类地址"></p><blockquote><p>多播地址用于什么？</p></blockquote><p>多播用于<strong>将包发送给特定组内的所有主机。</strong></p><p>还是举班级的栗子，老师说：“最后一排的同学，上来做这道数学题。”，老师是指定的是最后一排的同学，也就是多播的含义了。</p><p>由于广播无法穿透路由，若想给其他网段发送同样的包，就可以使用可以穿透路由的多播（组播）。</p><p><img data-src="https://cdn.jonty.top/img/202309071008044.png" alt="单播、广播、多播通信"></p><p>多播使用的 D 类地址，其前四位是 <code>1110</code> 就表示是多播地址，而剩下的 28 位是多播的组编号。</p><p>从 224.0.0.0 ~ 239.255.255.255 都是多播的可用范围，其划分为以下三类：</p><ul><li>224.0.0.0 ~ 224.0.0.255 为预留的组播地址，只能局域网中，路由器是不会进行转发的</li><li>224.0.1.0 ~ 238.255.255.255  为用户可用的组播地址，可以用于 Internet 上</li><li>239.0.0.0 ~ 239.255.255.255 为本地管理组播地址，可供内部网在内部使用，仅在特定的本地范围内有效</li></ul><blockquote><p>IP 分类的优点</p></blockquote><p>不管是路由器还是主机解析到一个 IP 地址时候，我们判断其 IP 地址的首位是否为 0，为 0 则为 A 类地址，那么就能很快的找出网络地址和主机地址。</p><p>其余分类判断方式参考如下图：</p><p><img data-src="https://cdn.jonty.top/img/202309071009420.png" alt="IP 分类判断"></p><p>所以，这种分类地址的优点就是<strong>简单明了、选路（基于网络地址）简单</strong>。</p><blockquote><p>IP 分类的缺点</p></blockquote><p><em>缺点一</em></p><p><strong>同一网络下没有地址层次</strong>，比如一个公司里用了 B 类地址，但是可能需要根据生产环境、测试环境、开发环境来划分地址层次，而这种 IP 分类是没有地址层次划分的功能，所以这就<strong>缺少地址的灵活性</strong>。</p><p><em>缺点二</em></p><p>A、B、C类有个尴尬处境，就是<strong>不能很好的与现实网络匹配</strong>。</p><ul><li>C 类地址能包含的最大主机数量实在太少了，只有 254 个，估计一个网吧都不够用。</li><li>而 B 类地址能包含的最大主机数量又太多了，6 万多台机器放在一个网络下面，一般的企业基本达不到这个规模，闲着的地址就是浪费。</li></ul><p>这两个缺点，都可以在 <code>CIDR</code> 无分类地址解决。</p><h4 id="无分类地址-CIDR"><a href="#无分类地址-CIDR" class="headerlink" title="无分类地址 CIDR"></a>无分类地址 CIDR</h4><p>正因为 IP 分类存在许多缺点，所有后面提出了无分类地址的方案，即 <code>CIDR</code>。</p><p>这种方式不再有分类地址的概念，32 比特的 IP 地址被划分为两部分，前面是<strong>网络号</strong>，后面是<strong>主机号</strong>。</p><blockquote><p>怎么划分网络号和主机号的呢？</p></blockquote><p>表示形式 <code>a.b.c.d/x</code>，其中 <code>/x</code> 表示前 x 位属于<strong>网络号</strong>， x 的范围是 <code>0 ~ 32</code>，这就使得 IP 地址更加具有灵活性。</p><p>比如 10.100.122.2/24，这种地址表示形式就是 CIDR，<code>/24</code> 表示前 24 位是网络号，剩余的 8 位是主机号。</p><p><img data-src="https://cdn.jonty.top/img/202309071010223.png"></p><p>还有另一种划分网络号与主机号形式，那就是<strong>子网掩码</strong>，掩码的意思就是掩盖掉主机号，剩余的就是网络号。</p><p><strong>将子网掩码和 IP 地址按位计算 AND，就可得到网络号。</strong></p><p><img data-src="https://cdn.jonty.top/img/202309071010949.png"></p><blockquote><p>为什么要分离网络号和主机号？</p></blockquote><p>因为两台计算机要通讯，首先要判断是否处于同一个广播域内，即网络地址是否相同。如果网络地址相同，表明接受方在本网络上，那么可以把数据包直接发送到目标主机，</p><p>路由器寻址工作中，也就是通过这样的方式来找到对应的网络号的，进而把数据包转发给对应的网络内。</p><p><img data-src="https://cdn.jonty.top/img/202309071017210.png" alt="IP地址的网络号"></p><blockquote><p>怎么进行子网划分？</p></blockquote><p>在上面我们知道可以通过子网掩码划分出网络号和主机号，那实际上子网掩码还有一个作用，那就是<strong>划分子网</strong>。</p><p><strong>子网划分实际上是将主机地址分为两个部分：子网网络地址和子网主机地址</strong>。形式如下：</p><p><img data-src="https://cdn.jonty.top/img/202309071010496.png" alt=" "></p><ul><li>未做子网划分的 ip 地址：网络地址＋主机地址</li><li>做子网划分后的 ip 地址：网络地址＋（子网网络地址＋子网主机地址）</li></ul><p>假设对 C 类地址进行子网划分，网络地址 192.168.1.0，使用子网掩码 255.255.255.192 对其进行子网划分。</p><p>C 类地址中前 24 位 是网络号，最后 8 位是主机号，根据子网掩码可知<strong>从 8 位主机号中借用 2 位作为子网号</strong>。</p><p><img data-src="https://cdn.jonty.top/img/202309071010498.png" alt=" "></p><p>由于子网网络地址被划分成 2 位，那么子网地址就有 4 个，分别是 00、01、10、11，具体划分如下图：</p><p><img data-src="https://cdn.jonty.top/img/202309071017676.png"></p><p>划分后的 4 个子网如下表格：</p><p><img data-src="https://cdn.jonty.top/img/202309071018562.png"></p><h4 id="公有-IP-地址与私有-IP-地址"><a href="#公有-IP-地址与私有-IP-地址" class="headerlink" title="公有 IP 地址与私有 IP 地址"></a>公有 IP 地址与私有 IP 地址</h4><p>在 A、B、C 分类地址，实际上有分公有 IP 地址和 私有 IP 地址。</p><p><img data-src="https://cdn.jonty.top/img/202309071018330.png"></p><p>平时我们办公室、家里、学校用的 IP 地址，一般都是私有 IP 地址。因为这些地址允许组织内部的 IT 人员自己管理、自己分配，而且可以重复。因此，你学校的某个私有 IP 地址和我学校的可以是一样的。</p><p>就像每个小区都有自己的楼编号和门牌号，你小区家可以叫  1 栋 101 号，我小区家也可以叫 1 栋 101，没有任何问题。但一旦出了小区，就需要带上中山路 666 号（公网 IP 地址），是国家统一分配的，不能两个小区都叫中山路 666。</p><p>所以，公有 IP 地址是有个组织统一分配的，假设你要开一个博客网站，那么你就需要去申请购买一个公有 IP，这样全世界的人才能访问。并且公有 IP 地址基本上要在整个互联网范围内保持唯一。</p><p><img data-src="https://cdn.jonty.top/img/202309071018546.png" alt="公有 IP 地址与私有 IP 地址"></p><blockquote><p>公有 IP 地址由谁管理呢？</p></blockquote><p>私有 IP 地址通常是内部的 IT 人员值管理，公有 IP 地址是由 <code>ICANN</code> 组织管理，中文叫「互联网名称与数字地址分配机构」。</p><p>IANA 是 ICANN 的其中一个机构，它负责分配互联网 IP 地址，是按州的方式层层分配。</p><p><img data-src="https://cdn.jonty.top/img/202309071018715.png"></p><ul><li>ARIN 北美地区</li><li>LACNIC 拉丁美洲和一些加勒比群岛</li><li>RIPE NCC 欧洲、中东和中亚</li><li>AfriNIC 非洲地区</li><li>APNIC 亚太地区</li></ul><p>其中，在中国是由 CNNIC 的机构进行管理，它是中国国内唯一指定的全局 IP 地址管理的组织。</p><h4 id="IP-地址与路由控制"><a href="#IP-地址与路由控制" class="headerlink" title="IP 地址与路由控制"></a>IP 地址与路由控制</h4><p>IP地址的<strong>网络地址</strong>这一部分是用于进行路由控制。</p><p>路由控制表中记录着网络地址与下一步应该发送至路由器的地址，在主机和路由器上都会有各自的路由器控制表。</p><p>在发送 IP 包时，首先要确定 IP 包首部中的目标地址，再从路由控制表中找到与该地址具有<strong>相同网络地址</strong>的记录，根据该记录将 IP 包转发给相应的下一个路由器。如果路由控制表中存在多条相同网络地址的记录，就选择相同位数最多的网络地址，也就是最长匹配。</p><p>下面以下图的网络链路作为例子说明：</p><p><img data-src="https://cdn.jonty.top/img/202309071018655.png" alt="IP 地址与路由控制"></p><ol><li>主机 A 要发送一个 IP 包，其源地址是 <code>10.1.1.30</code> 和目标地址是 <code>10.1.2.10</code>，由于没有在主机 A 的路由表找到与目标地址 <code>10.1.2.10</code> 的网络地址，于是把包被转发到默认路由（路由器 <code>1</code> ）</li><li>路由器 <code>1</code> 收到 IP 包后，也在路由器 <code>1</code> 的路由表匹配与目标地址相同的网络地址记录，发现匹配到了，于是就把 IP 数据包转发到了 <code>10.1.0.2</code> 这台路由器 <code>2</code></li><li>路由器 <code>2</code> 收到后，同样对比自身的路由表，发现匹配到了，于是把 IP 包从路由器 <code>2</code> 的 <code>10.1.2.1</code> 这个接口出去，最终经过交换机把 IP 数据包转发到了目标主机</li></ol><blockquote><p>环回地址是不会流向网络</p></blockquote><p>环回地址是在同一台计算机上的程序之间进行网络通信时所使用的一个默认地址。</p><p>计算机使用一个特殊的 IP 地址 <strong>127.0.0.1 作为环回地址，</strong>与该地址具有相同意义的是一个叫做 <code>localhost</code> 的主机名。</p><p>使用这个 IP 或主机名时，数据包不会流向网络。</p><h4 id="IP-分片与重组"><a href="#IP-分片与重组" class="headerlink" title="IP 分片与重组"></a>IP 分片与重组</h4><p>每种数据链路的最大传输单元 <code>MTU</code> 都是不相同的，如 FDDI 数据链路 MTU 4352、以太网的 MTU 是 1500 字节等。</p><p>每种数据链路的 MTU 之所以不同，是因为每个不同类型的数据链路的使用目的不同。使用目的不同，可承载的 MTU 也就不同。</p><p>其中，我们最常见数据链路是以太网，它的 MTU 是 <code>1500</code> 字节。</p><p>那么当 IP 数据包大小大于 MTU 时， IP 数据包就会被分片。</p><p>经过分片之后的 IP 数据报在被重组的时候，只能由目标主机进行，路由器是不会进行重组的。</p><p>假设发送方发送一个 4000 字节的大数据报，若要传输在以太网链路，则需要把数据报分片成 3 个小数据报进行传输，再交由接收方重组成大数据报。</p><p><img data-src="https://cdn.jonty.top/img/202309071018909.png" alt="分片与重组"></p><p>在分片传输中，一旦某个分片丢失，则会造成整个 IP 数据报作废，所以 TCP 引入了 <code>MSS</code> 也就是在 TCP 层进行分片不由 IP 层分片，那么对于 UDP 我们尽量不要发送一个大于 <code>MTU</code> 的数据报文。</p><h4 id="IPv6-基本认识"><a href="#IPv6-基本认识" class="headerlink" title="IPv6 基本认识"></a>IPv6 基本认识</h4><p>IPv4 的地址是 32 位的，大约可以提供 42 亿个地址，但是早在 2011 年 IPv4 地址就已经被分配完了。</p><p>但是 IPv6 的地址是 <code>128</code> 位的，这可分配的地址数量是大的惊人，说个段子 <strong>IPv6 可以保证地球上的每粒沙子都能被分配到一个 IP 地址。</strong></p><p>但 IPv6 除了有更多的地址之外，还有更好的安全性和扩展性，说简单点就是 IPv6 相比于 IPv4 能带来更好的网络体验。</p><p>但是因为 IPv4 和 IPv6 不能相互兼容，所以不但要我们电脑、手机之类的设备支持，还需要网络运营商对现有的设备进行升级，所以这可能是 IPv6 普及率比较慢的一个原因。</p><blockquote><p>IPv6 的亮点</p></blockquote><p>IPv6 不仅仅只是可分配的地址变多了，他还有非常多的亮点。</p><ul><li>IPv6 可自动配置，即使没有 DHCP 服务器也可以实现自动分配IP地址，真是<strong>便捷到即插即用</strong>啊。</li><li>IPv6 包头包首部长度采用固定的值 <code>40</code> 字节，去掉了包头校验和，简化了首部结构，减轻了路由器负荷，大大<strong>提高了传输的性能</strong>。</li><li>IPv6 有应对伪造 IP 地址的网络安全功能以及防止线路窃听的功能，大大<strong>提升了安全性</strong>。</li><li><strong>…</strong> （由你发现更多的亮点）</li></ul><blockquote><p>IPv6 地址的标识方法</p></blockquote><p>IPv4 地址长度共 32 位，是以每 8 位作为一组，并用点分十进制的表示方式。</p><p>IPv6 地址长度是 128 位，是以每 16 位作为一组，每组用冒号 「:」 隔开。</p><p><img data-src="https://cdn.jonty.top/img/202309071019953.png" alt="IPv6 地址表示方法"></p><p>如果出现连续的 0 时还可以将这些 0 省略，并用两个冒号 「::」隔开。但是，一个 IP 地址中只允许出现一次两个连续的冒号。</p><p><img data-src="https://cdn.jonty.top/img/202309071019678.png" alt="Pv6 地址缺省表示方"></p><blockquote><p>IPv6 地址的结构</p></blockquote><p>IPv6 类似 IPv4，也是通过 IP 地址的前几位标识 IP 地址的种类。</p><p>IPv6 的地址主要有一下类型地址：</p><ul><li>单播地址，用于一对一的通信</li><li>组播地址，用于一对多的通信</li><li>任播地址，用于通信最近的节点，最近的节点是由路由协议决定</li><li>没有广播地址</li></ul><p><img data-src="https://cdn.jonty.top/img/202309071020170.png" alt="IPv6地址结构"></p><blockquote><p>IPv6 单播地址类型</p></blockquote><p>对于一对一通信的 IPv6 地址，主要划分了三类单播地址，每类地址的有效范围都不同。</p><ul><li>在同一链路单播通信，不经过路由器，可以使用<strong>链路本地单播地址</strong>，IPv4 没有此类型</li><li>在内网里单播通信，可以使用<strong>唯一本地地址</strong>，相当于 IPv4 的私有 IP</li><li>在互联网通信，可以使用<strong>全局单播地址</strong>，相当于 IPv4 的公有 IP</li></ul><p><img data-src="https://cdn.jonty.top/img/202309071020294.png" alt="IPv6 中的单播通信"></p><h4 id="IPv4-首部与-IPv6-首部"><a href="#IPv4-首部与-IPv6-首部" class="headerlink" title="IPv4 首部与 IPv6 首部"></a>IPv4 首部与 IPv6 首部</h4><p>IPv4 首部与 IPv6 首部的差异如下图：</p><p><img data-src="https://cdn.jonty.top/img/202309071021885.png" alt="IPv4 首部与 IPv6 首部的差异"></p><p>IPv6 相比 IPv4 的首部改进：</p><ul><li><strong>取消了首部校验和字段。</strong> 因为在数据链路层和传输层都会校验，因此 IPv6 直接取消了 IP 的校验。</li><li><strong>取消了分片/重新组装相关字段。</strong> 分片与重组是耗时的过程，IPv6 不允许在中间路由器进行分片与重组，这种操作只能在源与目标主机，这将大大提高了路由器转发的速度。</li><li><strong>取消选项字段。</strong> 选项字段不再是标准 IP 首部的一部分了，但它并没有消失，而是可能出现在 IPv6 首部中的「下一个首部」指出的位置上。删除该选项字段是的 IPv6 的首部成为固定长度的 <code>40</code> 字节。</li></ul><hr><h3 id="点心-——-IP-协议相关技术"><a href="#点心-——-IP-协议相关技术" class="headerlink" title="点心 —— IP 协议相关技术"></a>点心 —— IP 协议相关技术</h3><p>跟 IP 协议相关的技术也不少，接下来说说与 IP 协议相关的重要且常见的技术。</p><ul><li>DNS 域名解析</li><li>ARP 与 RARP 协议</li><li>DHCP 动态获取 IP 地址</li><li>NAT 网络地址转换</li><li>ICMP 互联网控制报文协议</li><li>IGMP 因特网组管理协</li></ul><h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>我们在上网的时候，通常使用的方式域名，而不是 IP 地址，因为域名方便人类记忆。</p><p>那么实现这一技术的就是 <strong>DNS 域名解析</strong>，DNS 可以将域名网址自动转换为具体的 IP 地址。</p><blockquote><p>域名的层级关系</p></blockquote><p>DNS 中的域名都是用<strong>句点</strong>来分隔的，比如 <code>www.server.com</code>，这里的句点代表了不同层次之间的<strong>界限</strong>。</p><p>在域名中，<strong>越靠右</strong>的位置表示其层级<strong>越高</strong>。</p><p>毕竟域名是外国人发明，所以思维和中国人相反，比如说一个城市地点的时候，外国喜欢从小到大的方式顺序说起（如 XX 街道 XX 区 XX 市 XX 省），而中国则喜欢从大到小的顺序（如 XX 省 XX 市 XX 区 XX 街道）。</p><p>根域是在最顶层，它的下一层就是 com 顶级域，再下面是 server.com。</p><p>所以域名的层级关系类似一个树状结构：</p><ul><li>根 DNS 服务器</li><li>顶级域 DNS 服务器（com）</li><li>权威 DNS 服务器（server.com）</li></ul><p><img data-src="https://cdn.jonty.top/img/202309071021280.png" alt="DNS 树状结构"></p><p>根域的 DNS 服务器信息保存在互联网中所有的 DNS 服务器中。这样一来，任何 DNS 服务器就都可以找到并访问根域 DNS 服务器了。</p><p>因此，客户端只要能够找到任意一台 DNS 服务器，就可以通过它找到根域 DNS 服务器，然后再一路顺藤摸瓜找到位于下层的某台目标 DNS 服务器。</p><blockquote><p>域名解析的工作流程</p></blockquote><p>浏览器首先看一下自己的缓存里有没有，如果没有就向操作系统的缓存要，还没有就检查本机域名解析文件 <code>hosts</code>，如果还是没有，就会 DNS 服务器进行查询，查询的过程如下：</p><ol><li>客户端首先会发出一个 DNS 请求，问 <a href="http://www.server.com/">www.server.com</a> 的 IP 是啥，并发给本地 DNS 服务器（也就是客户端的 TCP/IP 设置中填写的 DNS 服务器地址）。</li><li>本地域名服务器收到客户端的请求后，如果缓存里的表格能找到 <a href="http://www.server.com,则它直接返回/">www.server.com，则它直接返回</a> IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“老大， 能告诉我 <a href="http://www.server.com/">www.server.com</a> 的 IP 地址吗？” 根域名服务器是最高层次的，它不直接用于域名解析，但能指明一条道路。</li><li>根 DNS 收到来自本地 DNS 的请求后，发现后置是 .com，说：“<a href="http://www.server.com/">www.server.com</a> 这个域名归 .com 区域管理”，我给你 .com 顶级域名服务器地址给你，你去问问它吧。”</li><li>本地 DNS 收到顶级域名服务器的地址后，发起请求问“老二， 你能告诉我 <a href="http://www.server.com/">www.server.com</a>  的 IP 地址吗？”</li><li>顶级域名服务器说：“我给你负责 <a href="http://www.server.com/">www.server.com</a> 区域的权威 DNS 服务器的地址，你去问它应该能问到”。</li><li>本地 DNS 于是转向问权威 DNS 服务器：“老三，<a href="http://www.server.com对应的IP是啥呀？”">www.server.com对应的IP是啥呀？”</a> server.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。</li><li>权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。</li><li>本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。</li></ol><p>至此，我们完成了 DNS 的解析过程。现在总结一下，整个过程我画成了一个图。</p><p><img data-src="https://cdn.jonty.top/img/202309071021815.png" alt="域名解析的工作流程"></p><p>DNS 域名解析的过程蛮有意思的，整个过程就和我们日常生活中找人问路的过程类似，<strong>只指路不带路</strong>。</p><h4 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h4><p>在传输一个 IP 数据报的时候，确定了源 IP 地址和目标 IP 地址后，就会通过主机「路由表」确定 IP 数据包下一跳。然而，网络层的下一层是数据链路层，所以我们还要知道「下一跳」的 MAC 地址。</p><p>由于主机的路由表中可以找到下一条的 IP 地址，所以可以通过 <strong>ARP 协议</strong>，求得下一跳的 MAC 地址。</p><blockquote><p>那么 ARP 又是如何知道对方 MAC 地址的呢？</p></blockquote><p>简单地说，ARP 是借助 <strong>ARP 请求与 ARP 响应</strong>两种类型的包确定 MAC 地址的。</p><p><img data-src="https://cdn.jonty.top/img/202309071021309.png" alt="ARP 广播"></p><ul><li>主机会通过<strong>广播发送 ARP 请求</strong>，这个包中包含了想要知道的 MAC 地址的主机 IP 地址。</li><li>当同个链路中的所有设备收到 ARP 请求时，会去拆开 ARP 请求包里的内容，如果 ARP 请求包中的目标 IP 地址与自己的 IP 地址一致，那么这个设备就将自己的 MAC 地址塞入 <strong>ARP 响应包</strong>返回给主机。</li></ul><p>操作系统通常会把第一次通过 ARP 获取的 MAC 地址缓存起来，以便下次直接从缓存中找到对应 IP 地址的 MAC 地址。</p><p>不过，MAC 地址的缓存是有一定期限的，超过这个期限，缓存的内容将被清除。</p><blockquote><p>RARP 协议你知道是什么吗？</p></blockquote><p>ARP 协议是已知 IP 地址 求 MAC 地址，那 RARP 协议正好相反。</p><p>它是<strong>已知 MAC 地址求 IP 地址</strong>。例如将打印机服务器等小型嵌入式设备接入到网络时就经常会用得到。</p><p>通常这需要架设一台 <code>RARP</code> 服务器，在这个服务器上注册设备的 MAC 地址及其 IP 地址。然后再将这个设备接入到网络，接着：</p><ul><li>该设备会发送一条「我的 MAC 地址是XXXX，请告诉我，我的IP地址应该是什么」的请求信息。</li><li>RARP 服务器接到这个消息后返回「MAC地址为 XXXX 的设备，IP地址为 XXXX」的信息给这个设备。</li></ul><p>最后，设备就根据从 RARP 服务器所收到的应答信息设置自己的 IP 地址。</p><p><img data-src="https://cdn.jonty.top/img/202309071022117.png" alt="RARP"></p><h4 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h4><p>DHCP 在生活中我们是很常见的了，我们的电脑通常都是通过 DHCP 动态获取 IP 地址，大大省去了配 IP 信息繁琐的过程。</p><p>接下来，我们来看看我们的电脑是如何通过 4 个步骤的过程，获取到 IP 的。</p><p><img data-src="https://cdn.jonty.top/img/202309071022333.png" alt="DHCP 工作流程"></p><p>先说明一点，DHCP 客户端进程监听的是 68 端口号，DHCP 服务端进程监听的是 67 端口号。</p><p>DHCP 交互的 4 个步骤：</p><ul><li>客户端首先发起 <strong>DHCP 发现报文（DHCP DISCOVER）</strong> 的 IP 数据报，由于客户端没有 IP 地址，也不知道 DHCP 服务器的地址，所以使用的是 UDP <strong>广播</strong>通信，其使用的广播目的地址是 255.255.255.255（端口 67） 并且使用 0.0.0.0（端口 68） 作为源 IP 地址。DHCP 客户端将该 IP 数据报传递给链路层，链路层然后将帧广播到所有的网络中设备。</li><li>DHCP 服务器收到 DHCP 发现报文时，用 <strong>DHCP 提供报文（DHCP OFFER）</strong> 向客户端做出响应。该报文仍然使用 IP 广播地址 255.255.255.255，该报文信息携带服务器提供可租约的 IP 地址、子网掩码、默认网关、DNS 服务器以及 <strong>IP 地址租用期</strong>。</li><li>客户端收到一个或多个服务器的 DHCP 提供报文后，从中选择一个服务器，并向选中的服务器发送 <strong>DHCP 请求报文（DHCP REQUEST</strong>进行响应，回显配置的参数。</li><li>最后，服务端用 <strong>DHCP ACK 报文</strong>对 DHCP 请求报文进行响应，应答所要求的参数。</li></ul><p>一旦客户端收到 DHCP ACK 后，交互便完成了，并且客户端能够在租用期内使用 DHCP 服务器分配的 IP 地址。</p><p>如果租约的 DHCP IP 地址快期后，客户端会向服务器发送 DHCP 请求报文：</p><ul><li>服务器如果同意继续租用，则用 DHCP ACK 报文进行应答，客户端就会延长租期。</li><li>服务器如果不同意继续租用，则用 DHCP NACK 报文，客户端就要停止使用租约的 IP 地址。</li></ul><p>可以发现，DHCP 交互中，<strong>全程都是使用 UDP 广播通信</strong>。</p><blockquote><p>咦，用的是广播，那如果 DHCP 服务器和客户端不是在同一个局域网内，路由器又不会转发广播包，那不是每个网络都要配一个 DHCP 服务器？</p></blockquote><p>所以，为了解决这一问题，就出现了 <strong>DHCP 中继代理</strong>。</p><p>有了 DHCP 中继代理以后，<strong>对不同网段的 IP 地址分配也可以由一个 DHCP 服务器统一进行管理。</strong></p><p><img data-src="https://cdn.jonty.top/img/202309071022612.png" alt="DHCP 中继代理"></p><ul><li>DHCP 客户端会向 DHCP 中继代理发送 DHCP 请求包，而 DHCP 中继代理在收到这个广播包以后，再以<strong>单播</strong>的形式发给 DHCP 服务器。</li><li>服务器端收到该包以后再向 DHCP 中继代理返回应答，并由 DHCP 中继代理将此包转发给 DHCP 客户端 。</li></ul><p>因此，DHCP 服务器即使不在同一个链路上也可以实现统一分配和管理IP地址。</p><h4 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h4><p>IPv4 的地址是非常紧缺的，在前面我们也提到可以通过无分类地址来减缓 IPv4 地址耗尽的速度，但是互联网的用户增速是非常惊人的，所以 IPv4 地址依然有被耗尽的危险。</p><p>于是，提出了一个种<strong>网络地址转换 NAT</strong> 的方法，再次缓解了 IPv4 地址耗尽的问题。</p><p>简单的来说 NAT 就是在同个公司、家庭、教室内的主机对外部通信时，把私有 IP 地址转换成公有 IP 地址。</p><p><img data-src="https://cdn.jonty.top/img/202309071022779.png" alt="NAT"></p><blockquote><p>那不是 N 个 私有 IP 地址，你就要 N 个公有 IP 地址？这怎么就缓解了 IPv4 地址耗尽的问题？这不瞎扯吗？</p></blockquote><p>确实是，普通的 NAT 转换没什么意义。</p><p>由于绝大多数的网络应用都是使用传输层协议 TCP 或 UDP 来传输数据的。</p><p>因此，可以把 IP 地址 + 端口号一起进行转换。</p><p>这样，就用一个全球 IP 地址就可以了，这种转换技术就叫<strong>网络地址与端口转换 NAPT。</strong></p><p>很抽象？来，看下面的图解就能瞬间明白了。</p><p><img data-src="https://cdn.jonty.top/img/202309071023670.png" alt="NAPT">NAPT</p><p>图中有两个客户端 192.168.1.10 和 192.168.1.11 同时与服务器 183.232.231.172 进行通信，并且这两个客户端的本地端口都是 1025。</p><p>此时，<strong>两个私有 IP 地址都转换 IP 地址为公有地址 120.229.175.121，但是以不同的端口号作为区分。</strong></p><p>于是，生成一个 NAPT 路由器的转换表，就可以正确地转换地址跟端口的组合，令客户端 A、B 能同时与服务器之间进行通信。</p><p>这种转换表在 NAT 路由器上自动生成。例如，在 TCP 的情况下，建立 TCP 连接首次握手时的 SYN 包一经发出，就会生成这个表。而后又随着收到关闭连接时发出 FIN 包的确认应答从表中被删除。</p><blockquote><p>NAT 那么牛逼，难道就没缺点了吗？</p></blockquote><p>当然有缺陷，肯定没有十全十美的方案。</p><p>由于 NAT/NAPT 都依赖于自己的转换表，因此会有以下的问题：</p><ul><li>外部无法主动与 NAT 内部服务器建立连接，因为 NAPT 转换表没有转换记录。</li><li>转换表的生产与转换操作都会产生性能开销。</li><li>通信过程中，如果 NAT 路由器重启了，所有的 TCP 连接都将被重置。</li></ul><blockquote><p>如何解决 NAT 潜在的问题呢？</p></blockquote><p>解决的方法主要两种方法。</p><p><em>第一种就是改用 IPv6</em></p><p>IPv6 可用范围非常大，以至于每台设备都可以配置一个公有 IP 地址，就不搞那么多花里胡哨的地址转换了，但是 IPv6 普及速度还需要一些时间。</p><p><em>第二种 NAT 穿透技术</em></p><p>NAT 穿越技术拥有这样的功能，它能够让网络应用程序主动发现自己位于 NAT 设备之后，并且会主动获得 NAT 设备的公有 IP，并为自己建立端口映射条目，注意这些都是 NAT设备后的应用程序自动完成的。</p><p>也就是说，在 NAT 穿越技术中，NAT 设备后的应用程序处于主动地位，它已经明确地知道 NAT 设备要修改它外发的数据包，于是它主动配合 NAT 设备的操作，主动地建立好映射，这样就不像以前由 NAT 设备来建立映射了。</p><p>说人话，就是客户端主动从 NAT 设备获取公有 IP 地址，然后自己建立端口映射条目，然后用这个条目对外通信，就不需要 NAT 设备来进行转换了。</p><h4 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h4><p>ICMP 全称是 <strong>Internet Control Message Protocol</strong>，也就是<strong>互联网控制报文协议</strong>。</p><p>里面有个关键词 —— <strong>控制</strong>，如何控制的呢？</p><p>网络包在复杂的网络传输环境里，常常会遇到各种问题。</p><p>当遇到问题的时候，总不能死个不明不白，没头没脑的作风不是计算机网络的风格。所以需要传出消息，报告遇到了什么问题，这样才可以调整传输策略，以此来控制整个局面。</p><blockquote><p>ICMP 功能都有啥？</p></blockquote><p><code>ICMP</code> 主要的功能包括：<strong>确认 IP 包是否成功送达目标地址、报告发送过程中 IP 包被废弃的原因和改善网络设置等。</strong></p><p>在 <code>IP</code> 通信中如果某个 <code>IP</code> 包因为某种原因未能达到目标地址，那么这个具体的原因将<strong>由 ICMP 负责通知</strong>。</p><p><img data-src="https://cdn.jonty.top/img/202309071023492.png" alt="ICMP 目标不可达消息"></p><p>如上图例子，主机 <code>A</code> 向主机 <code>B</code> 发送了数据包，由于某种原因，途中的路由器 <code>2</code> 未能发现主机 <code>B</code> 的存在，这时，路由器 <code>2</code> 就会向主机 <code>A</code> 发送一个 <code>ICMP</code> 目标不可达数据包，说明发往主机 <code>B</code> 的包未能成功。</p><p>ICMP 的这种通知消息会使用 <code>IP</code> 进行发送 。</p><p>因此，从路由器 <code>2</code> 返回的 ICMP 包会按照往常的路由控制先经过路由器 <code>1</code> 再转发给主机 <code>A</code> 。收到该 ICMP 包的主机 <code>A</code> 则分解 ICMP 的首部和数据域以后得知具体发生问题的原因。</p><blockquote><p>ICMP 类型</p></blockquote><p>ICMP 大致可以分为两大类：</p><ul><li>一类是用于诊断的查询消息，也就是「<strong>查询报文类型</strong>」</li><li>另一类是通知出错原因的错误消息，也就是「<strong>差错报文类型</strong>」</li></ul><p><img data-src="https://cdn.jonty.top/img/202309071023450.png" alt="常见的 ICMP 类型"></p><h4 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h4><p>ICMP 跟 IGMP 是一点关系都没有的，就好像周杰与周杰伦的区别，大家不要混淆了。</p><p>在前面我们知道了组播地址，也就是 D 类地址，既然是组播，那就说明是只有一组的主机能收到数据包，不在一组的主机不能收到数组包，怎么管理是否是在一组呢？那么，就需要 <code>IGMP</code> 协议了。</p><p><img data-src="https://cdn.jonty.top/img/202309071023807.png" alt="组播模型"></p><p><strong>IGMP 是因特网组管理协议，工作在主机（组播成员）和最后一跳路由之间</strong>，如上图中的蓝色部分。</p><ul><li>IGMP 报文向路由器申请加入和退出组播组，默认情况下路由器是不会转发组播包到连接中的主机，除非主机通过 IGMP 加入到组播组，主机申请加入到组播组时，路由器就会记录 IGMP 路由器表，路由器后续就会转发该组播地址的数据包了。</li><li>IGMP 报文采用 IP 封装，IP 头部的协议号为 2，而且 TTL 字段值通常 为 1，因为 IGMP 是工作在主机与连接的路由器之间。</li></ul><blockquote><p>IGMP 工作机制</p></blockquote><p>IGMP 分为了三个版本分别是，IGMPv1、IGMPv2、IGMPv3。</p><p>接下来，以 <code>IGMPv2</code> 作为例子，说说<strong>常规查询与响应和离开组播组</strong>这两个工作机制。</p><p><em>常规查询与响应工作机制</em></p><p><img data-src="https://cdn.jonty.top/img/202309071023560.png" alt="IGMP 常规查询与响应工作机制"></p><ol><li>路由器会周期性发送目的地址为 <code>224.0.0.1</code>（表示同一网段内所有主机和路由器） <strong>IGMP 常规查询报文；</strong></li><li>主机1 和 主机 3 收到这个查询，随后会启动「报告延迟计时器」，计时器的时间是随机的，通常是 0~10 秒，计时器超时后主机就会发送 <strong>IGMP 成员关系报告报文</strong>（源 IP 地址为自己主机的 IP 地址，目的 IP 地址为组播地址）。如果在定时器超时之前，收到同一个组内的其他主机发送的成员关系报告报文，则自己不再发送，这样可以减少网络中多余的 IGMP 报文数量；</li><li>路由器收到主机的成员关系报告报文后，就会在 IGMP 路由表中加入该组播组，后续网络中一旦该组播地址的数据到达路由器，它会把数据包转发出去；</li></ol><p><em>离开组播组工作机制</em></p><p>离开组播组的情况一，网段中仍有该组播组：</p><p><img data-src="https://cdn.jonty.top/img/202309071024282.png" alt="IGMPv2 离开组播组工作机制 情况1"></p><ol><li>主机 1 要离开组 224.1.1.1，发送 IGMPv2 离组报文，报文的目的地址是 224.0.0.2（表示发向网段内的所有路由器）；</li><li>路由器收到该报文后，以 1 秒为间隔连续发送 IGMP 特定组查询报文（共计发送 2 个），以便确认该网络是否还有 224.1.1.1 组的其他成员；</li><li>主机 3 仍然是组 224.1.1.1 的成员，因此它立即响应这个特定组查询。路由器知道该网络中仍然存在该组播组的成员，于是继续向该网络转发 224.1.1.1 的组播数据包；</li></ol><p>离开组播组的情况二，网段中没有该组播组：</p><p><img data-src="https://cdn.jonty.top/img/202309071024481.png" alt="IGMPv2 离开组播组工作机制 情况2"></p><ol><li>主机 1 要离开组播组 224.1.1.1，发送 IGMP 离组报文；</li><li>路由器收到该报文后，以 1 秒为间隔连续发送 IGMP 特定组查询报文（共计发送 2 个）。此时在该网段内，组 224.1.1.1 已经没有其他成员了，因此没有主机响应这个查询；</li><li>一定时间后，路由器认为该网段中已经没有 224.1.1.1 组播组成员了，将不会再向这个网段转发该组播地址的数据包；</li></ol><hr><h5 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h5><p>[1] 计算机网络-自顶向下方法.陈鸣 译.机械工业出版社</p><p>[2] TCP/IP详解 卷1：协议.范建华 译.机械工业出版社</p><p>[3] 图解TCP/IP.竹下隆史.人民邮电出版社</p>]]></content>
    
    
    <summary type="html">关于 IP 分类地址、子网划分等的文章</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="Share" scheme="https://jonty.top/tags/Share/"/>
    
  </entry>
  
  <entry>
    <title>【分享】前端Chrome调试</title>
    <link href="https://jonty.top/2023/07/13/chrome-debugging-tips/"/>
    <id>https://jonty.top/2023/07/13/chrome-debugging-tips/</id>
    <published>2023-07-13T03:03:53.000Z</published>
    <updated>2023-07-13T03:05:25.592Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="https://cdn.jonty.top/img/151257-20230623112938457-597264579.png" alt="image.png"></p><p>Chrome浏览器调试工具的核心功能：</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938315-1220135849.jpg" alt="img"></p><blockquote><p>🥷🏻注：本文测试、截图均为Edge浏览器（内核是Chromium），浏览器内核可了解《<a href="https://www.yuque.com/kanding/ktech/fh36v0">有哪些浏览器/内核？</a>》</p></blockquote><h2 id="基础操作汇总"><a href="#基础操作汇总" class="headerlink" title="基础操作汇总"></a>基础操作汇总</h2><table><thead><tr><th align="left"><strong>操作类型</strong></th><th align="left"><strong>快捷键/说明</strong></th></tr></thead><tbody><tr><td align="left">切换浏览器标签</td><td align="left">🔸 <code>Ctrl+1到8</code>切换到对应序号的浏览器标签<br/> 🔸 <code>Ctrl+PgUp/PgDn</code>标签页左右切换</td></tr><tr><td align="left">浏览器全屏</td><td align="left"><code>F11</code> (<code>⌘ + shift + F</code> Mac)</td></tr><tr><td align="left">打开调试模式</td><td align="left">🔸 <code>F12</code>，<code>Ctrl + Shift + I</code> (Windows) 或<code> Cmd + Opt + I</code> (Mac) <br/>🔸 页面右键菜单“检查”，浏览器菜单“开发者工具”</td></tr><tr><td align="left">切换调试工具位置（下面、右边）</td><td align="left"><code>ctrl + shift + D</code> (<code>⌘ + shift + D</code> Mac)</td></tr><tr><td align="left">切换 DevTools 的面板标签</td><td align="left"><code>ctrl + [</code> 和 <code>ctrl + ]</code>左右切换调试工具面板</td></tr><tr><td align="left">内容搜索查找</td><td align="left"><code>Ctrl+F</code>：元素、控制台、源代码、网络都支持搜索查找</td></tr><tr><td align="left">使用命令Command面板</td><td align="left"><code>Ctrl] + [Shift] + [P]</code> （Mac：<code> [⌘] + [Shift]+ [P]</code>） 类似VSCode的命令面板，有大量的隐藏功能，可以在这里搜索使用</td></tr><tr><td align="left">复制元素</td><td align="left">🔸 元素面板：选中元素》<code>Ctrl+C</code> <br/>🔸 元素面板：选中元素》右键菜单》复制元素 <br/>🔸 <code>copy($0)</code> 控制台中代码复制当前选中元素</td></tr><tr><td align="left">控制台：快速访问当前元素’$0’</td><td align="left"><code>$0</code>代表在元素面板中选中元素，<code>$1</code>是上一个，支持到<code>$4</code></td></tr><tr><td align="left">控制台：全局<code>copy</code>方法</td><td align="left">复制任何对象到剪切板，<code>copy(window.location)</code></td></tr><tr><td align="left">控制台：queryObjects(Type)</td><td align="left">查询指定类型（构造器）的对象实例有哪些</td></tr><tr><td align="left">控制台：保存堆栈信息( Stack trace )</td><td align="left">报错信息可以右键另存为文件，保存完整堆栈信息</td></tr><tr><td align="left">控制台：<code>$</code>、<code>$$</code>查询Dom元素</td><td align="left">- <code>$</code> = <code>document.querySelector</code> - <code>$$</code> = <code>document.querySelectorAll</code></td></tr><tr><td align="left">Store as global（存储为全局变量）</td><td align="left">🔸 控制台（右键）：把一个对象设置为全局变量，自动命名为<code>temp*</code> <br/>🔸 元素面板（右键）：把一个元素设置全局变量，同上</td></tr><tr><td align="left">元素：<code>h</code>快速隐藏、显示该元素</td><td align="left">选中元素，按下<code>h</code>快速隐藏、显示该元素。</td></tr><tr><td align="left">元素：移动元素</td><td align="left">🔸 鼠标拖动到任意位置 <br/>🔸 上下移动，<code>[ctrl] + [⬆]</code> / <code>[ctrl] + [⬇]</code> （<code>[⌘] + [⬆] / [⌘] + [⬇]</code>on Mac）</td></tr></tbody></table><p>🔸<strong>Store as global（存储为全局变量）</strong>：类似copy方法，将一个对象保存为全局变量，变量命名依次为<code>temp1</code>、<code>temp2</code></p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938377-948109294.png" alt="image.png"></p><p>**🔸保存堆栈信息( Stack trace )**：错误堆栈信息另存为文件，保存完整堆栈信息。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938299-1173868388.png" alt="image.png"></p><p><strong>🔸Command面板</strong>：同VSCode的命令面板，可以找到调试工具的所有的（隐藏）功能。<code>Ctrl] + [Shift] + [P]</code> （Mac：<code>[⌘] + [Shift]+ [P]</code>）</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938237-1437141754.png" alt="image.png"></p><ul><li><strong>设置主题</strong>：打开Command面板，搜索“主题”，可以切换多种主题</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938406-1112736968.png" alt="image.png"></p><ul><li><strong>分析代码的覆盖率</strong>：打开Command面板，如下图搜索“覆盖”，分析首次页面加载过程中哪些代码执行了，那些没有执行，输出一个报告。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938411-1934457543.png" alt="image.png"></p><p>选择文件可进一步查看代码的使用分析，红色 = 尚未执行，青蓝色 = 至少执行了一次。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938364-1323536527.png" alt="image.png"></p><p><strong>🔸元素截图</strong>：输出指定元素的截图，包含隐藏滚动的内容，这个功能挺好用的。</p><ul><li>通过Command面板：搜索“截图”，全屏截图、指定节点截图。</li><li>元素面板中，选中元素》右键菜单》“捕获节点屏幕截图”。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938298-493151014.png" alt="image.png"></p><h2 id="元素面板（Element）"><a href="#元素面板（Element）" class="headerlink" title="元素面板（Element）"></a>元素面板（Element）</h2><p>可以自由调试DOM、CSS样式，使用评率级高：⭐⭐⭐⭐⭐。</p><ul><li><strong>DOM树</strong>：左侧为DOM元素树，支持多种操作，如编辑、删除、新增、复制DOM元素，更多可查看右键菜单。</li><li><strong>样式</strong>：选中元素的样式，可编辑、添加CSS样式，实时预览。</li><li><strong>已计算</strong>：选中元素计算的样式值。</li><li><strong>布局</strong>：grid布局、flex布局调试。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623113942060-636325101.png" alt="image"></p><h3 id="CSS可视化编辑器"><a href="#CSS可视化编辑器" class="headerlink" title="CSS可视化编辑器"></a>CSS可视化编辑器</h3><p>可视化的颜色、贝塞尔曲线、阴影编辑器，所见即所得，挺好用！</p><ul><li><strong>颜色编辑器</strong>：只要是颜色属性，都可以点击色块按钮可视化编辑颜色，支持拖动设置颜色、取色、设置对比度。</li><li><strong>Grid、Flex布局编辑器</strong>：当使用弹性布局Grid、Flex时，支持可视化编辑布局对齐方式。</li><li><strong>阴影编辑器</strong>：阴影<code>shadow</code>属性上，会出现编辑器按钮，可视化编辑阴影效果。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938265-495918130.png" alt="image.png"></p><ul><li><strong>贝塞尔曲线编辑器</strong>：在动画<code>transition</code>、<code>animation</code>中会用到贝塞尔曲线函数（缓动函数）。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938307-631688298.png" alt="image.png"></p><h3 id="强制激活伪类"><a href="#强制激活伪类" class="headerlink" title="强制激活伪类"></a>强制激活伪类</h3><p>强制激活元素的伪类效果。</p><ul><li>选择Dom节点右键“强制状态”。</li><li>如下图CSS样式中“切换元素状态”。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938340-1528296991.png" alt="image.png"></p><h3 id="DOM断点"><a href="#DOM断点" class="headerlink" title="DOM断点"></a>DOM断点</h3><p>选中DOM元素，右键设置中断点，可以在元素更改（JS代码修改DOM）时触发断点。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938147-1545031101.png" alt="image.png"></p><p>添加后可以在源代码中查看到已添加的DOM断点，或者元素面板中的“DOM断点”。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938405-2021055934.png" alt="image.png"></p><h2 id="控制台面板（Console）"><a href="#控制台面板（Console）" class="headerlink" title="控制台面板（Console）"></a>控制台面板（Console）</h2><p>主要功能就是调试JavaScript代码，是比较常用的调试工具，使用频率很高：⭐⭐⭐⭐⭐</p><ul><li><strong>运行代码</strong>：可执行任意JS代码，包括调用页面已有的JS对象、函数。</li><li><strong>console输出</strong>：代码中的Console、异常错误都会在这里输出。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938378-1572840200.png" alt="image.png"></p><h3 id="console函数"><a href="#console函数" class="headerlink" title="console函数"></a>console函数</h3><p>用console函数输出变量，是比较常用的调试技巧，console的常用函数：</p><table><thead><tr><th align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Console"><strong>console</strong></a><strong>函数</strong></th><th align="left"><strong>说明</strong></th></tr></thead><tbody><tr><td align="left">console.<strong>log</strong>(str)</td><td align="left">控制台输出一条消息</td></tr><tr><td align="left">console.<strong>error</strong>(str);</td><td align="left">打印一条错误信息，类似的还有<code>info</code>、<code>warn</code></td></tr><tr><td align="left">console.<strong>table</strong>(data [, columns])</td><td align="left">将数据以表格的形式显示，很实用，data为数组或对象，第二个参数（数组）可指定输出的列</td></tr><tr><td align="left">console.<strong>dir</strong>(object)</td><td align="left">树形方式打印对象，特别是DOM对象非常实用</td></tr><tr><td align="left">console.<strong>assert</strong>(false, ‘false’)</td><td align="left">断言输出，为<code>false</code>才会输出</td></tr><tr><td align="left">console.<strong>trace</strong>()</td><td align="left">输出当前位置的执行堆栈，用断点会更实用一些。</td></tr><tr><td align="left">console.<strong>time</strong>(label)</td><td align="left">计时器，可用来计算耗时（毫秒），三个函数配合使用：<strong>time</strong>(开始计时) &gt; <strong>timeLog</strong>(计时) &gt; <strong>timeEnd</strong>(结束)</td></tr><tr><td align="left">console.<strong>clear</strong>()</td><td align="left">清空控制台，并输出 Console was cleared。</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;log&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">&#x27;info&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.warn(<span class="string">&#x27;warn&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.table([<span class="string">&quot;sam&quot;</span>, <span class="string">&quot;egan&quot;</span>, <span class="string">&quot;kettle&quot;</span>])</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;出错了！！！&#x27;</span>)</span><br></pre></td></tr></table></figure><p>控制台输出效果，右侧链接为对应JS代码的链接。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938407-1186520163.png" alt="image.png"></p><p>用<code>console.time()</code>来计算代码的耗时，参数为计时器命名。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> u = &#123; <span class="attr">name</span>: <span class="string">&#x27;sam&#x27;</span>, <span class="attr">age</span>: i &#125;</span><br><span class="line">    sum += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 计算一个函数的耗时</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&#x27;sum&#x27;</span>) <span class="comment">// 开始计时</span></span><br><span class="line"><span class="keyword">const</span> total = sum(<span class="number">100000</span>);</span><br><span class="line"><span class="built_in">console</span>.timeLog(<span class="string">&#x27;sum&#x27;</span>);  <span class="comment">// 计时：sum: 4.43994140625 ms</span></span><br><span class="line"><span class="keyword">const</span> total2 = sum(<span class="number">1000</span>);</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&#x27;sum&#x27;</span>);  <span class="comment">// 计时：sum: 5.0419921875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123; total &#125;);  <span class="comment">//&#123;total: 5000050000&#125;</span></span><br></pre></td></tr></table></figure><h3 id="增强log"><a href="#增强log" class="headerlink" title="增强log"></a>增强log</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="number">100</span>, y = <span class="number">200</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x, y); <span class="comment">// 100 200</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123; x, y &#125;); <span class="comment">// &#123;x: 100, y: 200&#125;</span></span><br><span class="line"><span class="built_in">console</span>.table(&#123; x, y &#125;); </span><br></pre></td></tr></table></figure><p>如上代码，经常我们会输出一些变量值，如果直接输出值，则不知道值对应的变量。这时可以用字面量对象，输出的可读性立马就提升了，再加上<code>console.table</code>就更完美了。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938292-321740182.png" alt="image.png"></p><h3 id="自定义log样式：占位符"><a href="#自定义log样式：占位符" class="headerlink" title="自定义log样式：占位符"></a>自定义log样式：占位符</h3><p><code>console</code>函数支持的占位符：</p><table><thead><tr><th align="left">占位符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>%c</code></td><td align="left">CSS样式占位符，值就是CSS样式，如下示例，可用来自定义log的样式</td></tr><tr><td align="left"><code>%o</code> or <code>%O</code></td><td align="left">打印 JavaScript 对象。在审阅器点击对象名字可展开更多对象的信息。</td></tr><tr><td align="left"><code>%d</code> or <code>%i</code></td><td align="left">打印整数。支持数字格式化。例如，console.log(“Foo %.2d”, 1.1) 会输出有先导 0 的两位有效数字：Foo 01。</td></tr><tr><td align="left"><code>%s</code></td><td align="left">打印字符串。</td></tr><tr><td align="left"><code>%f</code></td><td align="left">打印浮点数。支持格式化，比如 console.log(“Foo %.2f”, 1.1) 会输出两位小数：Foo 1.10</td></tr></tbody></table><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938195-1563619369.png" alt="image.png"></p><h3 id="监听函数"><a href="#监听函数" class="headerlink" title="监听函数"></a>监听函数</h3><p>通过如下（调试工具）的全局函数可监听一个函数、事件的执行。</p><table><thead><tr><th align="left">函数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>monitor</strong>( function )</td><td align="left">监听一个函数，当被监听函数执行的时候，会打印被调用信息</td></tr><tr><td align="left"><strong>monitorEvents</strong> ( event )</td><td align="left">监听一个事件，当事件被触发时打印触发事件日志</td></tr></tbody></table><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938184-1929017682.png" alt="image.png"></p><h3 id="监听变量：活动表达式"><a href="#监听变量：活动表达式" class="headerlink" title="监听变量：活动表达式"></a>监听变量：活动表达式</h3><p>一个不错的小功能，点击下图中的眼睛图标，相当于添加了一个动态表达式，然后实时监控（显示）该表达式的值。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938226-1635124708.png" alt="image.png"></p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938696-1137434295.webp" alt="img"></p><h2 id="源代码面板（Sources）"><a href="#源代码面板（Sources）" class="headerlink" title="源代码面板（Sources）"></a>源代码面板（Sources）</h2><p>顾名思义，管理网页所有的源代码文件，包括JS、CSS、图片等资源，经常就是在这里断点调试JS代码，使用评率中：⭐⭐⭐⭐。</p><p>在调试模式下可以查看（鼠标悬浮在变量上）变量值、上下文作用域、函数调用堆栈信息。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623114401947-402092485.png" alt="image"></p><ul><li><strong>① 页面资源目录</strong>：页面涉及的所有资源（树）。</li><li><strong>② 源代码</strong>：文件源代码，可以在这里添加断点调试JS代码，如果想编辑在线JS代码，也是可以的，详见后文。</li><li><strong>③ Debug工具栏</strong>：断点调试的操作工具，可以控制暂停、继续、单步…执行代码。</li><li><strong>④ 断点调试器</strong>：这里包含多个断点调试器：</li></ul><blockquote><ul><li><strong>监视（Watch）</strong>：可添加对变量的监视。</li><li><strong>断点（Breakpoints）</strong>：所有添加的断点，可在这里编辑、删除管理。</li><li><strong>作用域（Scope）</strong>：当前代码上下文的作用域，含闭包。</li><li><strong>调用堆栈（Call Stack</strong>）：当前函数的调用堆栈，推荐参考《<a href="https://www.yuque.com/kanding/ktech/jsfunctoin2#cuhoC">JavaScript函数(2)原理{深入}执行上下文</a>》。</li><li><strong>XHR/提取断点</strong>：可以在这里添加对AJAX请求（XHR、Fetch）的断点，添加URL地址即可。</li><li><strong>DOM断点</strong>：在元素页面添加的DOM断点会在这里显示。</li></ul></blockquote><h3 id="断点调试"><a href="#断点调试" class="headerlink" title="断点调试"></a>断点调试</h3><p>如下图，在源代码行号位置添加断点。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938272-1731314310.png" alt="image.png"></p><ul><li><strong>添加断点（Add breakpoint）</strong>：添加一个普通断点，最左侧行号处，点击添加断点，或者右键菜单。</li></ul><p>也可以在JS代码中设置断点，关键字：<code>debugger</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">debugger</span> <span class="comment">// 会在这里断点</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;debugger&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>添加条件断点（Add conditional breakpoint）</strong>：添加一个条件断点，符合条件断点才会生效，条件可使用当前代码上下文中的变量。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938383-147289909.png" alt="image.png"></p><ul><li><strong>添加记录点（Add logpoint）</strong>：添加一个日志打印，打印当前代码环境的变量，非常方便，不用在源码下添加<code>console</code>了。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938406-1818916486.png" alt="image.png"></p><h3 id="调试线上代码：本地工作区"><a href="#调试线上代码：本地工作区" class="headerlink" title="调试线上代码：本地工作区"></a>调试线上代码：本地工作区</h3><p>如果是线上的环境，能不能直接修改源代码（JS、CSS）调试呢？—— 可以的。思路就是创建本地的JS副本，页面加载本地的JS文件，就可以在本地JS文件上修改了。</p><p><strong>① 创建本地工作目录</strong>：</p><ul><li>如下图，源代码下面找到“覆盖（Override）”。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938255-79717952.png" alt="image.png"></p><ul><li>然后点击“选择替代文件夹”，添加一个本地空的文件夹，作为本地工作目录。</li><li>添加后要注意要确认授权。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938618-621276412.png" alt="image.png"></p><p><strong>② 创建源代码的本地副本</strong>：选择需要修改的源代码右键“保存以备替代”，就会在本地目录创建副本文件，网页使用本地的JS文件。</p><ul><li>创建的本地副本，可以在“覆盖”下看到，也可以在本地文件夹下看到。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938458-1154512196.png" alt="image.png"></p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938278-1914798126.png" alt="image.png"></p><p><strong>③ 编辑代码</strong>：该JS文件就可以直接在源代码中编辑修改了，实时生效。</p><ul><li>CSS、HTML、JavaScript都支持。</li><li>可以在浏览器的源代码中修改，也可以本地其他工具中打开编辑。</li></ul><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938469-1983085199.png" alt="image.png"></p><h2 id="网络面板（Network）"><a href="#网络面板（Network）" class="headerlink" title="网络面板（Network）"></a>网络面板（Network）</h2><p><img data-src="https://cdn.jonty.top/img/151257-20230623114556140-1411307077.png" alt="image"></p><p>工具栏中两个比较实用的小功能：禁用缓存、模拟弱网环境。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938271-33800824.png" alt="image.png"></p><p>点击请求的资源项，可以查看详细的请求、响应数据，常用于服务端接口的联调。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623114634987-834374801.png" alt="image"></p><p>还可以编辑参数，重新发起请求</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938615-1015835259.png" alt="image.png"></p><h2 id="性能面板（Performance）"><a href="#性能面板（Performance）" class="headerlink" title="性能面板（Performance）"></a>性能面板（Performance）</h2><p>先录制，后分析，分析网络、CPU、内存、渲染FPS帧率，用于定位、解决页面性能问题。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623114704972-512414378.png" alt="image"></p><blockquote><p><strong>🚩特别提示</strong>：调试性能建议在<strong>无痕模式</strong>下进行，尽量避浏览器插件的影响。包括其他异常Bug的调试，也要考虑浏览器插件问题，之前就遇到过类似问题，页面上一个Bug怎么也复现不了，几经波折才发现是测试机上的油猴插件的影响。</p></blockquote><p><strong>🔸性能监视器</strong>（Performance monitor）面板可以<strong>实时</strong>的监控页面性能参数。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938470-616843507.png" alt="image.png"></p><p><strong>🔸Lighthouse</strong>，这个就很厉害了，对页面进行综合分析，包括性能、PWA（Progressive Web App，渐进式Web应用）、SEO、无障碍访问等，分析完后产出报告，给出得分，还给出了页面改进建议。</p><p><img data-src="https://cdn.jonty.top/img/151257-20230623112938471-1405739588.png" alt="image.png"></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>掘金小册：<a href="https://juejin.cn/book/6844733783166418958">你不知道的 Chrome 调试技巧</a> ，<a href="https://dendoink.github.io/daydream/docs/chrome-tricks/index">开源版</a></li><li>掘金小册：<a href="https://juejin.cn/course/bytetech/7180922988034785336/section/7181029728822755385">前端开发调试之 PC 端调试</a></li><li><a href="https://bytedance.feishu.cn/file/boxcnAGLgshQ1EKi7ACwx4WI9vc">前端必须知道的开发调试知识.pptx</a></li><li><a href="https://www.yuque.com/kanding/ktech/fh36v0">有哪些浏览器/内核？</a></li><li><a href="https://www.yuque.com/kanding/ktech/jsfunctoin2#cuhoC">JavaScript函数(2)原理{深入}执行上下文</a></li></ul><blockquote><p><strong>©️版权申明</strong>：版权所有@安木夕，本文内容仅供学习，欢迎指正、交流，转载请注明出处！<a href="https://www.yuque.com/kanding/ktech/mh8eqzgf6wnbphuv#q18bL"><em>原文编辑地址-语雀</em></a></p></blockquote>]]></content>
    
    
    <summary type="html">前端Chrome调试技巧汇总</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="Share" scheme="https://jonty.top/tags/Share/"/>
    
    <category term="Web Debug" scheme="https://jonty.top/tags/Web-Debug/"/>
    
  </entry>
  
  <entry>
    <title>Docker搭建私有Gitlab</title>
    <link href="https://jonty.top/2023/07/07/ubuntu-docker-deploy-gitlab/"/>
    <id>https://jonty.top/2023/07/07/ubuntu-docker-deploy-gitlab/</id>
    <published>2023-07-07T01:39:28.000Z</published>
    <updated>2023-07-07T08:24:58.527Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="https://cdn.jonty.top/img/R-C.ecb6c01c3a955a63337b4c624a15276f.png" alt="gitlab"></p><div class="note info"><p>GitLab is the only place where enterprises build mission‑critical software.</p></div><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>创建目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/gitlab/config/ssl</span><br><span class="line">mkdir /root/gitlab/logs</span><br><span class="line">mkdir /root/gitlab/data</span><br></pre></td></tr></table></figure><p>阿里云申请ssl证书，下载Nginx版本</p><p>解压到<code>/root/gitlab/config/ssl</code>目录</p><p><code>pem</code>后缀改成<code>crt</code></p><p><img data-src="https://cdn.jonty.top/img/image-20230627171654621.png" alt="image-20230627171654621"></p><p><img data-src="https://cdn.jonty.top/img/image-20230707154229073.png" alt="image-20230707154229073"></p><p>创建<code>docker-compose.yaml</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  gitlab:</span><br><span class="line">    environment:</span><br><span class="line">      GITLAB_OMNIBUS_CONFIG: |</span><br><span class="line">        external_url <span class="string">&#x27;https://gitlab.jonty.top&#x27;</span></span><br><span class="line">        nginx[<span class="string">&#x27;listen_port&#x27;</span>] = 443</span><br><span class="line">        nginx[<span class="string">&#x27;redirect_http_to_https&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        nginx[<span class="string">&#x27;ssl_certificate&#x27;</span>] = <span class="string">&quot;/etc/gitlab/ssl/gitlab.jonty.top.crt&quot;</span></span><br><span class="line">        nginx[<span class="string">&#x27;ssl_certificate_key&#x27;</span>] = <span class="string">&quot;/etc/gitlab/ssl/gitlab.jonty.top.key&quot;</span></span><br><span class="line"></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.qq.com&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 465</span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;501211312@qq.com&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;your_passwork_key&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;gitlab.jonty.top&#x27;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;smtp.qq.com&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    container_name: gitlab</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">      - 443:443</span><br><span class="line">    image: gitlab/gitlab-ee:latest</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      - /root/gitlab/config:/etc/gitlab</span><br><span class="line">      - /root/gitlab/logs:/var/<span class="built_in">log</span>/gitlab</span><br><span class="line">      - /root/gitlab/data:/var/opt/gitlab</span><br><span class="line">    networks:</span><br><span class="line">      - internal-network</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  internal-network:</span><br><span class="line">    external: <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"></span><br><span class="line">[root@VM-0-5-centos gitlab]<span class="comment"># docker compose up -d</span></span><br><span class="line">[+] Running 1/1</span><br><span class="line"> ✔ Container gitlab  Started </span><br></pre></td></tr></table></figure><p>进入容器查看初始密码，账号为：root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab /bin/bash</span><br><span class="line">cat /etc/gitlab/initial_root_password</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230707155449732.png" alt="image-20230707155449732"></p><p><img data-src="https://cdn.jonty.top/img/image-20230707155527280.png" alt="image-20230707155527280"></p><h2 id="生成许可证"><a href="#生成许可证" class="headerlink" title="生成许可证"></a>生成许可证</h2><blockquote><p>安装Ruby:<a href="https://www.cnblogs.com/livelab/p/12960670.html">如何在Ubuntu 20.04上安装Ruby2.7.0 - GlaryJoker - 博客园 (cnblogs.com)</a></p></blockquote><p>安装Ruby</p><p>版本大于2.7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install ruby-full</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">root@gitlab:/home/jonty/gitlab<span class="comment"># ruby -v</span></span><br><span class="line">ruby 2.7.0p0 (2019-12-25 revision 647ee6f091) [x86_64-linux-gnu]</span><br></pre></td></tr></table></figure><p>安装gitlab-license</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install gitlab-license</span><br></pre></td></tr></table></figure><p>创建目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/gitlab/license &amp; <span class="built_in">cd</span></span><br></pre></td></tr></table></figure><p>创建<code>license.rb</code>文件</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">require &quot;openssl&quot;</span><br><span class="line">require &quot;gitlab/license&quot;</span><br><span class="line">key<span class="built_in">_</span>pair = OpenSSL::PKey::RSA.generate(2048)</span><br><span class="line">File.open(&quot;license<span class="built_in">_</span>key&quot;, &quot;w&quot;) &#123; |f| f.write(key<span class="built_in">_</span>pair.to<span class="built_in">_</span>pem) &#125;</span><br><span class="line">public<span class="built_in">_</span>key = key<span class="built_in">_</span>pair.public<span class="built_in">_</span>key</span><br><span class="line">File.open(&quot;license<span class="built_in">_</span>key.pub&quot;, &quot;w&quot;) &#123; |f| f.write(public<span class="built_in">_</span>key.to<span class="built_in">_</span>pem) &#125;</span><br><span class="line">private<span class="built_in">_</span>key = OpenSSL::PKey::RSA.new File.read(&quot;license<span class="built_in">_</span>key&quot;)</span><br><span class="line">Gitlab::License.encryption<span class="built_in">_</span>key = private<span class="built_in">_</span>key</span><br><span class="line">license = Gitlab::License.new</span><br><span class="line">license.licensee = &#123;</span><br><span class="line">&quot;Name&quot; =&gt; &quot;Jonty&quot;,</span><br><span class="line">&quot;Company&quot; =&gt; &quot;Jonty.tEd&quot;,</span><br><span class="line">&quot;Email&quot; =&gt; &quot;gitlab@jonty.top&quot;,</span><br><span class="line">&#125;</span><br><span class="line">license.starts<span class="built_in">_</span>at = Date.new(2021, 1, 1) <span class="params">#</span> 开始时间</span><br><span class="line">license.expires<span class="built_in">_</span>at = Date.new(2050, 1, 1) <span class="params">#</span> 结束时间</span><br><span class="line">license.notify<span class="built_in">_</span>admins<span class="built_in">_</span>at = Date.new(2049, 12, 1)</span><br><span class="line">license.notify<span class="built_in">_</span>users<span class="built_in">_</span>at = Date.new(2049, 12, 1)</span><br><span class="line">license.block<span class="built_in">_</span>changes<span class="built_in">_</span>at = Date.new(2050, 1, 1)</span><br><span class="line">license.restrictions = &#123;</span><br><span class="line">active<span class="built_in">_</span>user<span class="built_in">_</span>count: 10000,</span><br><span class="line">&#125;</span><br><span class="line">puts &quot;License:&quot;</span><br><span class="line">puts license</span><br><span class="line">data = license.export</span><br><span class="line">puts &quot;Exported license:&quot;</span><br><span class="line">puts data</span><br><span class="line">File.open(&quot;GitLabBV.gitlab-license&quot;, &quot;w&quot;) &#123; |f| f.write(data) &#125;</span><br><span class="line">public<span class="built_in">_</span>key = OpenSSL::PKey::RSA.new File.read(&quot;license<span class="built_in">_</span>key.pub&quot;)</span><br><span class="line">Gitlab::License.encryption<span class="built_in">_</span>key = public<span class="built_in">_</span>key</span><br><span class="line">data = File.read(&quot;GitLabBV.gitlab-license&quot;)</span><br><span class="line"><span class="built_in">$</span>license = Gitlab::License.import(data)</span><br><span class="line">puts &quot;Imported license:&quot;</span><br><span class="line">puts <span class="built_in">$</span>license</span><br><span class="line">unless <span class="built_in">$</span>license</span><br><span class="line">raise &quot;The license is invalid.&quot;</span><br><span class="line">end</span><br><span class="line">if <span class="built_in">$</span>license.restricted?(:active<span class="built_in">_</span>user<span class="built_in">_</span>count)</span><br><span class="line">active<span class="built_in">_</span>user<span class="built_in">_</span>count = 10000</span><br><span class="line">if active<span class="built_in">_</span>user<span class="built_in">_</span>count &gt; <span class="built_in">$</span>license.restrictions[:active<span class="built_in">_</span>user<span class="built_in">_</span>count]</span><br><span class="line">    raise &quot;The active user count exceeds the allowed amount!&quot;</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line">if <span class="built_in">$</span>license.notify<span class="built_in">_</span>admins?</span><br><span class="line">puts &quot;The license is due to expire on <span class="params">#</span>&#123;<span class="built_in">$</span>license.expires<span class="built_in">_</span>at&#125;.&quot;</span><br><span class="line">end</span><br><span class="line">if <span class="built_in">$</span>license.notify<span class="built_in">_</span>users?</span><br><span class="line">puts &quot;The license is due to expire on <span class="params">#</span>&#123;<span class="built_in">$</span>license.expires<span class="built_in">_</span>at&#125;.&quot;</span><br><span class="line">end</span><br><span class="line">module Gitlab</span><br><span class="line">class GitAccess</span><br><span class="line">    def check(cmd, changes = nil)</span><br><span class="line">    if <span class="built_in">$</span>license.block<span class="built_in">_</span>changes?</span><br><span class="line">        return build<span class="built_in">_</span>status<span class="built_in">_</span>object(false, &quot;License expired&quot;)</span><br><span class="line">    end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line">puts &quot;This instance of GitLab Enterprise Edition is licensed to:&quot;</span><br><span class="line"><span class="built_in">$</span>license.licensee.each do |key, value|</span><br><span class="line">puts &quot;<span class="params">#</span>&#123;key&#125;: <span class="params">#</span>&#123;value&#125;&quot;</span><br><span class="line">end</span><br><span class="line">if <span class="built_in">$</span>license.expired?</span><br><span class="line">puts &quot;The license expired on <span class="params">#</span>&#123;<span class="built_in">$</span>license.expires<span class="built_in">_</span>at&#125;&quot;</span><br><span class="line">elsif <span class="built_in">$</span>license.will<span class="built_in">_</span>expire?</span><br><span class="line">puts &quot;The license will expire on <span class="params">#</span>&#123;<span class="built_in">$</span>license.expires<span class="built_in">_</span>at&#125;&quot;</span><br><span class="line">else</span><br><span class="line">puts &quot;The license will never expire.&quot;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>执行<code>license.rb</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby license.rb</span><br></pre></td></tr></table></figure><p>生成以下文件</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitLabBV.gitlab-license  license.rb  license<span class="built_in">_</span>key  license<span class="built_in">_</span>key.pub</span><br></pre></td></tr></table></figure><ul><li>GitLabBV.gitlab-license : 页面导入的License文件</li><li>license_key.pub ：覆盖原有的key</li></ul><p>查看<code>license_key.pub </code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@gitlab:/home/jonty/gitlab/backups<span class="comment"># cat license_key.pub </span></span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtRXZpH9H6EXFEohYjLcZ</span><br><span class="line">uAYoSVJfZjdpRnT/76JlNfHOOA6RbCBzzwN5FJkyCev/wXCe5P+jR1+jqp0DErrF</span><br><span class="line">3/tYe3ZkUyDkD8c54AMpNqeXeevB+EEz4KqdsO9Q5260jlKxfTEVSQLZaItRfi0s</span><br><span class="line">kq25nPRghOSX7kTL/riQA9dg2L0/of5ewgS164cTtgjeTKBCoOKN/vfw/GC0PDWn</span><br><span class="line">Mf9OaR0C7NtOGesJBCWR47QjnPOjXHFip/yt0K8ytc42XGgzdJjFjPrUuZ1hbzJ7</span><br><span class="line">Y8W9EvWu9+k9iupBK9XeeTORZDZYBvpHvAT2orEoLN1IUX7Bo12c2ddagfoSWp0v</span><br><span class="line">swIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>复制后进入容器内，替换密钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab /bin/bash</span><br><span class="line">vi /opt/gitlab/embedded/service/gitlab-rails/.license_encryption_key.pub</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>重启容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose restart</span><br></pre></td></tr></table></figure><p>导入License文件，进入管理中心=&gt; 通用=&gt;添加许可证</p><p>导入<code>GitLabBV.gitlab-license</code>文件 </p><p><img data-src="https://cdn.jonty.top/img/image-20230627174050150.png" alt="image-20230627174050150"></p><p>激活完成</p><p><img data-src="https://cdn.jonty.top/img/image-20230627174223096.png" alt="image-20230627174223096"></p>]]></content>
    
    
    <summary type="html">Ubuntu-使用Docker搭建私有代码托管平台</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Gitlab" scheme="https://jonty.top/tags/Gitlab/"/>
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Redis分布式锁以及ABP应用</title>
    <link href="https://jonty.top/2023/06/09/redis-distributed-locking/"/>
    <id>https://jonty.top/2023/06/09/redis-distributed-locking/</id>
    <published>2023-06-09T05:59:01.000Z</published>
    <updated>2023-06-09T07:08:48.987Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>分布式锁其实就是，控制分布式系统不同进程共同访问共享资源的一种锁的实现。如果不同的系统或同一个系统的不同主机之间共享了某个临界资源，往往需要互斥来防止彼此干扰，以保证一致性。</p></div><h2 id="分布式锁的特征"><a href="#分布式锁的特征" class="headerlink" title="分布式锁的特征"></a>分布式锁的特征</h2><p>一把靠谱的分布式锁应该有哪些特征：</p><p><img data-src="https://cdn.jonty.top/img/Distributed-Locking.png" alt="Distributed-Locking"></p><ul><li><strong>互斥性</strong>：任意时刻，只有一个客户端能持有锁</li><li><strong>锁超时释放</strong>：持有锁超时，可以释放，防止不必要的资源浪费，也可以防止死锁</li><li><strong>可重入性</strong>：一个线程如果获取了锁之后，可以再次对其请求加锁</li><li><strong>高性能和高可用</strong>：加锁和解锁需要开销尽可能低，同时也要保证高可用，避免分布式锁失效</li><li><strong>安全性</strong>：锁只能被持有的客户端删除，不能被其他客户端删除</li></ul><h2 id="ABP使用分布式锁"><a href="#ABP使用分布式锁" class="headerlink" title="ABP使用分布式锁"></a>ABP使用分布式锁</h2><blockquote><p>ABP当前的分布式锁实现基于<a href="https://github.com/madelson/DistributedLock">DistributedLock</a>库.</p></blockquote><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装依赖包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abp add-package Volo.Abp.DistributedLocking</span><br></pre></td></tr></table></figure><h3 id="配置提供程序"><a href="#配置提供程序" class="headerlink" title="配置提供程序"></a>配置提供程序</h3><p><a href="https://github.com/madelson/DistributedLock">DistributedLock</a>库对<a href="https://github.com/madelson/DistributedLock/blob/master/docs/DistributedLock.Redis.md">Redis</a>和<a href="https://github.com/madelson/DistributedLock/blob/master/docs/DistributedLock.ZooKeeper.md">ZooKeeper</a>提供<a href="https://github.com/madelson/DistributedLock#implementations">多种实现</a>。</p><p>如果要Redis，需要将<a href="https://www.nuget.org/packages/DistributedLock.Redis">DistributedLock.Redis</a> NuGet包添加到项目中，然后在模块类中注册，如下:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Medallion.Threading;</span><br><span class="line"><span class="keyword">using</span> Medallion.Threading.Redis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AbpDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">DependsOn(</span></span><br><span class="line"><span class="meta">            typeof(AbpDistributedLockingModule)</span></span><br><span class="line"><span class="meta">            //If you have the other dependencies, you should do here</span></span><br><span class="line"><span class="meta">    )</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyModule</span> : <span class="title">AbpModule</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">ServiceConfigurationContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> configuration = context.Services.GetConfiguration();</span><br><span class="line">        </span><br><span class="line">            context.Services.AddSingleton&lt;IDistributedLockProvider&gt;(sp =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> connection = ConnectionMultiplexer</span><br><span class="line">                    .Connect(configuration[<span class="string">&quot;Redis:Configuration&quot;</span>]);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> </span><br><span class="line">                    RedisDistributedSynchronizationProvider(connection.GetDatabase());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置<code>appsettings.json</code>文件</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Redis&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;Configuration&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>有两种方法可以使用分布式锁API：ABP的<code>IAbpDistributedLock</code>抽象和<a href="https://github.com/madelson/DistributedLock">DistributedLock</a>库的API。</p><h4 id="使用IAbpDistributedLock服务"><a href="#使用IAbpDistributedLock服务" class="headerlink" title="使用IAbpDistributedLock服务"></a>使用IAbpDistributedLock服务</h4><p>示例：使用<code>IAbpDistributedLock.TryAcquireAsync</code>方法</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Volo.Abp.DistributedLocking; </span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AbpDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyService</span> : <span class="title">ITransientDependency</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IAbpDistributedLock _distributedLock;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyService</span>(<span class="params">IAbpDistributedLock distributedLock</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _distributedLock = distributedLock;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">MyMethodAsync</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">using</span> (<span class="keyword">var</span> handle = </span><br><span class="line">                         <span class="keyword">await</span> _distributedLock.TryAcquireAsync(<span class="string">&quot;MyLockName&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (handle != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// your code that access the shared resource</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TryAcquireAsync</code>可能无法获取锁. 如果无法获取锁, 则返回<code>null</code>. 在这种情况下, 你不应该访问资源. 如果句柄不为<code>null</code>, 则表示你已获得锁, 并且可以安全地访问资源.</p><p><code>TryAcquireAsync</code>方法拥有以下参数:</p><ul><li><code>name</code> (<code>string</code>, 必须): 锁的唯一名称. 不同的锁命名用于访问不同的资源.</li><li><code>timeout</code> (<code>TimeSpan</code>): 等待获取锁的超时值. 默认值为<code>TimeSpan.Zero</code>, 这意味着如果锁已经被另一个应用程序拥有, 它不会等待.</li><li><code>cancellationToken</code>: 取消令牌可在触发后取消操作.</li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="AbpDistributedLockOptions"><a href="#AbpDistributedLockOptions" class="headerlink" title="AbpDistributedLockOptions"></a>AbpDistributedLockOptions</h4><p><code>AbpDistributedLockOptions</code> 是配置分布式锁的主要选项类.</p><p>示例: 设置应用程序的分布式锁Key前缀</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Configure&lt;AbpDistributedLockOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.KeyPrefix = <span class="string">&quot;MyApp1&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Redis实现分布式锁方案"><a href="#Redis实现分布式锁方案" class="headerlink" title="Redis实现分布式锁方案"></a>Redis实现分布式锁方案</h2><h3 id="方案1：SETNX-EXPIRE"><a href="#方案1：SETNX-EXPIRE" class="headerlink" title="方案1：SETNX + EXPIRE"></a>方案1：SETNX + EXPIRE</h3><p>使用<code>setnx</code>+ <code>expire</code>命令，即先用<code>setnx</code>来抢锁，如果抢到之后再用<code>expire</code>给锁设置一个过期时间，防止忘记释放</p><blockquote><p>SETNX 是SET IF NOT EXISTS的简写.日常命令格式是SETNX key value，如果 key不存在，则SETNX成功返回1，如果这个key已经存在了，则返回0。</p></blockquote><p>假设某电商网站的某商品做秒杀活动，key可以设置为key_resource_id,value设置任意值，伪代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>（jedis.setnx(key_resource_id,lock_value) == <span class="number">1</span>）&#123; <span class="comment">//加锁</span></span><br><span class="line">    expire（key_resource_id，<span class="number">100</span>）; <span class="comment">//设置过期时间</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> something  <span class="comment">//业务请求</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>()&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">finally</span> &#123;</span><br><span class="line">       jedis.del(key_resource_id); <span class="comment">//释放锁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是这个方案中，<code>setnx</code>和<code>expire</code>两个命令分开了，不是原子操作。如果执行完<code>setnx</code>加锁，正要执行<code>expire</code>设置过期时间时，进程crash或者要重启维护了，那么这个锁就“长生不老”了，别的线程永远获取不到锁。</p><h3 id="方案2：SETNX-Value值"><a href="#方案2：SETNX-Value值" class="headerlink" title="方案2：SETNX + Value值"></a>方案2：SETNX + Value值</h3><p>为了解决方案1：发生异常锁得不到释放的场景，可以把过期时间放到<code>setnx</code>的<code>value</code>值里面。如果加锁失败，再拿出value值校验一下即可。</p><p>加锁代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> expires = System.currentTimeMillis() + expireTime; <span class="comment">//系统时间+设置的过期时间</span></span><br><span class="line">String expiresStr = String.valueOf(expires);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果当前锁不存在，返回加锁成功</span></span><br><span class="line"><span class="keyword">if</span> (jedis.setnx(key_resource_id, expiresStr) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 如果锁已经存在，获取锁的过期时间</span></span><br><span class="line">String currentValueStr = jedis.get(key_resource_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果获取到的过期时间，小于系统当前时间，表示已经过期</span></span><br><span class="line"><span class="keyword">if</span> (currentValueStr != <span class="keyword">null</span> &amp;&amp; Long.parseLong(currentValueStr) &lt; System.currentTimeMillis()) &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 锁已过期，获取上一个锁的过期时间，并设置现在锁的过期时间（不了解redis的getSet命令的小伙伴，可以去官网看下哈）</span></span><br><span class="line">    String oldValueStr = jedis.getSet(key_resource_id, expiresStr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (oldValueStr != <span class="keyword">null</span> &amp;&amp; oldValueStr.equals(currentValueStr)) &#123;</span><br><span class="line">         <span class="comment">// 考虑多线程并发的情况，只有一个线程的设置值和当前值相同，它才可以加锁</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//其他情况，均返回加锁失败</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br></pre></td></tr></table></figure><p>这个方案的优点是，巧妙移除<code>expire</code>单独设置过期时间的操作，把过期时间放到<code>setnx</code>的<code>value</code>值里面来。解决了方案一发生异常，锁得不到释放的问题。</p><p>但是这个方案还有别的缺点：</p><ul><li>过期时间是客户端自己生成的（<code>System.currentTimeMillis()</code>是当前系统的时间），必须要求分布式环境下，每个客户端的时间必须同步。</li><li>如果锁过期的时候，并发多个客户端同时请求过来，都执行<code>jedis.getSet()</code>，最终只能有一个客户端加锁成功，但是该客户端锁的过期时间，可能被别的客户端覆盖</li><li>该锁没有保存持有者的唯一标识，可能被别的客户端释放/解锁。</li></ul><h3 id="方案3：使用Lua脚本"><a href="#方案3：使用Lua脚本" class="headerlink" title="方案3：使用Lua脚本"></a>方案3：使用Lua脚本</h3><p>可以使用Lua脚本来保证原子性（包含<code>setnx</code>和<code>expire</code>两条指令），<code>lua</code>脚本如下：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;setnx&#x27;</span>,KEYS[<span class="number">1</span>],ARGV[<span class="number">1</span>]) == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">   redis.call(<span class="string">&#x27;expire&#x27;</span>,KEYS[<span class="number">1</span>],ARGV[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p>加锁代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String lua_scripts = <span class="string">&quot;if redis.call(&#x27;setnx&#x27;,KEYS[1],ARGV[1]) == 1 then&quot;</span> +</span><br><span class="line">            <span class="string">&quot; redis.call(&#x27;expire&#x27;,KEYS[1],ARGV[2]) return 1 else return 0 end&quot;</span>;   </span><br><span class="line">Object result = jedis.eval(lua_scripts, Collections.singletonList(key_resource_id), Collections.singletonList(values));</span><br><span class="line"><span class="comment">//判断是否成功</span></span><br><span class="line"><span class="keyword">return</span> result.equals(<span class="number">1L</span>);</span><br></pre></td></tr></table></figure><h3 id="方案4：SET的扩展命令"><a href="#方案4：SET的扩展命令" class="headerlink" title="方案4：SET的扩展命令"></a>方案4：SET的扩展命令</h3><p>除了使用Lua脚本保证<code>SETNX + EXPIRE</code>两条指令的原子性，=还可以巧用Redis的SET指令扩展参数（<code>SET key value[EX seconds][PX milliseconds][NX|XX]</code>），也是原子性的。</p><blockquote><p>SET key value[ EX seconds ][PX milliseconds][NX|XX]</p><ul><li>NX :表示key不存在的时候，才能set成功，也即保证只有第一个客户端请求才能获得锁，而其他客户端请求只能等其释放锁，才能获取。</li><li>EX seconds :设定key的过期时间，时间单位是秒。</li><li>PX milliseconds: 设定key的过期时间，单位为毫秒</li><li>XX: 仅当key存在时设置值</li></ul></blockquote><p>伪代码示例如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>（jedis.set(key_resource_id, lock_value, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, 100s) == <span class="number">1</span>）&#123; <span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> something  <span class="comment">//业务处理</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>()&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">finally</span> &#123;</span><br><span class="line">       jedis.del(key_resource_id); <span class="comment">//释放锁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方案还是可能存在问题：</p><ul><li>问题一：<strong>锁过期释放了，业务还没执行完</strong>，假设线程a获取锁成功，一直在执行临界区的代码。但是100s过去后，它还没执行完。但是这时候锁已经过期了，此时线程b又请求过来。显然线程b就可以获得锁成功，也开始执行临界区的代码。那么问题就来了，临界区的业务代码都不是严格串行执行。</li><li>问题二：<strong>锁被别的线程误删</strong>，假设线程a执行完后，去释放锁。但是它不知道当前的锁可能是线程b持有的（线程a去释放锁时，有可能过期时间已经到了，此时线程b进来占有了锁）。那线程a就把线程b的锁释放掉了，但是线程b临界区业务代码可能都还没执行完。</li></ul><h3 id="方案5：方案4-唯一随机值"><a href="#方案5：方案4-唯一随机值" class="headerlink" title="方案5：方案4+唯一随机值"></a>方案5：方案4+唯一随机值</h3><p>既然锁可能被别的线程误删，给value值设置一个标记当前线程唯一的随机数，在删除的时候，校验一下。</p><p>伪代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>（jedis.set(key_resource_id, uni_request_id, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, 100s) == <span class="number">1</span>）&#123; <span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> something  <span class="comment">//业务处理</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>()&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">finally</span> &#123;</span><br><span class="line">       <span class="comment">//判断是不是当前线程加的锁,是才释放</span></span><br><span class="line">       <span class="keyword">if</span> (uni_request_id.equals(jedis.get(key_resource_id))) &#123;</span><br><span class="line">        jedis.del(lockKey); <span class="comment">//释放锁</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，判断是不是当前线程加的锁和释放锁不是一个原子操作。如果调用<code>jedis.del()</code>释放锁的时候，可能这把锁已经不属于当前客户端，会解除他人加的锁。</p><p>为了更严谨，一般也是用<code>lua</code>脚本代替:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span> </span><br><span class="line">   <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>,KEYS[<span class="number">1</span>]) </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h3 id="方案6：Redisson框架"><a href="#方案6：Redisson框架" class="headerlink" title="方案6：Redisson框架"></a>方案6：Redisson框架</h3><p>方案5还是可能存在<strong>锁过期释放，业务没执行完</strong>的问题。设想一下，是否可以给获得锁的线程，开启一个定时守护线程，每隔一段时间检查锁是否还存在，存在则对锁的过期时间延长，防止锁过期提前释放。</p><p>当前开源框架<strong>Redisson</strong>解决了这个问题。</p><p><img data-src="https://cdn.jonty.top/img/redisson.png" alt="redisson"></p><p>只要线程一加锁成功，就会启动一个<code>watch dog</code>看门狗，它是一个后台线程，会每隔10秒检查一下，如果线程1还持有锁，那么就会不断的延长锁key的生存时间。因此，<code>Redisson</code>就解决了<strong>锁过期释放，业务没执行完</strong>问题。</p><h3 id="方案7：集群分布式锁Redlock-Redisson"><a href="#方案7：集群分布式锁Redlock-Redisson" class="headerlink" title="方案7：集群分布式锁Redlock+Redisson"></a>方案7：集群分布式锁Redlock+Redisson</h3><p>Redis一般都是集群部署</p><p><img data-src="https://cdn.jonty.top/img/redis-cluster-redisson.png" alt="redis-cluster-redisson"></p><p>如果线程一在Redis的master节点上拿到了锁，但是加锁的key还没同步到slave节点。恰好这时，master节点发生故障，一个slave节点就会升级为master节点。线程二就可以获取同个key的锁啦，但线程一也已经拿到锁了，锁的安全性就没了。</p><p>为了解决这个问题，Redis作者 antirez提出一种高级的分布式锁算法：<code>Redlock</code>：</p><blockquote><p>搞多个Redis master部署，以保证它们不会同时宕掉。并且这些master节点是完全相互独立的，相互之间不存在数据同步。同时，需要确保在这多个master实例上，是与在Redis单实例，使用相同方法来获取和释放锁。</p></blockquote><p>假设当前有5个Redis master节点，在5台服务器上面运行这些Redis实例。</p><p><img data-src="https://cdn.jonty.top/img/redis-cluster.png" alt="redis-cluster"></p><p><code>RedLock</code>的实现步骤:</p><ul><li>获取当前时间，以毫秒为单位。</li><li>按顺序向5个master节点请求加锁。客户端设置网络连接和响应超时时间，并且超时时间要小于锁的失效时间。（假设锁自动失效时间为10秒，则超时时间一般在5-50毫秒之间）。如果超时，跳过该master节点，尽快去尝试下一个master节点。</li><li>客户端使用当前时间减去开始获取锁时间（即步骤1记录的时间），得到获取锁使用的时间。当且仅当超过一半（N/2+1，这里是5/2+1=3个节点）的Redis master节点都获得锁，并且使用的时间小于锁失效时间时，锁才算获取成功。（如上图，10s&gt; 30ms+40ms+50ms+4m0s+50ms）</li><li>如果取到了锁，key的真正有效时间就变，需要减去获取锁所使用的时间。</li><li>如果获取锁失败（没有在至少N/2+1个master实例取到锁，有或者获取锁时间已经超过了有效时间），客户端要在所有的master节点上解锁（即便有些master节点根本就没有加锁成功，也需要解锁，以防止有些漏网之鱼）。</li></ul><p>简化下步骤就是：</p><ul><li>按顺序向5个master节点请求加锁。</li><li>根据设置的超时时间来判断，是不是要跳过该master节点。</li><li>如果大于等于3个节点加锁成功，并且使用的时间小于锁的有效期，即可认定加锁成功啦。</li><li>如果获取锁失败，解锁。</li></ul><blockquote><p><a href="https://redis.io/docs/manual/patterns/distributed-locks/">Distributed Locks with Redis | Redis</a></p></blockquote>]]></content>
    
    
    <summary type="html">Redis实现分布式锁以及在ABP应用</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Redis" scheme="https://jonty.top/tags/Redis/"/>
    
    <category term="分布式锁" scheme="https://jonty.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
    
    <category term="ABP" scheme="https://jonty.top/tags/ABP/"/>
    
  </entry>
  
  <entry>
    <title>给博客装个空调</title>
    <link href="https://jonty.top/2023/06/01/air-conditioner/"/>
    <id>https://jonty.top/2023/06/01/air-conditioner/</id>
    <published>2023-06-01T05:51:11.000Z</published>
    <updated>2023-06-09T07:11:35.365Z</updated>
    
    <content type="html"><![CDATA[<iframe height="840" width="100%" src="https://ac.yunyoujun.cn"></iframe>]]></content>
    
    
    <summary type="html">唯一的缺憾是，没有风。</summary>
    
    
    
    <category term="人生是一场未知的旅行" scheme="https://jonty.top/categories/%E4%BA%BA%E7%94%9F%E6%98%AF%E4%B8%80%E5%9C%BA%E6%9C%AA%E7%9F%A5%E7%9A%84%E6%97%85%E8%A1%8C/"/>
    
    
    <category term="Share" scheme="https://jonty.top/tags/Share/"/>
    
  </entry>
  
  <entry>
    <title>【游记】河南宝泉崖天下</title>
    <link href="https://jonty.top/2023/05/15/travelogue-henan-baoquan/"/>
    <id>https://jonty.top/2023/05/15/travelogue-henan-baoquan/</id>
    <published>2023-05-15T07:20:25.000Z</published>
    <updated>2023-05-15T09:53:57.156Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>太行八百里，最美在薄壁</p></div><img data-src="https://cdn.jonty.top/img/image-20230515153548260.png" alt="宝上路拍摄" style="width:600px" /><p>仍在出差，恰逢周末想着出去逛逛，既然来了河南，那就见见河南的风土人情~</p><p>很早是看短视频发现了这个地方，<code>宝泉崖天下</code>也是今年4月份刚开业的景点，实际上是分为两个部分：大峡谷景区和崖天下景区</p><p>大峡谷景区：大巴+门票大概是100￥</p><p>崖天下景区：门票+索道 160￥</p><p>大峡谷偏向于风景、绿水青山，而崖天下侧重于刺激的体验，比如空中玻璃栈道、悬崖过山车等（而且每个项目还需要单独收费）</p><p>花100大洋进大峡谷逛逛，至于崖天下，详见下文🤪</p><h2 id="宝泉大峡谷"><a href="#宝泉大峡谷" class="headerlink" title="宝泉大峡谷"></a>宝泉大峡谷</h2><p>乘坐大巴大概20分钟到达景区入口，开始一路逛逛逛，最终的目标是峡谷的尽头：飞龙瀑</p><img data-src="https://cdn.jonty.top/img/image-20230515163410673.png" alt="景交车进山" style="width:400px" /><p>途径的乱石滩</p><img data-src="https://cdn.jonty.top/img/image-20230515163944981.png" alt="乱石滩" style="width:400px" /><p>第一道瀑布，还以为到了终点，看路牌到核心景区还有2.5公里</p><img data-src="https://cdn.jonty.top/img/image-20230515164040802.png" alt="飞女瀑" style="width:400px" /><p>干脆飞个无人机探探路，一不小心游玩了全程~由于实在是太饿了（还特别热），乘坐景交车（15￥到景区入口）+大巴返回游客中心</p><p>下图便是大峡谷的终点站：飞龙瀑</p><img data-src="https://cdn.jonty.top/img/image-20230515164658578.png" alt="飞龙瀑" style="width:400px" /><h2 id="网红打卡点"><a href="#网红打卡点" class="headerlink" title="网红打卡点"></a>网红打卡点</h2><p>简单吃点东西，返回游客中心后驾车上山，导航宝上路大概到双泉凹</p><p>下图是导航信息，不得不说，开山路很刺激，特别多回头弯</p><img data-src="https://cdn.jonty.top/img/image-20230515165847700.png" alt="宝上路，86上山了" style="zoom:33%;" /><p>也过隧道后第一道桥，往下大概200m可以看到有几家商店，然后穿过小溪，顺着小路可以一直开到崖边（建议越野车），步行前往大概15min，山顶有小旗子，进入树林后，小路后分成两条路，一条去小庙，向下的一条到观景台</p><p>以下多图预警！！！风景绝美</p><img data-src="https://cdn.jonty.top/img/image-20230515171011523.png" alt="俯瞰全景" style="width:400px" /><p>下图便是打卡点位置，沿着小路可以直达悬崖边，也就是突出的崖顶那~</p><img data-src="https://cdn.jonty.top/img/image-20230515171351991.png" alt="打卡点" style="width:400px" /><img data-src="https://cdn.jonty.top/img/image-20230515171120710.png" alt="打卡点航拍图" style="width:400px" /><p>对比外面的平原地区</p><img data-src="https://cdn.jonty.top/img/image-20230515171500338.png" alt="山脉外的平原" style="width:400px" /><img data-src="https://cdn.jonty.top/img/89e79d1bdfb8062920093312248180d.jpg" alt="俯拍" style="width:400px" /><img data-src="https://cdn.jonty.top/img/image-20230515172210737.png" alt="远眺" style="width:400px" /><p>最后扔一张打卡照，腿软……</p><img data-src="https://cdn.jonty.top/img/image-20230515172643641.png" alt="打卡照" style="width:400px" /><p>打卡完成，下山返程，下山的路边有特别多桃李园，可以尝尝</p><img data-src="https://cdn.jonty.top/img/image-20230515173820585.png" alt="高山与平原" style="width:400px;" /><img data-src="https://cdn.jonty.top/img/image-20230515173832900.png" alt="绝美太行山" style="width:400px"  /><img data-src="https://cdn.jonty.top/img/image-20230515173917653.png" alt="达尔文效应" style="width:400px" /><p>对了，下山后薄壁供销社加油站旁烧烤店的大盘鸡很不错~</p>]]></content>
    
    
    <summary type="html">太行山把最美的一段留给了河南</summary>
    
    
    
    <category term="人生是一场未知的旅行" scheme="https://jonty.top/categories/%E4%BA%BA%E7%94%9F%E6%98%AF%E4%B8%80%E5%9C%BA%E6%9C%AA%E7%9F%A5%E7%9A%84%E6%97%85%E8%A1%8C/"/>
    
    
    <category term="Travelogue" scheme="https://jonty.top/tags/Travelogue/"/>
    
  </entry>
  
  <entry>
    <title>左耳听风</title>
    <link href="https://jonty.top/2023/05/15/coolshell/"/>
    <id>https://jonty.top/2023/05/15/coolshell/</id>
    <published>2023-05-15T07:11:33.000Z</published>
    <updated>2023-05-15T07:18:01.543Z</updated>
    
    <content type="html"><![CDATA[<p>以陈皓老师的座右铭纪念他</p><blockquote><p>芝兰生于深谷，不以无人而不芳<br>君子修身养德，不以穷困而改志</p></blockquote><p><a href="https://coolshell.cn/haoel">关于陈皓 | 酷 壳 - CoolShell</a></p>]]></content>
    
    
    <summary type="html">身体健康才是最大的财富</summary>
    
    
    
    <category term="人生是一场未知的旅行" scheme="https://jonty.top/categories/%E4%BA%BA%E7%94%9F%E6%98%AF%E4%B8%80%E5%9C%BA%E6%9C%AA%E7%9F%A5%E7%9A%84%E6%97%85%E8%A1%8C/"/>
    
    
    <category term="Share" scheme="https://jonty.top/tags/Share/"/>
    
  </entry>
  
  <entry>
    <title>Docker部署Keepalived</title>
    <link href="https://jonty.top/2023/05/11/docker-keepalived-vip-ip/"/>
    <id>https://jonty.top/2023/05/11/docker-keepalived-vip-ip/</id>
    <published>2023-05-11T03:22:13.000Z</published>
    <updated>2023-05-11T06:51:54.878Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>keepalived是集群管理中保证集群高可用的一个服务软件，其功能类似于heartbeat，用来防止单点故障。</p><p>但是它一般不会单独出现，而是与其它负载均衡技术（如lvs、haproxy、nginx）一起工作来达到集群的高可用。</p><h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><ul><li><a href="https://github.com/acassen/keepalived">https://github.com/acassen/keepalived</a> （源码）</li><li><a href="https://keepalived.readthedocs.io/en/latest/">https://keepalived.readthedocs.io/en/latest/</a> （官方）</li><li><a href="https://www.cnblogs.com/centos2017/p/7896780.html">https://www.cnblogs.com/centos2017/p/7896780.html</a></li><li><a href="https://www.cnblogs.com/getbird/p/11703027.html">https://www.cnblogs.com/getbird/p/11703027.html</a></li></ul><h2 id="功能示例"><a href="#功能示例" class="headerlink" title="功能示例"></a>功能示例</h2><h3 id="实现虚拟IP（IP漂移）"><a href="#实现虚拟IP（IP漂移）" class="headerlink" title="实现虚拟IP（IP漂移）"></a>实现虚拟IP（IP漂移）</h3><h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul><li><p><a href="https://github.com/osixia/docker-keepalived">https://github.com/osixia/docker-keepalived</a></p></li><li><p><a href="https://www.jianshu.com/p/c206d5a99274">https://www.jianshu.com/p/c206d5a99274</a></p></li><li><p><a href="https://www.cnblogs.com/zwh0910/p/16518416.html">https://www.cnblogs.com/zwh0910/p/16518416.html</a></p></li></ul><h4 id="场景描述"><a href="#场景描述" class="headerlink" title="场景描述"></a>场景描述</h4><p>使用docker运行keepalived，实现主备切换虚拟IP，实现宕机一台另一台IP自动变更，不影响原有使用，环境配置信息如下</p><h5 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h5><ul><li>虚拟IP: 192.168.2.153</li><li>主节点IP: 192.168.2.151</li><li>备节点IP: 192.168.2.152</li></ul><h5 id="网卡信息"><a href="#网卡信息" class="headerlink" title="网卡信息"></a>网卡信息</h5><ul><li>主节点： ens160</li><li>备节点： ens160</li></ul><h5 id="硬件配置与操作系统版本"><a href="#硬件配置与操作系统版本" class="headerlink" title="硬件配置与操作系统版本"></a>硬件配置与操作系统版本</h5><ul><li>2C+4G+40G</li><li>Ubuntu 18.04</li></ul><h4 id="本地配置路径"><a href="#本地配置路径" class="headerlink" title="本地配置路径"></a>本地配置路径</h4><blockquote><p>此路径根据实际进行调整</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /home/yh/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure><h4 id="配置内容"><a href="#配置内容" class="headerlink" title="配置内容"></a>配置内容</h4><h5 id="主配置"><a href="#主配置" class="headerlink" title="主配置"></a>主配置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   #notification_email &#123;</span><br><span class="line">   #    root@localhost</span><br><span class="line">   #&#125;</span><br><span class="line">   #notification_email_from root@localhost</span><br><span class="line">   #smtp_server 127.0.0.1</span><br><span class="line">   #smtp_connect_timeout 30</span><br><span class="line">   router_id ka1 # 主从id区分</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">#vrrp_strict # 单播模式需要注释</span><br><span class="line">#vrrp_mcast_group4 224.100.100.100 # 单播模式需要注释</span><br><span class="line">   vrrp_iptables</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER  #设为主</span><br><span class="line">    interface ens160  #绑定的网卡名称，按需修改</span><br><span class="line">    virtual_router_id 11  #两台服务器保持一致</span><br><span class="line">    priority 100  # 主服务器优先级高一些</span><br><span class="line">    advert_int 1</span><br><span class="line">    #nopreempt  #注释，表示打开VIP漂移，在优先级高的服务器上线后自动漂移VIP</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 192.168.2.151  # 本机IP</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        192.168.2.152  #单播，通知的目标IP，可以写多个</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.2.153  #要保持和实际IP在同一网段，使用192.168.1.*，否则会因为缺少路由规则，两台服务器直接无法相互ping通</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="从配置"><a href="#从配置" class="headerlink" title="从配置"></a>从配置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   #notification_email &#123;</span><br><span class="line">   #    root@localhost</span><br><span class="line">   #&#125;</span><br><span class="line">   #notification_email_from root@localhost</span><br><span class="line">   #smtp_server 127.0.0.1</span><br><span class="line">   #smtp_connect_timeout 30</span><br><span class="line">   router_id ka2 # 主从id区分</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   #vrrp_strict</span><br><span class="line">   #vrrp_mcast_group4 224.100.100.100</span><br><span class="line">   vrrp_iptables</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP  # 设为备</span><br><span class="line">    interface ens160</span><br><span class="line">    virtual_router_id 11</span><br><span class="line">    priority 80  #优先级低于主</span><br><span class="line">    advert_int 1</span><br><span class="line">    #nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 192.168.2.152  # 本机IP</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        192.168.2.151  #单播，通知的目标IP，可以写多个</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.2.153  #要保持和实际IP在同一网段，使用192.168.1.*，否则会因为缺少路由规则，两台服务器直接无法相互ping通</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主备服务器均使用此命令启动</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 注意此处的keepalived.conf文件路径调整</span></span></span><br><span class="line">docker run -d --restart=always \</span><br><span class="line">--net=host \</span><br><span class="line">-v /root/keepalived/keepalived.conf:/container/service/keepalived/assets/keepalived.conf \</span><br><span class="line">--cap-add=NET_ADMIN \</span><br><span class="line">--cap-add=NET_BROADCAST \</span><br><span class="line">--cap-add=NET_RAW \</span><br><span class="line">--name keepalived \</span><br><span class="line">osixia/keepalived:2.0.20 --copy-service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看日志</span></span><br><span class="line">sudo docker logs -f keepalived</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除keepalived服务</span></span><br><span class="line">sudo docker rm -f keepalived</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除网卡其他ip</span></span><br><span class="line">ip addr del 192.168.2.xx dev ens192</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">使用Docker部署Keepalived实现VIP IP</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Keepalived" scheme="https://jonty.top/tags/Keepalived/"/>
    
  </entry>
  
  <entry>
    <title>Docker注册Gitlab Runner</title>
    <link href="https://jonty.top/2023/05/11/use-docker-register-gitlab-runner/"/>
    <id>https://jonty.top/2023/05/11/use-docker-register-gitlab-runner/</id>
    <published>2023-05-11T03:16:41.000Z</published>
    <updated>2023-05-11T03:18:17.514Z</updated>
    
    <content type="html"><![CDATA[<h3 id="创建变量"><a href="#创建变量" class="headerlink" title="创建变量"></a>创建变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GitLabServer=&#x27;https://git.xxx.com/&#x27; # gitlab服务器地址</span><br><span class="line">GitLabToken=&#x27;xxxxx&#x27; # gitlab 仓库token</span><br><span class="line">GitLabRunnerNamePrefix=&#x27;xxxx&#x27; # gitlab runner 前缀</span><br><span class="line">GitLabRunnerTags=&#x27;xxx&#x27; # gitlab runner tags</span><br><span class="line">GitLabRunnerDesc=&#x27;xxx&#x27; # gitlab runner desc</span><br><span class="line">GitLabRunnerImg=&#x27;gitlab/gitlab-runner:v14.10.1&#x27; # gitlab runner img</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="创建配置数据卷"><a href="#创建配置数据卷" class="headerlink" title="创建配置数据卷"></a>创建配置数据卷</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;</span><br></pre></td></tr></table></figure><h3 id="创建runner"><a href="#创建runner" class="headerlink" title="创建runner"></a>创建runner</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --network host -d --restart always \</span><br><span class="line">-e TZ=Asia/Beijing \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;:/etc/gitlab-runner \</span><br><span class="line">--name &quot;$GitLabRunnerNamePrefix-gitlab-runner&quot; $GitLabRunnerImg</span><br></pre></td></tr></table></figure><h3 id="注册runner"><a href="#注册runner" class="headerlink" title="注册runner"></a>注册runner</h3><blockquote><p><a href="https://docs.gitlab.com/runner/examples/gitlab.html">https://docs.gitlab.com/runner/examples/gitlab.html</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm \</span><br><span class="line">-v &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;:/etc/gitlab-runner \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">--name &quot;$GitLabRunnerNamePrefix-gitlab-runner-register&quot; $GitLabRunnerImg register \</span><br><span class="line">--url &quot;$GitLabServer&quot; \</span><br><span class="line">--registration-token &quot;$GitLabToken&quot; \</span><br><span class="line">--description &quot;$GitLabRunnerDesc&quot; \</span><br><span class="line">--tag-list &quot;$GitLabRunnerTags&quot; \</span><br><span class="line">--non-interactive \</span><br><span class="line">--executor &quot;docker&quot; \</span><br><span class="line">--docker-image docker:23.0.2 \</span><br><span class="line">--docker-privileged=&quot;true&quot; \</span><br><span class="line">--docker-volumes &quot;/certs/client&quot; \</span><br><span class="line">--run-untagged=&quot;true&quot; \</span><br><span class="line">--locked=&quot;false&quot; \</span><br><span class="line">--access-level=&quot;not_protected&quot; \</span><br><span class="line">--docker-volumes /var/run/docker.sock:/var/run/docker.sock </span><br></pre></td></tr></table></figure><h3 id="删除runner"><a href="#删除runner" class="headerlink" title="删除runner"></a>删除runner</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop &quot;$GitLabRunnerNamePrefix-gitlab-runner&quot;</span><br><span class="line">docker rm &quot;$GitLabRunnerNamePrefix-gitlab-runner&quot;</span><br><span class="line">docker volume rm &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">使用Docker注册Gitlab Runner</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Runner" scheme="https://jonty.top/tags/Runner/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab Runner 实现内网自动部署</title>
    <link href="https://jonty.top/2023/05/11/gitlab-runner-intranet-job/"/>
    <id>https://jonty.top/2023/05/11/gitlab-runner-intranet-job/</id>
    <published>2023-05-11T03:02:58.000Z</published>
    <updated>2023-05-11T03:13:29.764Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>最近出差支持项目上线，我们的部署流程是Gitlab CI打包<code>Docker</code>镜像上传到云镜像服务，现场部署由于内网无法访问公网，没办法直接使用脚本实现自动部署(Runner没办法连接~)。目前的情况是，客户提供了一台可访问外网的机器（不提供也可以使用本机），并且在同一个网段，也算是放开一个口子，可以基于这一台机器去实现不同操作，以下便是提供的一种解决思路，减少工作量。</p></div><h2 id="Ubuntu安装Gitlab-Runner"><a href="#Ubuntu安装Gitlab-Runner" class="headerlink" title="Ubuntu安装Gitlab Runner"></a>Ubuntu安装Gitlab Runner</h2><h3 id="添加Gitlab-Runner仓库"><a href="#添加Gitlab-Runner仓库" class="headerlink" title="添加Gitlab Runner仓库"></a>添加Gitlab Runner仓库</h3><p>首先，添加Gitlab Runner的官方仓库，运行一下命令添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103118473.png" alt="image-20230511103118473"></p><h3 id="安装Gitlab-Runner"><a href="#安装Gitlab-Runner" class="headerlink" title="安装Gitlab Runner"></a>安装Gitlab Runner</h3><p>使用<code>apt</code>包管理器安装<code>Gitlab Runner</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gitlab-runner</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103303074.png" alt="image-20230511103303074"></p><h3 id="检查Gitlab-Runner状态"><a href="#检查Gitlab-Runner状态" class="headerlink" title="检查Gitlab Runner状态"></a>检查Gitlab Runner状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner status</span><br></pre></td></tr></table></figure><p>查看Runner运行状态</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@runner:/home/jonty<span class="params">#</span> sudo gitlab-runner status</span><br><span class="line">Runtime platform                                    arch=amd64 os=linux pid=2966404 revision=436955cb version=15.11.0</span><br><span class="line">gitlab-runner: Service is running</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103329891.png" alt="image-20230511103329891"></p><p>成功在Ubuntu安装Gitlab Runner</p><h3 id="卸载Gitlab-Runner"><a href="#卸载Gitlab-Runner" class="headerlink" title="卸载Gitlab Runner"></a>卸载Gitlab Runner</h3><p>停止服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner stop</span><br></pre></td></tr></table></figure><p>卸载服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner uninstall</span><br></pre></td></tr></table></figure><h2 id="注册Gitlab-Runner"><a href="#注册Gitlab-Runner" class="headerlink" title="注册Gitlab Runner"></a>注册Gitlab Runner</h2><p>将Runner注册到Gitlab项目中</p><p>1、获取Gitlab项目注册令牌：</p><ul><li>仓库RUL地址</li><li>仓库注册令牌</li></ul><p><img data-src="https://cdn.jonty.top/img/image-20230511102811943.png" alt="image-20230511102811943"></p><p>2、 注册Gitlab Runner</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner register</span><br></pre></td></tr></table></figure><p>按照提示输入Gitlab 示例的URL、项目的注册令牌以及Runner描述信息、Tag</p><p>这里<code>executor</code>选择<code>shell</code></p><p><img data-src="https://cdn.jonty.top/img/image-20230511103545979.png" alt="image-20230511103545979"></p><p>3、激活Gitlab Runner</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner verify</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103918535.png" alt="image-20230511103918535"></p><p>在项目Runner中可以看到已经注册完成：</p><p><img data-src="https://cdn.jonty.top/img/image-20230511103934445.png" alt="image-20230511103934445"></p><p>4、Gitlab Runner后台运行</p><p>使用“&amp;”将在后台启动，即使关闭 SSH 会话，它仍然存在，只有在服务器重新启动或关闭时才会停止</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner run&amp;</span><br></pre></td></tr></table></figure><h2 id="定义Job"><a href="#定义Job" class="headerlink" title="定义Job"></a>定义Job</h2><p>在<code>.gitlab-ci.yml</code>中定义Job</p><p><code>script</code>执行<code>runner</code>宿主机<code>/bin/bash /images_194/deploy_194.sh</code>脚本，实现<code>曲线救国</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy_dev:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">dependencies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">build_host_dev</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="attr">refs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dev-1.5</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">retry:</span></span><br><span class="line">    <span class="attr">max:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">/bin/bash</span> <span class="string">/images_194/deploy_194.sh</span></span><br></pre></td></tr></table></figure><p>最后贴出连接局域网另一台机器部署的脚本:</p><ul><li>拉取公网镜像，重新打Tag，推送到内网<code>Registry</code></li><li>ssh连接到内网机器，执行部署脚本</li><li>完成部署</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">imgAppNames=(<span class="string">&#x27;server&#x27;</span> <span class="string">&#x27;vue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">AppFile</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">  WMS_VERSION=dev</span><br><span class="line">  REGISTRY_URL=ccr.ccs.tencentyun.com/xxx</span><br><span class="line">  LocalRegistryUrl=192.168.2.89:8232</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$WMS_VERSION</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$REGISTRY_URL</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$LocalRegistryUrl</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;正在处理应用镜像&quot;</span></span><br><span class="line">  PullImage</span><br><span class="line">  TagImage</span><br><span class="line">  PushImage</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">PullImage</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> imgName <span class="keyword">in</span> <span class="variable">$&#123;imgAppNames[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  targetImgName=<span class="string">&quot;<span class="variable">$REGISTRY_URL</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;正在拉取: <span class="variable">$targetImgName</span>&quot;</span></span><br><span class="line">  docker pull <span class="variable">$targetImgName</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;拉取完成&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">TagImage</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> imgName <span class="keyword">in</span> <span class="variable">$&#123;imgAppNames[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  targetImgName=<span class="string">&quot;<span class="variable">$REGISTRY_URL</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line">  localImgName=<span class="string">&quot;<span class="variable">$LocalRegistryUrl</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;正在打标签: <span class="variable">$targetImgName</span>&quot;</span></span><br><span class="line">  docker tag <span class="variable">$targetImgName</span> <span class="variable">$localImgName</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;打标签完成&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">PushImage</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> imgName <span class="keyword">in</span> <span class="variable">$&#123;imgAppNames[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  localImgName=<span class="string">&quot;<span class="variable">$LocalRegistryUrl</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;正在推送: <span class="variable">$localImgName</span>&quot;</span></span><br><span class="line">  docker push <span class="variable">$localImgName</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;推送完成&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AppFile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置参数</span></span><br><span class="line">REMOTE_IP=<span class="string">&quot;192.168.2.194&quot;</span></span><br><span class="line">REMOTE_USER=<span class="string">&quot;wms&quot;</span></span><br><span class="line">REMOTE_PASS=<span class="string">&quot;wmstest@123&quot;</span></span><br><span class="line">ROOT_PASS=<span class="string">&quot;wmstest@123&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到远程服务器</span></span><br><span class="line">sshpass -p <span class="string">&quot;<span class="variable">$&#123;REMOTE_PASS&#125;</span>&quot;</span> ssh -o StrictHostKeyChecking=no -l <span class="string">&quot;<span class="variable">$&#123;REMOTE_USER&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;REMOTE_IP&#125;</span>&quot;</span> &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 切换到 root 用户</span></span><br><span class="line"><span class="string">echo &quot;$&#123;ROOT_PASS&#125;&quot; | sudo -S su</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 切换到指定目录</span></span><br><span class="line"><span class="string">cd /home/wms/wms_app/07_app</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;移除当前服务：test_app&quot;</span></span><br><span class="line"><span class="string">sudo docker stack rm test_app</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sleep 20s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;启动服务中...&quot;</span></span><br><span class="line"><span class="string"># 执行 run.sh</span></span><br><span class="line"><span class="string">sudo /bin/bash ./run.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;服务启动完成...&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sudo docker service ls -f name=test_app</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 退出 root 用户</span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 退出远程服务器</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Gitlab CI 曲线救国 实现内网自动部署</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Gitlab" scheme="https://jonty.top/tags/Gitlab/"/>
    
    <category term="Runner" scheme="https://jonty.top/tags/Runner/"/>
    
  </entry>
  
  <entry>
    <title>Git 的奇技淫巧</title>
    <link href="https://jonty.top/2023/05/04/git-tips/"/>
    <id>https://jonty.top/2023/05/04/git-tips/</id>
    <published>2023-05-04T07:59:04.000Z</published>
    <updated>2023-05-04T08:02:07.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Git 常用命令集合，Fork 自 <a href="https://github.com/git-tips/tips">tips</a> 项目</p><p>分享自：<a href="https://github.com/521xueweihan/git-tips">521xueweihan/git-tips: Git的奇技淫巧 (github.com)</a></p></blockquote><p>Git 是一个分布式版本管理工具，版本管理工具就是大家在写东西的时候都用过 <strong>回撤</strong>这个功能，但是回撤只能回撤几步，假如想要找回我三天之前的修改，光用回撤是找不回来的。而<strong>版本管理工具能记录每次的修改</strong>，只要提交到版本仓库，就可以找到之前任何时刻的状态（文本状态）。</p><p>下面的内容就是列举了常用的 Git 命令和一些小技巧，可以通过页面内查找的方式 <code>Ctrl/Command+f</code> 进行快速查找。</p><h2 id="开卷必读"><a href="#开卷必读" class="headerlink" title="开卷必读"></a>开卷必读</h2><p><em>如果之前未使用过 Git，可以学习 <a href="https://rogerdudler.github.io/git-guide/index.zh.html">Git 小白教程</a>入门</em></p><ol><li><strong>一定要先测试命令的效果后</strong>，再用于工作环境中，以防造成不能弥补的后果！<strong>到时候别拿着砍刀来找我</strong></li><li>所有的命令都在 <code>git version 2.7.4 (Apple Git-66)</code> 下测试通过</li><li>统一概念：<ul><li>工作区：改动（增删文件和内容）</li><li>暂存区：输入命令：<code>git add 改动的文件名</code>，此次改动就放到了 ‘暂存区’</li><li>本地仓库(简称：本地)：输入命令：<code>git commit 此次修改的描述</code>，此次改动就放到了本地仓库，每个 commit，我叫它为一个版本。</li><li>远程仓库(简称：远程)：输入命令：<code>git push 远程仓库</code>，此次改动就放到了远程仓库（GitHub 等)</li><li>commit-id：输出命令：<code>git log</code>，最上面那行 <code>commit xxxxxx</code>，后面的字符串就是 commit-id</li></ul></li><li>如果喜欢这个项目，欢迎 Star、提交 Pr、<a href="https://github.com/521xueweihan/git-tips/issues">反馈问题</a>😊</li></ol><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul><li><a href="#%E8%84%91%E5%9B%BE">脑图</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E5%B8%AE%E5%8A%A9%E4%BF%A1%E6%81%AF">展示帮助信息</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E7%8A%B6%E6%80%81">回到远程仓库的状态</a></li><li><a href="#%E9%87%8D%E8%AE%BE%E7%AC%AC%E4%B8%80%E4%B8%AA-commit">重设第一个commit</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E5%86%B2%E7%AA%81%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8">查看冲突文件列表</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%92%8C%E6%9A%82%E5%AD%98%E5%8C%BA%E7%9A%84%E4%B8%8D%E5%90%8C">展示工作区和暂存区的不同</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%9A%82%E5%AD%98%E5%8C%BA%E5%92%8C%E6%9C%80%E8%BF%91%E7%89%88%E6%9C%AC%E7%9A%84%E4%B8%8D%E5%90%8C">展示暂存区和最近版本的不同</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%9A%82%E5%AD%98%E5%8C%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%92%8C%E6%9C%80%E8%BF%91%E7%89%88%E6%9C%AC%E7%9A%84%E4%B8%8D%E5%90%8C">展示暂存区、工作区和最近版本的不同</a></li><li><a href="#%E5%BF%AB%E9%80%9F%E5%88%87%E6%8D%A2%E5%88%B0%E4%B8%8A%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF">快速切换到上一个分支</a></li><li><a href="#%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E5%90%88%E5%B9%B6%E5%88%B0-master-%E7%9A%84%E5%88%86%E6%94%AF">删除已经合并到 master 的分支</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E6%83%85%E5%86%B5">展示本地分支关联远程仓库的情况</a></li><li><a href="#%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">关联远程分支</a></li><li><a href="#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">列出所有远程分支</a></li><li><a href="#%E5%88%97%E5%87%BA%E6%9C%AC%E5%9C%B0%E5%92%8C%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">列出本地和远程分支</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF%E5%92%8C%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB">查看远程分支和本地分支的对应关系</a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E5%88%A0%E9%99%A4%E4%BA%86%E5%88%86%E6%94%AF%E6%9C%AC%E5%9C%B0%E4%B9%9F%E6%83%B3%E5%88%A0%E9%99%A4">远程删除了分支本地也想删除</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%88%87%E6%8D%A2%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">创建并切换到本地分支</a></li><li><a href="#%E4%BB%8E%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%88%87%E6%8D%A2%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">从远程分支中创建并切换到本地分支</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">删除本地分支</a></li><li><a href="#%E5%88%A0%E9%99%A4%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">删除远程分支</a></li><li><a href="#%E9%87%8D%E5%91%BD%E5%90%8D%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">重命名本地分支</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E6%A0%87%E7%AD%BE">查看标签</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E6%A0%87%E7%AD%BE%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF">查看标签详细信息</a></li><li><a href="#%E6%9C%AC%E5%9C%B0%E5%88%9B%E5%BB%BA%E6%A0%87%E7%AD%BE">本地创建标签</a></li><li><a href="#%E6%8E%A8%E9%80%81%E6%A0%87%E7%AD%BE%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">推送标签到远程仓库</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E6%A0%87%E7%AD%BE">删除本地标签</a></li><li><a href="#%E5%88%A0%E9%99%A4%E8%BF%9C%E7%A8%8B%E6%A0%87%E7%AD%BE">删除远程标签</a></li><li><a href="#%E5%88%87%E5%9B%9E%E5%88%B0%E6%9F%90%E4%B8%AA%E6%A0%87%E7%AD%BE">切回到某个标签</a></li><li><a href="#%E6%94%BE%E5%BC%83%E5%B7%A5%E4%BD%9C%E5%8C%BA%E7%9A%84%E4%BF%AE%E6%94%B9">放弃工作区的修改</a></li><li><a href="#%E6%81%A2%E5%A4%8D%E5%88%A0%E9%99%A4%E7%9A%84%E6%96%87%E4%BB%B6">恢复删除的文件</a></li><li><a href="#%E4%BB%A5%E6%96%B0%E5%A2%9E%E4%B8%80%E4%B8%AA-commit-%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%98%E5%8E%9F%E6%9F%90%E4%B8%80%E4%B8%AA-commit-%E7%9A%84%E4%BF%AE%E6%94%B9">以新增一个 commit 的方式还原某一个 commit 的修改</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E6%9F%90%E4%B8%AA-commit-%E7%9A%84%E7%8A%B6%E6%80%81%E5%B9%B6%E5%88%A0%E9%99%A4%E5%90%8E%E9%9D%A2%E7%9A%84-commit">回到某个 commit 的状态，并删除后面的 commit</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E4%B8%8A%E4%B8%80%E4%B8%AA-commit-%E7%9A%84%E6%8F%8F%E8%BF%B0">修改上一个 commit 的描述</a></li><li><a href="#%E6%9F%A5%E7%9C%8B-commit-%E5%8E%86%E5%8F%B2">查看 commit 历史</a></li><li><a href="#%E6%98%BE%E7%A4%BA%E6%9C%AC%E5%9C%B0%E6%9B%B4%E6%96%B0%E8%BF%87-head-%E7%9A%84-git-%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95">显示本地更新过 HEAD 的 git 命令记录</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E4%BD%9C%E8%80%85%E5%90%8D">修改作者名</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84-url">修改远程仓库的 url</a></li><li><a href="#%E5%A2%9E%E5%8A%A0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">增加远程仓库</a></li><li><a href="#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">列出所有远程仓库</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E4%B8%A4%E4%B8%AA%E6%98%9F%E6%9C%9F%E5%86%85%E7%9A%84%E6%94%B9%E5%8A%A8">查看两个星期内的改动</a></li><li><a href="#%E6%8A%8A-A-%E5%88%86%E6%94%AF%E7%9A%84%E6%9F%90%E4%B8%80%E4%B8%AA-commit%E6%94%BE%E5%88%B0-B-%E5%88%86%E6%94%AF%E4%B8%8A">把 A 分支的某一个 commit，放到 B 分支上</a></li><li><a href="#%E7%BB%99-git-%E5%91%BD%E4%BB%A4%E8%B5%B7%E5%88%AB%E5%90%8D">给 git 命令起别名</a></li><li><a href="#%E5%AD%98%E5%82%A8%E5%BD%93%E5%89%8D%E7%9A%84%E4%BF%AE%E6%94%B9%E4%BD%86%E4%B8%8D%E7%94%A8%E6%8F%90%E4%BA%A4-commit">存储当前的修改，但不用提交 commit</a></li><li><a href="#%E4%BF%9D%E5%AD%98%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%E5%8C%85%E6%8B%AC-untracked-%E7%9A%84%E6%96%87%E4%BB%B6">保存当前状态，包括 untracked 的文件</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-stashes">展示所有 stashes</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E6%9F%90%E4%B8%AA-stash-%E7%9A%84%E7%8A%B6%E6%80%81">回到某个 stash 的状态</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA-stash-%E7%9A%84%E7%8A%B6%E6%80%81%E5%B9%B6%E5%88%A0%E9%99%A4%E8%BF%99%E4%B8%AA-stash">回到最后一个 stash 的状态，并删除这个 stash</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E7%9A%84-stash">删除所有的 stash</a></li><li><a href="#%E4%BB%8E-stash-%E4%B8%AD%E6%8B%BF%E5%87%BA%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%AE%E6%94%B9">从 stash 中拿出某个文件的修改</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-tracked-%E7%9A%84%E6%96%87%E4%BB%B6">展示所有 tracked 的文件</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-untracked-%E7%9A%84%E6%96%87%E4%BB%B6">展示所有 untracked 的文件</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89%E5%BF%BD%E7%95%A5%E7%9A%84%E6%96%87%E4%BB%B6">展示所有忽略的文件</a></li><li><a href="#%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4-untracked-%E7%9A%84%E6%96%87%E4%BB%B6">强制删除 untracked 的文件</a></li><li><a href="#%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4-untracked-%E7%9A%84%E7%9B%AE%E5%BD%95">强制删除 untracked 的目录</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E7%AE%80%E5%8C%96%E7%9A%84-commit-%E5%8E%86%E5%8F%B2">展示简化的 commit 历史</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E6%AE%B5%E4%BB%A3%E7%A0%81%E6%98%AF%E8%B0%81%E5%86%99%E7%9A%84">查看某段代码是谁写的</a></li><li><a href="#%E6%8A%8A%E6%9F%90%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF%E5%AF%BC%E5%87%BA%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6">把某一个分支导出成一个文件</a></li><li><a href="#%E4%BB%8E%E5%8C%85%E4%B8%AD%E5%AF%BC%E5%85%A5%E5%88%86%E6%94%AF">从包中导入分支</a></li><li><a href="#%E6%89%A7%E8%A1%8C-rebase-%E4%B9%8B%E5%89%8D%E8%87%AA%E5%8A%A8-stash">执行 rebase 之前自动 stash</a></li><li><a href="#%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E6%A0%B9%E6%8D%AE-ID-%E6%8B%89%E4%B8%8B%E6%9F%90%E4%B8%80%E7%8A%B6%E6%80%81-%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">从远程仓库根据 ID，拉下某一状态，到本地分支</a></li><li><a href="#%E8%AF%A6%E7%BB%86%E5%B1%95%E7%A4%BA%E4%B8%80%E8%A1%8C%E4%B8%AD%E7%9A%84%E4%BF%AE%E6%94%B9">详细展示一行中的修改</a></li><li><a href="#%E6%B8%85%E9%99%A4-gitignore-%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AE%B0%E5%BD%95%E7%9A%84%E6%96%87%E4%BB%B6">清除 <code>.gitignore</code> 文件中记录的文件</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-alias-%E5%92%8C-configs">展示所有 alias 和 configs</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E5%BF%BD%E7%95%A5%E7%9A%84%E6%96%87%E4%BB%B6">展示忽略的文件</a></li><li><a href="#commit-%E5%8E%86%E5%8F%B2%E4%B8%AD%E6%98%BE%E7%A4%BA-Branch1-%E6%9C%89%E7%9A%84%E4%BD%86%E6%98%AF-Branch2-%E6%B2%A1%E6%9C%89-commit">commit 历史中显示 Branch1 有的，但是 Branch2 没有 commit</a></li><li><a href="#%E5%9C%A8-commit-log-%E4%B8%AD%E6%98%BE%E7%A4%BA-GPG-%E7%AD%BE%E5%90%8D">在 commit log 中显示 GPG 签名</a></li><li><a href="#%E5%88%A0%E9%99%A4%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE">删除全局设置</a></li><li><a href="#%E6%96%B0%E5%BB%BA%E5%B9%B6%E5%88%87%E6%8D%A2%E5%88%B0%E6%96%B0%E5%88%86%E6%94%AF%E4%B8%8A%E5%90%8C%E6%97%B6%E8%BF%99%E4%B8%AA%E5%88%86%E6%94%AF%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95-commit">新建并切换到新分支上，同时这个分支没有任何 commit</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E4%BB%BB%E6%84%8F%E5%88%86%E6%94%AF%E6%9F%90%E4%B8%80%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9">展示任意分支某一文件的内容</a></li><li><a href="#clone-%E4%B8%8B%E6%9D%A5%E6%8C%87%E5%AE%9A%E7%9A%84%E5%8D%95%E4%B8%80%E5%88%86%E6%94%AF">clone 下来指定的单一分支</a></li><li><a href="#clone-%E6%9C%80%E6%96%B0%E4%B8%80%E6%AC%A1%E6%8F%90%E4%BA%A4">clone 最新一次提交</a></li><li><a href="#%E5%BF%BD%E7%95%A5%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E6%94%B9%E5%8A%A8">忽略某个文件的改动</a></li><li><a href="#%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90%E5%8F%98%E5%8C%96">忽略文件的权限变化</a></li><li><a href="#%E4%BB%A5%E6%9C%80%E5%90%8E%E6%8F%90%E4%BA%A4%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89-Git-%E5%88%86%E6%94%AF">以最后提交的顺序列出所有 Git 分支</a></li><li><a href="#%E5%9C%A8-commit-log-%E4%B8%AD%E6%9F%A5%E6%89%BE%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9">在 commit log 中查找相关内容</a></li><li><a href="#%E6%8A%8A%E6%9A%82%E5%AD%98%E5%8C%BA%E7%9A%84%E6%8C%87%E5%AE%9A-file-%E6%94%BE%E5%88%B0%E5%B7%A5%E4%BD%9C%E5%8C%BA%E4%B8%AD">把暂存区的指定 file 放到工作区中</a></li><li><a href="#%E5%BC%BA%E5%88%B6%E6%8E%A8%E9%80%81">强制推送</a></li><li><a href="#git-%E9%85%8D%E7%BD%AE-http-%E5%92%8C-socks-%E4%BB%A3%E7%90%86">git 配置 http 和 socks 代理</a></li><li><a href="#git-%E9%85%8D%E7%BD%AE-ssh-%E4%BB%A3%E7%90%86">git 配置 ssh 代理</a></li><li><a href="#%E4%BC%98%E9%9B%85%E7%9A%84Commit%E4%BF%A1%E6%81%AF">优雅的Commit信息</a></li><li><a href="#commit%E5%B7%A5%E5%85%B7">commit工具</a></li><li><a href="#%E5%A3%B0%E6%98%8E">声明</a></li></ul><h2 id="展示帮助信息"><a href="#展示帮助信息" class="headerlink" title="展示帮助信息"></a>展示帮助信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">help</span> -g</span><br></pre></td></tr></table></figure><p>The command output as below:</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">The common Git guides are:</span><br><span class="line">   attributes          Defining attributes per path</span><br><span class="line">   <span class="keyword">cli</span>                 Git command-<span class="keyword">line</span> interface and conventions</span><br><span class="line">   core-<span class="keyword">tutorial</span>       A Git core <span class="keyword">tutorial</span> <span class="keyword">for</span> developers</span><br><span class="line">   cvs-migration       Git <span class="keyword">for</span> CVS users</span><br><span class="line">   diffcore            Tweaking diff output</span><br><span class="line">   everyday            A useful minimum <span class="keyword">set</span> of commands <span class="keyword">for</span> Everyday Git</span><br><span class="line">   glossary            A Git Glossary</span><br><span class="line">   hooks               Hooks used <span class="keyword">by</span> Git</span><br><span class="line">   ignore              Specifies intentionally untracked files to ignore</span><br><span class="line">   modules             Defining submodule properties</span><br><span class="line">   namespaces          Git namespaces</span><br><span class="line">   repository-layout    Git Repository Layout</span><br><span class="line">   revisions           Specifying revisions and ranges <span class="keyword">for</span> Git</span><br><span class="line">   <span class="keyword">tutorial</span>            A <span class="keyword">tutorial</span> introduction to Git</span><br><span class="line">   <span class="keyword">tutorial</span>-2          A <span class="keyword">tutorial</span> introduction to Git: part <span class="keyword">two</span></span><br><span class="line">   workflows           <span class="keyword">An</span> overview of recommended workflows with Git</span><br><span class="line"></span><br><span class="line">&#x27;git <span class="keyword">help</span> -a&#x27; and &#x27;git <span class="keyword">help</span> -<span class="keyword">g</span>&#x27; <span class="keyword">list</span> available subcommands and some concept guides. See &#x27;git <span class="keyword">help</span> &lt;command&gt;&#x27; or &#x27;git <span class="keyword">help</span> &lt;concept&gt;&#x27; to <span class="keyword">read</span> <span class="keyword">about</span> a specific subcommand or concept.</span><br></pre></td></tr></table></figure><h2 id="回到远程仓库的状态"><a href="#回到远程仓库的状态" class="headerlink" title="回到远程仓库的状态"></a>回到远程仓库的状态</h2><p>抛弃本地所有的修改，回到远程仓库的状态。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch --all &amp;&amp; git reset --hard origin/master</span><br></pre></td></tr></table></figure><h2 id="重设第一个-commit"><a href="#重设第一个-commit" class="headerlink" title="重设第一个 commit"></a>重设第一个 commit</h2><p>也就是把所有的改动都重新放回工作区，并<strong>清空所有的 commit</strong>，这样就可以重新提交第一个 commit 了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-ref -d HEAD</span><br></pre></td></tr></table></figure><h2 id="查看冲突文件列表"><a href="#查看冲突文件列表" class="headerlink" title="查看冲突文件列表"></a>查看冲突文件列表</h2><p>展示工作区的冲突文件列表</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --name-only --diff-filter=U</span><br></pre></td></tr></table></figure><h2 id="展示工作区和暂存区的不同"><a href="#展示工作区和暂存区的不同" class="headerlink" title="展示工作区和暂存区的不同"></a>展示工作区和暂存区的不同</h2><p>输出<strong>工作区</strong>和<strong>暂存区</strong>的 different (不同)。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure><p>还可以展示本地仓库中任意两个 commit 之间的文件变动：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff &lt;commit-id&gt; &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="展示暂存区和最近版本的不同"><a href="#展示暂存区和最近版本的不同" class="headerlink" title="展示暂存区和最近版本的不同"></a>展示暂存区和最近版本的不同</h2><p>输出<strong>暂存区</strong>和本地最近的版本 (commit) 的 different (不同)。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure><h2 id="展示暂存区、工作区和最近版本的不同"><a href="#展示暂存区、工作区和最近版本的不同" class="headerlink" title="展示暂存区、工作区和最近版本的不同"></a>展示暂存区、工作区和最近版本的不同</h2><p>输出<strong>工作区</strong>、<strong>暂存区</strong> 和本地最近的版本 (commit) 的 different (不同)。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD</span><br></pre></td></tr></table></figure><h2 id="快速切换到上一个分支"><a href="#快速切换到上一个分支" class="headerlink" title="快速切换到上一个分支"></a>快速切换到上一个分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -</span><br></pre></td></tr></table></figure><h2 id="删除已经合并到-master-的分支"><a href="#删除已经合并到-master-的分支" class="headerlink" title="删除已经合并到 master 的分支"></a>删除已经合并到 master 的分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --merged master | grep -v <span class="string">&#x27;^\*\|  master&#x27;</span> | xargs -n 1 git branch -d</span><br></pre></td></tr></table></figure><h2 id="展示本地分支关联远程仓库的情况"><a href="#展示本地分支关联远程仓库的情况" class="headerlink" title="展示本地分支关联远程仓库的情况"></a>展示本地分支关联远程仓库的情况</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br></pre></td></tr></table></figure><h2 id="关联远程分支"><a href="#关联远程分支" class="headerlink" title="关联远程分支"></a>关联远程分支</h2><p>关联之后，<code>git branch -vv</code> 就可以展示关联的远程分支名了，同时推送到远程仓库直接：<code>git push</code>，不需要指定远程仓库了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -u origin/mybranch</span><br></pre></td></tr></table></figure><p>或者在 push 时加上 <code>-u</code> 参数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin/mybranch -u</span><br></pre></td></tr></table></figure><h2 id="列出所有远程分支"><a href="#列出所有远程分支" class="headerlink" title="列出所有远程分支"></a>列出所有远程分支</h2><p>-r 参数相当于：remote</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure><h2 id="列出本地和远程分支"><a href="#列出本地和远程分支" class="headerlink" title="列出本地和远程分支"></a>列出本地和远程分支</h2><p>-a 参数相当于：all</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure><h2 id="查看远程分支和本地分支的对应关系"><a href="#查看远程分支和本地分支的对应关系" class="headerlink" title="查看远程分支和本地分支的对应关系"></a>查看远程分支和本地分支的对应关系</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote show origin</span><br></pre></td></tr></table></figure><h2 id="远程删除了分支本地也想删除"><a href="#远程删除了分支本地也想删除" class="headerlink" title="远程删除了分支本地也想删除"></a>远程删除了分支本地也想删除</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote prune origin</span><br></pre></td></tr></table></figure><h2 id="创建并切换到本地分支"><a href="#创建并切换到本地分支" class="headerlink" title="创建并切换到本地分支"></a>创建并切换到本地分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="从远程分支中创建并切换到本地分支"><a href="#从远程分支中创建并切换到本地分支" class="headerlink" title="从远程分支中创建并切换到本地分支"></a>从远程分支中创建并切换到本地分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branch-name&gt; origin/&lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="删除本地分支"><a href="#删除本地分支" class="headerlink" title="删除本地分支"></a>删除本地分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;local-branchname&gt;</span><br></pre></td></tr></table></figure><h2 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete &lt;remote-branchname&gt;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :&lt;remote-branchname&gt;</span><br></pre></td></tr></table></figure><h2 id="重命名本地分支"><a href="#重命名本地分支" class="headerlink" title="重命名本地分支"></a>重命名本地分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m &lt;new-branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="查看标签"><a href="#查看标签" class="headerlink" title="查看标签"></a>查看标签</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure><p>展示当前分支的最近的 tag</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git describe --tags --abbrev=0</span><br></pre></td></tr></table></figure><h2 id="查看标签详细信息"><a href="#查看标签详细信息" class="headerlink" title="查看标签详细信息"></a>查看标签详细信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -ln</span><br></pre></td></tr></table></figure><h2 id="本地创建标签"><a href="#本地创建标签" class="headerlink" title="本地创建标签"></a>本地创建标签</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag &lt;version-number&gt;</span><br></pre></td></tr></table></figure><p>默认 tag 是打在最近的一次 commit 上，如果需要指定 commit 打 tag：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a &lt;version-number&gt; -m <span class="string">&quot;v1.0 发布(描述)&quot;</span> &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="推送标签到远程仓库"><a href="#推送标签到远程仓库" class="headerlink" title="推送标签到远程仓库"></a>推送标签到远程仓库</h2><p>首先要保证本地创建好了标签才可以推送标签到远程仓库：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;local-version-number&gt;</span><br></pre></td></tr></table></figure><p>一次性推送所有标签，同步到远程仓库：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure><h2 id="删除本地标签"><a href="#删除本地标签" class="headerlink" title="删除本地标签"></a>删除本地标签</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -d &lt;tag-name&gt;</span><br></pre></td></tr></table></figure><h2 id="删除远程标签"><a href="#删除远程标签" class="headerlink" title="删除远程标签"></a>删除远程标签</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete tag &lt;tagname&gt;</span><br></pre></td></tr></table></figure><h2 id="切回到某个标签"><a href="#切回到某个标签" class="headerlink" title="切回到某个标签"></a>切回到某个标签</h2><p>一般上线之前都会打 tag，就是为了防止上线后出现问题，方便快速回退到上一版本。下面的命令是回到某一标签下的状态：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b branch_name tag_name</span><br></pre></td></tr></table></figure><h2 id="放弃工作区的修改"><a href="#放弃工作区的修改" class="headerlink" title="放弃工作区的修改"></a>放弃工作区的修改</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;file-name&gt;</span><br></pre></td></tr></table></figure><p>放弃所有修改：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout .</span><br></pre></td></tr></table></figure><h2 id="恢复删除的文件"><a href="#恢复删除的文件" class="headerlink" title="恢复删除的文件"></a>恢复删除的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-list -n 1 HEAD -- &lt;file_path&gt; <span class="comment">#得到 deleting_commit</span></span><br><span class="line"></span><br><span class="line">git checkout &lt;deleting_commit&gt;^ -- &lt;file_path&gt; <span class="comment">#回到删除文件 deleting_commit 之前的状态</span></span><br></pre></td></tr></table></figure><h2 id="以新增一个-commit-的方式还原某一个-commit-的修改"><a href="#以新增一个-commit-的方式还原某一个-commit-的修改" class="headerlink" title="以新增一个 commit 的方式还原某一个 commit 的修改"></a>以新增一个 commit 的方式还原某一个 commit 的修改</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="回到某个-commit-的状态，并删除后面的-commit"><a href="#回到某个-commit-的状态，并删除后面的-commit" class="headerlink" title="回到某个 commit 的状态，并删除后面的 commit"></a>回到某个 commit 的状态，并删除后面的 commit</h2><p>和 revert 的区别：reset 命令会抹去某个 commit id 之后的所有 commit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git reset &lt;commit-id&gt;  <span class="comment">#默认就是-mixed参数。</span></span><br><span class="line"></span><br><span class="line">git reset --mixed HEAD^  <span class="comment">#回退至上个版本，它将重置HEAD到另外一个commit,并且重置暂存区以便和HEAD相匹配，但是也到此为止。工作区不会被更改。</span></span><br><span class="line"></span><br><span class="line">git reset --soft HEAD~3  <span class="comment">#回退至三个版本之前，只回退了commit的信息，暂存区和工作区与回退之前保持一致。如果还要提交，直接commit即可  </span></span><br><span class="line"></span><br><span class="line">git reset --hard &lt;commit-id&gt;  <span class="comment">#彻底回退到指定commit-id的状态，暂存区和工作区也会变为指定commit-id版本的内容</span></span><br></pre></td></tr></table></figure><h2 id="修改上一个-commit-的描述"><a href="#修改上一个-commit-的描述" class="headerlink" title="修改上一个 commit 的描述"></a>修改上一个 commit 的描述</h2><p>如果暂存区有改动，同时也会将暂存区的改动提交到上一个 commit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><h2 id="查看-commit-历史"><a href="#查看-commit-历史" class="headerlink" title="查看 commit 历史"></a>查看 commit 历史</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><h2 id="查看某段代码是谁写的"><a href="#查看某段代码是谁写的" class="headerlink" title="查看某段代码是谁写的"></a>查看某段代码是谁写的</h2><p>blame 的意思为‘责怪’，你懂的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git blame &lt;file-name&gt;</span><br></pre></td></tr></table></figure><h2 id="显示本地更新过-HEAD-的-git-命令记录"><a href="#显示本地更新过-HEAD-的-git-命令记录" class="headerlink" title="显示本地更新过 HEAD 的 git 命令记录"></a>显示本地更新过 HEAD 的 git 命令记录</h2><p>每次更新了 HEAD 的 git 命令比如 commit、amend、cherry-pick、reset、revert 等都会被记录下来（不限分支），就像 shell 的 history 一样。<br>这样你可以 reset 到任何一次更新了 HEAD 的操作之后，而不仅仅是回到当前分支下的某个 commit 之后的状态。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br></pre></td></tr></table></figure><h2 id="修改作者名"><a href="#修改作者名" class="headerlink" title="修改作者名"></a>修改作者名</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend --author=<span class="string">&#x27;Author Name &lt;email@address.com&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="修改远程仓库的-url"><a href="#修改远程仓库的-url" class="headerlink" title="修改远程仓库的 url"></a>修改远程仓库的 url</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url origin &lt;URL&gt;</span><br></pre></td></tr></table></figure><h2 id="增加远程仓库"><a href="#增加远程仓库" class="headerlink" title="增加远程仓库"></a>增加远程仓库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &lt;remote-url&gt;</span><br></pre></td></tr></table></figure><h2 id="列出所有远程仓库"><a href="#列出所有远程仓库" class="headerlink" title="列出所有远程仓库"></a>列出所有远程仓库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br></pre></td></tr></table></figure><h2 id="查看两个星期内的改动"><a href="#查看两个星期内的改动" class="headerlink" title="查看两个星期内的改动"></a>查看两个星期内的改动</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git whatchanged --since=<span class="string">&#x27;2 weeks ago&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="把-A-分支的某一个-commit，放到-B-分支上"><a href="#把-A-分支的某一个-commit，放到-B-分支上" class="headerlink" title="把 A 分支的某一个 commit，放到 B 分支上"></a>把 A 分支的某一个 commit，放到 B 分支上</h2><p>这个过程需要 <code>cherry-pick</code> 命令，<a href="http://sg552.iteye.com/blog/1300713#bc2367928">参考</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;branch-name&gt; &amp;&amp; git cherry-pick &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="给-git-命令起别名"><a href="#给-git-命令起别名" class="headerlink" title="给 git 命令起别名"></a>给 git 命令起别名</h2><p>简化命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git config --global <span class="built_in">alias</span>.&lt;handle&gt; &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line">比如：git status 改成 git st，这样可以简化命令</span><br><span class="line"></span><br><span class="line">git config --global alias.st status</span><br></pre></td></tr></table></figure><h2 id="存储当前的修改，但不用提交-commit"><a href="#存储当前的修改，但不用提交-commit" class="headerlink" title="存储当前的修改，但不用提交 commit"></a>存储当前的修改，但不用提交 commit</h2><p>详解可以参考<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137602359178794d966923e5c4134bc8bf98dfb03aea3000">廖雪峰老师的 git 教程</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure><h2 id="保存当前状态，包括-untracked-的文件"><a href="#保存当前状态，包括-untracked-的文件" class="headerlink" title="保存当前状态，包括 untracked 的文件"></a>保存当前状态，包括 untracked 的文件</h2><p>untracked 文件：新建的文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash -u</span><br></pre></td></tr></table></figure><h2 id="展示所有-stashes"><a href="#展示所有-stashes" class="headerlink" title="展示所有 stashes"></a>展示所有 stashes</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure><h2 id="回到某个-stash-的状态"><a href="#回到某个-stash-的状态" class="headerlink" title="回到某个 stash 的状态"></a>回到某个 stash 的状态</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply &lt;stash@&#123;n&#125;&gt;</span><br></pre></td></tr></table></figure><h2 id="回到最后一个-stash-的状态，并删除这个-stash"><a href="#回到最后一个-stash-的状态，并删除这个-stash" class="headerlink" title="回到最后一个 stash 的状态，并删除这个 stash"></a>回到最后一个 stash 的状态，并删除这个 stash</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure><h2 id="删除所有的-stash"><a href="#删除所有的-stash" class="headerlink" title="删除所有的 stash"></a>删除所有的 stash</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash clear</span><br></pre></td></tr></table></figure><h2 id="从-stash-中拿出某个文件的修改"><a href="#从-stash-中拿出某个文件的修改" class="headerlink" title="从 stash 中拿出某个文件的修改"></a>从 stash 中拿出某个文件的修改</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;stash@&#123;n&#125;&gt; -- &lt;file-path&gt;</span><br></pre></td></tr></table></figure><h2 id="展示所有-tracked-的文件"><a href="#展示所有-tracked-的文件" class="headerlink" title="展示所有 tracked 的文件"></a>展示所有 tracked 的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files -t</span><br></pre></td></tr></table></figure><h2 id="展示所有-untracked-的文件"><a href="#展示所有-untracked-的文件" class="headerlink" title="展示所有 untracked 的文件"></a>展示所有 untracked 的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files --others</span><br></pre></td></tr></table></figure><h2 id="展示所有忽略的文件"><a href="#展示所有忽略的文件" class="headerlink" title="展示所有忽略的文件"></a>展示所有忽略的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files --others -i --exclude-standard</span><br></pre></td></tr></table></figure><h2 id="强制删除-untracked-的文件"><a href="#强制删除-untracked-的文件" class="headerlink" title="强制删除 untracked 的文件"></a>强制删除 untracked 的文件</h2><p>可以用来删除新建的文件。如果不指定文件文件名，则清空所有工作的 untracked 文件。<code>clean</code> 命令，<strong>注意两点</strong>：</p><ol><li>clean 后，删除的文件无法找回</li><li>不会影响 tracked 的文件的改动，只会删除 untracked 的文件</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean &lt;file-name&gt; -f</span><br></pre></td></tr></table></figure><h2 id="强制删除-untracked-的目录"><a href="#强制删除-untracked-的目录" class="headerlink" title="强制删除 untracked 的目录"></a>强制删除 untracked 的目录</h2><p>可以用来删除新建的目录，<strong>注意</strong>:这个命令也可以用来删除 untracked 的文件。详情见上一条</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean &lt;directory-name&gt; -df</span><br></pre></td></tr></table></figure><h2 id="展示简化的-commit-历史"><a href="#展示简化的-commit-历史" class="headerlink" title="展示简化的 commit 历史"></a>展示简化的 commit 历史</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=oneline --graph --decorate --all</span><br></pre></td></tr></table></figure><h2 id="把某一个分支导出成一个文件"><a href="#把某一个分支导出成一个文件" class="headerlink" title="把某一个分支导出成一个文件"></a>把某一个分支导出成一个文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git bundle create &lt;file&gt; &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="从包中导入分支"><a href="#从包中导入分支" class="headerlink" title="从包中导入分支"></a>从包中导入分支</h2><p>新建一个分支，分支内容就是上面 <code>git bundle create</code> 命令导出的内容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> repo.bundle &lt;repo-dir&gt; -b &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="执行-rebase-之前自动-stash"><a href="#执行-rebase-之前自动-stash" class="headerlink" title="执行 rebase 之前自动 stash"></a>执行 rebase 之前自动 stash</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --autostash</span><br></pre></td></tr></table></figure><h2 id="从远程仓库根据-ID，拉下某一状态，到本地分支"><a href="#从远程仓库根据-ID，拉下某一状态，到本地分支" class="headerlink" title="从远程仓库根据 ID，拉下某一状态，到本地分支"></a>从远程仓库根据 ID，拉下某一状态，到本地分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin pull/&lt;id&gt;/head:&lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="详细展示一行中的修改"><a href="#详细展示一行中的修改" class="headerlink" title="详细展示一行中的修改"></a>详细展示一行中的修改</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --word-diff</span><br></pre></td></tr></table></figure><h2 id="清除-gitignore-文件中记录的文件"><a href="#清除-gitignore-文件中记录的文件" class="headerlink" title="清除 gitignore 文件中记录的文件"></a>清除 gitignore 文件中记录的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean -X -f</span><br></pre></td></tr></table></figure><h2 id="展示所有-alias-和-configs"><a href="#展示所有-alias-和-configs" class="headerlink" title="展示所有 alias 和 configs"></a>展示所有 alias 和 configs</h2><p><strong>注意：</strong> config 分为：当前目录（local）和全局（golbal）的 config，默认为当前目录的 config</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="built_in">local</span> --list (当前目录)</span><br><span class="line">git config --global --list (全局)</span><br></pre></td></tr></table></figure><h2 id="展示忽略的文件"><a href="#展示忽略的文件" class="headerlink" title="展示忽略的文件"></a>展示忽略的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status --ignored</span><br></pre></td></tr></table></figure><h2 id="commit-历史中显示-Branch1-有的，但是-Branch2-没有-commit"><a href="#commit-历史中显示-Branch1-有的，但是-Branch2-没有-commit" class="headerlink" title="commit 历史中显示 Branch1 有的，但是 Branch2 没有 commit"></a>commit 历史中显示 Branch1 有的，但是 Branch2 没有 commit</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> Branch1 ^Branch2</span><br></pre></td></tr></table></figure><h2 id="在-commit-log-中显示-GPG-签名"><a href="#在-commit-log-中显示-GPG-签名" class="headerlink" title="在 commit log 中显示 GPG 签名"></a>在 commit log 中显示 GPG 签名</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --show-signature</span><br></pre></td></tr></table></figure><h2 id="删除全局设置"><a href="#删除全局设置" class="headerlink" title="删除全局设置"></a>删除全局设置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> &lt;entry-name&gt;</span><br></pre></td></tr></table></figure><h2 id="新建并切换到新分支上，同时这个分支没有任何-commit"><a href="#新建并切换到新分支上，同时这个分支没有任何-commit" class="headerlink" title="新建并切换到新分支上，同时这个分支没有任何 commit"></a>新建并切换到新分支上，同时这个分支没有任何 commit</h2><p>相当于保存修改，但是重写 commit 历史</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --orphan &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="展示任意分支某一文件的内容"><a href="#展示任意分支某一文件的内容" class="headerlink" title="展示任意分支某一文件的内容"></a>展示任意分支某一文件的内容</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show &lt;branch-name&gt;:&lt;file-name&gt;</span><br></pre></td></tr></table></figure><h2 id="clone-下来指定的单一分支"><a href="#clone-下来指定的单一分支" class="headerlink" title="clone 下来指定的单一分支"></a>clone 下来指定的单一分支</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b &lt;branch-name&gt; --single-branch https://github.com/user/repo.git</span><br></pre></td></tr></table></figure><h2 id="clone-最新一次提交"><a href="#clone-最新一次提交" class="headerlink" title="clone 最新一次提交"></a>clone 最新一次提交</h2><p>只会 clone 最近一次提交，将减少 clone 时间</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/user/repo.git</span><br></pre></td></tr></table></figure><h2 id="忽略某个文件的改动"><a href="#忽略某个文件的改动" class="headerlink" title="忽略某个文件的改动"></a>忽略某个文件的改动</h2><p>关闭 track 指定文件的改动，也就是 Git 将不会在记录这个文件的改动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --assume-unchanged path/to/file</span><br></pre></td></tr></table></figure><p>恢复 track 指定文件的改动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --no-assume-unchanged path/to/file</span><br></pre></td></tr></table></figure><h2 id="忽略文件的权限变化"><a href="#忽略文件的权限变化" class="headerlink" title="忽略文件的权限变化"></a>忽略文件的权限变化</h2><p>不再将文件的权限变化视作改动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config core.fileMode <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="以最后提交的顺序列出所有-Git-分支"><a href="#以最后提交的顺序列出所有-Git-分支" class="headerlink" title="以最后提交的顺序列出所有 Git 分支"></a>以最后提交的顺序列出所有 Git 分支</h2><p>最新的放在最上面</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git for-each-ref --sort=-committerdate --format=<span class="string">&#x27;%(refname:short)&#x27;</span> refs/heads/</span><br></pre></td></tr></table></figure><h2 id="在-commit-log-中查找相关内容"><a href="#在-commit-log-中查找相关内容" class="headerlink" title="在 commit log 中查找相关内容"></a>在 commit log 中查找相关内容</h2><p>通过 grep 查找，given-text：所需要查找的字段</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --all --grep=<span class="string">&#x27;&lt;given-text&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="把暂存区的指定-file-放到工作区中"><a href="#把暂存区的指定-file-放到工作区中" class="headerlink" title="把暂存区的指定 file 放到工作区中"></a>把暂存区的指定 file 放到工作区中</h2><p>不添加参数，默认是 <code>-mixed</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset &lt;file-name&gt;</span><br></pre></td></tr></table></figure><h2 id="强制推送"><a href="#强制推送" class="headerlink" title="强制推送"></a>强制推送</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f &lt;remote-name&gt; &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="git-配置-http-和-socks-代理"><a href="#git-配置-http-和-socks-代理" class="headerlink" title="git 配置 http 和 socks 代理"></a>git 配置 http 和 socks 代理</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global https.proxy <span class="string">&#x27;http://127.0.0.1:8001&#x27;</span>   <span class="comment"># 适用于 privoxy 将 socks 协议转为 http 协议的 http 端口</span></span><br><span class="line">git config --global http.proxy <span class="string">&#x27;http://127.0.0.1:8001&#x27;</span></span><br><span class="line">git config --global socks.proxy <span class="string">&quot;127.0.0.1:1080&quot;</span></span><br></pre></td></tr></table></figure><h2 id="git-配置-ssh-代理"><a href="#git-配置-ssh-代理" class="headerlink" title="git 配置 ssh 代理"></a>git 配置 ssh 代理</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.ssh/config</span><br><span class="line">Host gitlab.com</span><br><span class="line">ProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p    <span class="comment"># 直接使用 shadowsocks 提供的 socks5 代理端口</span></span><br><span class="line"></span><br><span class="line">Host github.com</span><br><span class="line">ProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p    </span><br></pre></td></tr></table></figure><h2 id="脑图"><a href="#脑图" class="headerlink" title="脑图"></a>脑图</h2><p><img data-src="https://cdn.jonty.top/img/git.png"></p><h2 id="优雅的Commit信息"><a href="#优雅的Commit信息" class="headerlink" title="优雅的Commit信息"></a>优雅的Commit信息</h2><p>使用<a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines">Angular团队提交规范</a></p><p>主要有以下组成</p><ul><li>标题行: 必填, 描述主要修改类型和内容</li><li>主题内容: 描述为什么修改, 做了什么样的修改, 以及开发的思路等等</li><li>页脚注释: 放 Breaking Changes 或 Closed Issues</li></ul><p>常用的修改项</p><ul><li>type: commit 的类型</li><li>feat: 新特性</li><li>fix: 修改问题</li><li>refactor: 代码重构</li><li>docs: 文档修改</li><li>style: 代码格式修改, 注意不是 css 修改</li><li>test: 测试用例修改</li><li>chore: 其他修改, 比如构建流程, 依赖管理.</li><li>scope: commit 影响的范围, 比如: route, component, utils, build…</li><li>subject: commit 的概述</li><li>body: commit 具体修改内容, 可以分为多行</li><li>footer: 一些备注, 通常是 BREAKING CHANGE 或修复的 bug 的链接.</li></ul><h2 id="commit工具"><a href="#commit工具" class="headerlink" title="commit工具"></a>commit工具</h2><p>可以使用<a href="https://github.com/commitizen/cz-cli">cz-cli</a>工具代替 <code>git commit</code></p><p>全局安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g commitizen cz-conventional-changelog</span><br><span class="line"></span><br><span class="line">echo &#x27;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&#x27; &gt; ~/.czrc</span><br></pre></td></tr></table></figure><p>全局安装后使用 <code>git cz</code> 代替 <code>git commit</code>就可以了,如下图</p><p><img data-src="https://cdn.jonty.top/img/gitcz.png"></p><h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p><a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh"><img alt="知识共享许可协议" style="border-width: 0" data-src="https://licensebuttons.net/l/by-nc-nd/4.0/88x31.png"></a><br>本作品采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">署名-非商业性使用-禁止演绎 4.0 国际</a> 进行许可。</p><p><strong><a href="#%E7%9B%AE%E5%BD%95">⬆ 返回顶部</a></strong></p>]]></content>
    
    
    <summary type="html">常用的 Git 命令和一些小技巧</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="Share" scheme="https://jonty.top/tags/Share/"/>
    
    <category term="Git" scheme="https://jonty.top/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-07】- Blazor学生列表组件</title>
    <link href="https://jonty.top/2023/04/26/blazor-component/"/>
    <id>https://jonty.top/2023/04/26/blazor-component/</id>
    <published>2023-04-26T02:59:52.000Z</published>
    <updated>2023-04-26T03:10:32.130Z</updated>
    
    <content type="html"><![CDATA[<p>在此节中，我们实现一个Blazor组件—<strong>StudentList</strong>组件。</p><p>组件用于展示学生列表，如下图所示：</p><p><img data-src="https://cdn.jonty.top/img/202204241334464.png" alt="image-20220424133441270"></p><h2 id="StudentList-razor"><a href="#StudentList-razor" class="headerlink" title="StudentList.razor"></a>StudentList.razor</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/students&quot;</span><br><span class="line">@inherits StudentListListBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>StudentList<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    @foreach (var student in Students)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card m-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>@student.FirstName @student.LastName<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;card-img-top imageThumbnail&quot;</span> <span class="attr">src</span>=<span class="string">&quot;@student.PhotoPath&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer text-center&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger m-1&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h2><h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 指定当我们导航到此路径时显示此组件</span></span><br><span class="line">@page <span class="string">&quot;/&quot;</span> </span><br><span class="line">    </span><br><span class="line"><span class="meta"># 定义此组件的基类</span></span><br><span class="line">@inherits SutdentListBase </span><br></pre></td></tr></table></figure><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><p>使用 Bootstrap Card 显示， 为了遍历学生列表，我们使用了<code> foreach</code> 循环</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    @foreach (var student in Students)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card m-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>@student.FirstName @student.LastName<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;card-img-top imageThumbnail&quot;</span> <span class="attr">src</span>=<span class="string">&quot;@student.PhotoPath&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer text-center&quot;</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger m-1&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="StudentListBase"><a href="#StudentListBase" class="headerlink" title="StudentListBase"></a>StudentListBase</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Components;</span><br><span class="line"><span class="keyword">using</span> StudentManagement.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">StudentManagement.Web.Pages</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentListListBase</span>: <span class="title">ComponentBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> IEnumerable&lt;Student&gt; Students &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">OnInitializedAsync</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadStudents();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">base</span>.OnInitializedAsync();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadStudents</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> s1 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">1</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;John&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Hastings&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;David@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1980</span>, <span class="number">10</span>, <span class="number">5</span>),</span><br><span class="line">            Gender = Gender.Male,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123;ClassId = <span class="number">1</span>, ClassName = <span class="string">&quot;计算机科学&quot;</span>&#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/john.png&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> s2 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">2</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;Sam&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Galloway&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;Sam@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1981</span>, <span class="number">12</span>, <span class="number">22</span>),</span><br><span class="line">            Gender = Gender.Male,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123; ClassId = <span class="number">2</span>, ClassName = <span class="string">&quot;软件工程&quot;</span> &#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/sam.jpg&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> s3 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">3</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;Mary&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;mary@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1979</span>, <span class="number">11</span>, <span class="number">11</span>),</span><br><span class="line">            Gender = Gender.Female,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123; ClassId = <span class="number">3</span>, ClassName = <span class="string">&quot;通信工程&quot;</span> &#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/mary.png&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> s4 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">4</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;Sara&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Longway&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;sara@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1982</span>, <span class="number">9</span>, <span class="number">23</span>),</span><br><span class="line">            Gender = Gender.Female,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123; ClassId = <span class="number">3</span>, ClassName = <span class="string">&quot;移动互联网&quot;</span> &#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/sara.png&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Students = <span class="keyword">new</span> List&lt;Student&gt; &#123;s1, s2, s3, s4&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Blazor 组件有多种生命周期方法。<strong>OnInitializedAsync</strong>是较常用的生命周期方法。我们重写此方法用来加载学生数据。 </p><p>目前，我们在组件中<strong>硬编码</strong>了学生数据。随着我们课程的深入，我们将学习如何通过调用 RESTful API从数据库中加载这些数据。</p><p><strong>MainLayout.razor</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@inherits LayoutComponentBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>S<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">NavMenu</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;content px-4&quot;</span>&gt;</span></span><br><span class="line">            @Body</span><br><span class="line">        <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>并在<code>Site.css</code>中添加头像的样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Site<span class="selector-class">.css</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.imageThumbnail</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Blazor系列翻译07- Blazor学生列表组件</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-06】- Blazor模型类</title>
    <link href="https://jonty.top/2023/04/26/blazor-model-classes/"/>
    <id>https://jonty.top/2023/04/26/blazor-model-classes/</id>
    <published>2023-04-26T02:49:16.000Z</published>
    <updated>2023-04-26T02:52:22.636Z</updated>
    
    <content type="html"><![CDATA[<p>按照教程进度，我们会开发一个员工管理系统，可以实现创建、读取、更新和删除员工等操作。</p><p>以下是需要的模型类：</p><ol><li>Student</li><li>ClassName</li><li>Gender</li></ol><h2 id="创建模型类"><a href="#创建模型类" class="headerlink" title="创建模型类"></a>创建模型类</h2><p>创建一个新的.NET类库项目，将项目命名为StudentManagement.Models。将解决方案命名为BlazorTutorial。</p><p><img data-src="https://cdn.jonty.top/img/202204191015829.png" alt="image-20220419101511752"></p><p>并创建对应的模型类</p><p><strong>Student.cs</strong>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 学生</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 学生Id</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> StudentId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 姓</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> FirstName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 名</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> LastName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 邮箱</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Email &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 生日</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> DateTime DateOfBrith &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 性别</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Gender Gender &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 班级</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> StudentClass StudentClass &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 头像地址</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> PhotoPath &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>StudentName.cs</strong>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 班级</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 班级Id</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> ClassId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 班级名称</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ClassName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Gender.cs</strong>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Gender</span><br><span class="line">&#123;</span><br><span class="line">    Male,</span><br><span class="line">    Female,</span><br><span class="line">    Other</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>选择创建类库项目，可以在不同的项目中<strong>重用</strong>这些模型</p><p><img data-src="https://cdn.jonty.top/img/202204191439071.png" alt="image-20220419143947010"></p><p>我们会在<strong>Blazor Web</strong>应用程序中使用这些模型，随着课程的推进，我们会创建ASP.NET Core RESTful API，这些服务会提供<strong>Blazor</strong> 项目所需要的数据。同样的，我们的RESTful API项目中也会使用这些模型类。</p><h2 id="创建Blazor-Web项目"><a href="#创建Blazor-Web项目" class="headerlink" title="创建Blazor Web项目"></a>创建Blazor Web项目</h2><p>我们再创建一个新的<code>Blazor Server</code>项目，将其命名为<code>StudentManagement.Web</code>，这是一个允许我们对员工信息进行增删改查操作的Web应用程序。</p><p><code>StudentManagement.Web</code>依赖我们上面创建的模型类库，我们在<code>StudentManagement.Web</code>中添加对<code>StudentManagement.Models</code>项目的引用，并将<code>StudentManagement.Web</code>设为<strong>启动项目</strong></p><p><img data-src="https://cdn.jonty.top/img/202204191440212.png" alt="image-20220419144054166"></p><p>从<code>StudentManagement.Web</code>项目中删除以下文件和文件夹</p><ul><li>Data文件夹</li><li>Pages/Counter.razor</li><li>Pages/FetchData.razor</li><li>Pages/index.razor</li><li>Shared/SurveyPrompt.razor</li></ul><p>更改<strong>Program.cs</strong>：</p><p>删除以下引用</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StudentManagement.Web.Data;</span><br></pre></td></tr></table></figure><p>删除以下代码：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddSingleton&lt;WeatherForecastService&gt;();</span><br></pre></td></tr></table></figure><p>如果你跟着步骤操作，现在的项目目录应该是这样的：</p><p><img data-src="https://cdn.jonty.top/img/202204191444223.png" alt="image-20220419144412162"></p><h2 id="创建StudentList组件"><a href="#创建StudentList组件" class="headerlink" title="创建StudentList组件"></a>创建StudentList组件</h2><p>在<code>StudentManagement.Web</code>项目中，右键单击<code>Pages</code>文件夹添加一个新的<strong>razor</strong>组件。命名为<code>StudentList.razor</code>组件，我们使用这个组件显示员工列表。</p><p>在<code>StudentList.razor</code>组件中包含以下<code>@page</code>指令，用来告诉Blazor在我们导航到<code>/student</code>路径时展示此组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/student&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>StudentList<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="更改NvaMenu-razor组件"><a href="#更改NvaMenu-razor组件" class="headerlink" title="更改NvaMenu.razor组件"></a>更改NvaMenu.razor组件</h2><p><strong>删除</strong>以下2个导航栏菜单项</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item px-3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;oi oi-plus&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> Counter</span><br><span class="line">    <span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item px-3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;fetchdata&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;oi oi-list-rich&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> Fetch data</span><br><span class="line">    <span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Blazor系列翻译06-Blazor模型类</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-05】-拆分Razor组件</title>
    <link href="https://jonty.top/2023/04/26/split-razor-component/"/>
    <id>https://jonty.top/2023/04/26/split-razor-component/</id>
    <published>2023-04-26T02:44:25.000Z</published>
    <updated>2023-04-26T02:45:54.298Z</updated>
    
    <content type="html"><![CDATA[<p>有2种方法可以将Razor组件HTML和C#代码拆分为各自独立的文件。</p><ol><li>部分类方法（partial class）</li><li>基类方法（base class）</li></ol><h2 id="单文件"><a href="#单文件" class="headerlink" title="单文件"></a>单文件</h2><p>HTML和C#代码都在<strong>一个文件</strong>中</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// Counter.razor</span><br><span class="line"></span><br><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private int currentCount = 0;</span><br><span class="line"></span><br><span class="line">    private void IncrementCount()</span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="部分类文件"><a href="#部分类文件" class="headerlink" title="部分类文件"></a>部分类文件</h2><p>HTML保留在<code>Counter.razor</code>文件中。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Counter.razor</span><br><span class="line"></span><br><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在编译组件时，会生成一个与组件文件同名的类。我们手动创建一个<code>Counter.razor.cs</code>的类文件，并在其中包含<code>@code</code>中的代码</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Counter.razor.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Counter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> currentCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">IncrementCount</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="基类方法"><a href="#基类方法" class="headerlink" title="基类方法"></a>基类方法</h2><p>和部分类一样，使用基类方法HTML依旧保留在<code>Counter.razor</code>文件中。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Counter.razor</span><br><span class="line"></span><br><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把C#代码移动到单独的类<code>CounterBase</code>中，你可以将类名命名为任何名称，按照约定应该是组件名称+Base后缀</p><p>在示例中，组件名称为<code>Counter</code>，所以基类命名为<code>CounterBase</code>，继承自内置的<code>ComponentBase</code>类。此类位于Microsoft.AspNetCore.Components命名空间中。</p><p>最后，在Counter.razor文件中不要忘记包含以下继承指令。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inherits CounterBase</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line">@inherits CounterBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">role</span>=<span class="string">&quot;status&quot;</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Blazor系列翻译05-拆分Razor组件</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>Docker-修改docker数据存储目录</title>
    <link href="https://jonty.top/2023/04/12/how-to-change-docker-data-folder-configuration/"/>
    <id>https://jonty.top/2023/04/12/how-to-change-docker-data-folder-configuration/</id>
    <published>2023-04-12T03:39:18.000Z</published>
    <updated>2023-04-12T03:43:26.756Z</updated>
    
    <content type="html"><![CDATA[<p>1、停止正在运行的docker：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop docker</span><br></pre></td></tr></table></figure><p>2、创建文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/docker </span><br></pre></td></tr></table></figure><p>3、移动/var/lib/docker/目录到新目录中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/lib/docker/* /data/docker</span><br></pre></td></tr></table></figure><p>4、修改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>增加以下配置即可</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;data-root&quot;</span>: <span class="string">&quot;/data/docker&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>v17.05.0 之后使用 data-root，旧版本请使用 graph</p></blockquote><p>5、删除/var/lib/docker/目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure><p>6、启动docker：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>如果启动失败，参考 <a href="https://medium.com/developer-space/how-to-change-docker-data-folder-configuration-33d372669056">How To Change Docker Data Folder Configuration</a> 进行更改</p><h3 id="其他方式："><a href="#其他方式：" class="headerlink" title="其他方式："></a>其他方式：</h3><p>通过软链接修改docker数据存储目录，软连接/data/docker 到 /var/lib/里：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /data/docker /var/lib/docker</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Docker：如何修改docker数据存储目录</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Shell" scheme="https://jonty.top/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-04】- Razor组件</title>
    <link href="https://jonty.top/2023/03/23/razor-components/"/>
    <id>https://jonty.top/2023/03/23/razor-components/</id>
    <published>2023-03-23T02:08:52.000Z</published>
    <updated>2023-03-23T02:20:23.981Z</updated>
    
    <content type="html"><![CDATA[<ul><li>Blazor是一个<strong>组件驱动</strong>的框架，这意味着组件是<strong>Blazor</strong>应用的<strong>基本构建块</strong>。</li><li>它们可以嵌套、复用，甚至可以在多个项目之间共享。</li><li>组件文件的扩展名为 <strong>.razor</strong></li></ul><p>下面是我们新建项目时创建的<strong>Counter</strong>组件</p><p><code>Counter.razor</code></p><hr><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">role</span>=<span class="string">&quot;status&quot;</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private int currentCount = 0;</span><br><span class="line"></span><br><span class="line">    private void IncrementCount()</span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 可以看到这是两种语言的结合</p><ul><li>HTML标记定义了组件的用户界面（即外观）。</li><li>定义处理逻辑的C#代码</li></ul><p><img data-src="https://cdn.jonty.top/img/image-20220412230131617.png" alt="image-20220412230131617"></p><p>在这个例子中：</p><ol><li>每次单击按钮时，C#代码都会将<code>currentCount</code>变量的值增加<code>1</code></li><li>单击按钮时，必须调用<code>IncrementCount()</code>函数，使用<code>onclick</code>属性调用的</li><li>在HTML中，要访问私有变量<code>currentCount</code>，需要使用<code>@</code>符号</li><li>C#代码放在<code>@code</code>块中，可以有多个<code>@code</code>块</li></ol><p>编译应用程序时，将 HTML 和 C# 代码转换为组件类。生成的类的名称与组件文件的名称匹配。组件文件名必须<strong>以大写字符开头</strong>。如果添加以小写字符开头的组件文件，则代码将无法编译，并且会出现以下编译器错误。</p><blockquote><p><strong>组件名称不能以小写字符开头</strong></p></blockquote><p><img data-src="https://cdn.jonty.top/img/image-20220412225942530.png" alt="image-20220412225942530"></p><p>请记住，Blazor Server项目在服务器上运行。</p><ul><li>在服务器和客户端浏览器之间建立 SignalR 连接。在最初呈现计数器组件之后并且当用户单击按钮时。</li><li>有关单击事件的信息通过 SignalR 连接发送到服务器。</li><li>作为对该事件的响应，组件会重新生成，但不会将整个 HTML 发送回客户端。它只是差异，即渲染树中的差异，在这种情况下，是发送到客户端浏览器的新计数器值。</li><li>由于仅更新页面的更改部分而不是重新加载和更新整个页面，因此应用程序感觉更快，对用户的响应更快。</li></ul><h2 id="嵌套Blazor组件"><a href="#嵌套Blazor组件" class="headerlink" title="嵌套Blazor组件"></a>嵌套Blazor组件</h2><p>呈现Counter组件的一种方法是在浏览器中导航到<code>/counter</code>。此路径由组件顶部的<code>@page</code>指令指定。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br></pre></td></tr></table></figure><p>一个组件也可以使用 HTML 语法嵌套在另一个组件中。例如，使用**&lt; Counter /&gt;<strong>将</strong>Counter**组件嵌套在其他组件中。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@page <span class="string">&quot;/test&quot;</span></span><br><span class="line">&lt;PageTitle&gt;test&lt;/PageTitle&gt;</span><br><span class="line">&lt;h3&gt;test&lt;/h3&gt;</span><br><span class="line">    </span><br><span class="line">@* 嵌套组件 *@</span><br><span class="line">&lt;Counter&gt;&lt;/Counter&gt;</span><br><span class="line">@code &#123;&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20220412230557300.png" alt="image-20220412230557300"></p><h2 id="组件存放位置"><a href="#组件存放位置" class="headerlink" title="组件存放位置"></a>组件存放位置</h2><p>组件可以放在Blazor项目中任何位置。将生成网页的组件放置在<strong>Pages</strong>文件夹中并将可重用的非页面组件放置在<strong>Shared</strong>文件夹中是一种很好的做法。</p><p>如果需要，还可以将它们放在项目中完全不同的<strong>自定义文件夹</strong>中。</p><h2 id="拆分组件HTML和C-代码"><a href="#拆分组件HTML和C-代码" class="headerlink" title="拆分组件HTML和C#代码"></a>拆分组件HTML和C#代码</h2><p>在此示例中，HTML 和 C# 都在一个文件中。这对于像这个计数器这样的简单组件来说很好，但是将 HTML 和 C# 代码分离到它们自己的文件中通常是一个好习惯。它不仅从维护的角度来看很好，而且也很容易进行单元测试。</p><p>有 2 种方法，将组件 HTML 和 C# 代码拆分为各自独立的文件。</p><ol><li>部分文件方法</li><li>基类方法</li></ol><p>我们将在下一节中讨论这两种方法。</p>]]></content>
    
    
    <summary type="html">Blazor系列翻译04-Razor组件</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-03】- Blazor项目结构</title>
    <link href="https://jonty.top/2023/03/23/blazor-project-structure/"/>
    <id>https://jonty.top/2023/03/23/blazor-project-structure/</id>
    <published>2023-03-23T02:07:10.000Z</published>
    <updated>2023-03-23T02:20:23.981Z</updated>
    
    <content type="html"><![CDATA[<p>了解ASP.NET Core Blazor项目中的文件和文件夹</p><p><img data-src="https://cdn.jonty.top/img/image-20220411230426968.png" alt="image-20220411230426968"></p><h2 id="Program-cs"><a href="#Program-cs" class="headerlink" title="Program.cs"></a>Program.cs</h2><p>应用程序启动代码，用于：</p><ul><li>配置应用所需服务</li><li>请求管道注册中间件</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> StudentManagement.Api.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add services to the container.</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line">builder.Services.AddEndpointsApiExplorer();</span><br><span class="line">builder.Services.AddSwaggerGen();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configure the HTTP request pipeline.</span></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseSwagger();</span><br><span class="line">    app.UseSwaggerUI();</span><br><span class="line">&#125;</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure><h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p><code>builder</code> 是一个 <code>WebApplicationBuilder</code>，用于将配置、日志和其他服务添加到<strong>DI</strong>容器中。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册服务到容器中</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line">builder.Services.AddEndpointsApiExplorer();</span><br><span class="line">builder.Services.AddSwaggerGen();</span><br></pre></td></tr></table></figure><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>请求处理管道由一系列中间件组件组成。 每个组件在 <a href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/http-context?view=aspnetcore-6.0"><code>HttpContext</code></a> 上执行操作，调用管道中的下一个中间件或终止请求。</p><p>通过调用 <code>Use&#123;Feature&#125;</code> 扩展方法，向管道添加中间件组件。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册HTTP请求管道</span></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseSwagger();</span><br><span class="line">    app.UseSwaggerUI();</span><br><span class="line">&#125;</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure><h2 id="wwwroot"><a href="#wwwroot" class="headerlink" title="wwwroot"></a>wwwroot</h2><p>对于所有项目类型，这个文件夹包含了静态文件，如图片、样式表等。</p><h2 id="App-razor"><a href="#App-razor" class="headerlink" title="App.razor"></a>App.razor</h2><p>这是应用程序的根组件。它使用了内置的Router组件，并设置了客户端路由。正是这个Router组件拦截了浏览器的导航，并渲染出与请求地址匹配的页面。当找到匹配后，Router使用Found属性来显示内容。如果没有找到匹配的内容，NotFound属性用于显示消息–对不起，这个地址没有任何内容。</p><h2 id="页面文件夹"><a href="#页面文件夹" class="headerlink" title="页面文件夹"></a>页面文件夹</h2><p>这个文件夹包含_Host  Razor Pages和组成Brazor应用程序的可路由组件。这些组件的扩展名是**.razor**。</p><ul><li>索引组件 (Index.razor) - 当我们导航到根应用程序的URL时显示。</li><li>Counter组件 (Counter.razor) - 当我们导航到路径/counter时显示。</li><li>FetchData组件(FetchData.razor) - 当我们导航到路径/fetchdata时显示。</li><li>Error组件(Error.razor) - 当blazor应用程序中出现未处理的异常时，会被渲染。</li></ul><h2 id="共享文件夹"><a href="#共享文件夹" class="headerlink" title="共享文件夹"></a>共享文件夹</h2><p>当我们导航到/fetchdata的路径时显示。顾名思义，包含了共享的组件</p><h2 id="MainLayout组件-MainLayout-razor"><a href="#MainLayout组件-MainLayout-razor" class="headerlink" title="MainLayout组件 (MainLayout.razor)"></a>MainLayout组件 (MainLayout.razor)</h2><p>应用程序的主要布局组件</p><h2 id="NavMenu组件-NavMenu-razor"><a href="#NavMenu组件-NavMenu-razor" class="headerlink" title="NavMenu组件 (NavMenu.razor)"></a>NavMenu组件 (NavMenu.razor)</h2><p>实现了侧边栏上的导航菜单。NavLink组件，渲染导航链接到其他Razor组件，如索引、计数器和fetchdata组件。这个NavLink组件足够智能，如果导航菜单项当前显示的是它的组件，那么它可以高亮显示导航菜单项。</p><h2 id="Imports-razor"><a href="#Imports-razor" class="headerlink" title="_Imports.razor"></a>_Imports.razor</h2><p>这就像<strong>Asp.Net Core MVC</strong>项目中的**_ViewImports.cshtml**文件。这个文件包含了常用的命名空间，所以我们不需要在每一个razor组件中都包含它们。</p><h2 id="wwwroot-index-html"><a href="#wwwroot-index-html" class="headerlink" title="wwwroot/index.html"></a>wwwroot/index.html</h2><p>这是<strong>Blazor WebAssembly</strong>项目中的根页面，以<strong>html</strong>页面的形式实现。当第一个请求进入应用程序时，最初服务的就是这个页面。它有标准的HTML、HEAD和BODY标记。它指定了根应用程序组件<strong>App.razor</strong>应该被渲染到哪里。可以在根项目文件夹中找到这个App.razor根组件。它作为一个HTML元素<app>包含在页面中。我们将在接下来的视频中详细讨论razor组件。</p><p>这个<strong>index.html</strong>页面还加载了<strong>Blazor WebAssembly JavaScript</strong>文件（**_framework/blazor.webassembly.js**）。这个文件就是负责下载的文件。</p><ul><li>编译后的blazor应用程序，它的依赖关系和.NET运行时。</li><li>它还会初始化运行时，以便在浏览器中运行blazor应用程序。</li></ul><h2 id="Pages-Host-cshtml"><a href="#Pages-Host-cshtml" class="headerlink" title="Pages/_Host.cshtml"></a>Pages/_Host.cshtml</h2><p>这是应用程序的根页面，通过调用 MapFallbackToPage(“/_Host”) 方法指定。它的实现是<strong>Razor</strong>页面。</p><p>这个页面是在第一个请求到达应用程序时提供的。它具有标准的 HTML、HEAD 和 BODY 标签。它还指定了根应用程序组件 App 组件 (App.razor) 必须呈现的位置。最后，它还加载 blazor.server.js JavaScript 文件，该文件在服务器和客户端浏览器之间建立实时 SignalR 连接。此连接用于在客户端和服务器之间交换信息。SignalR 是一个很好的框架，用于向应用程序添加实时 Web 功能。 </p><h2 id="Data-folder-Blazor-Server"><a href="#Data-folder-Blazor-Server" class="headerlink" title="Data folder (Blazor Server)"></a>Data folder (Blazor Server)</h2><p>包含与示例 WeatherForecast 服务相关的代码文件</p><h2 id="appsettings-json-Blazor-Server"><a href="#appsettings-json-Blazor-Server" class="headerlink" title="appsettings.json (Blazor Server)"></a>appsettings.json (Blazor Server)</h2><p>就像 <strong>ASP.NET Core MVC</strong>项目一样，Blazor 项目也使用此文件来存储配置设置。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>Blazor Server 和 Blazor WebAssembly 只是我们托管 Blazor 应用程序的两种不同方式。</p><p>Blazor 应用程序中的所有内容都是 razor 组件。组件是 Blazor 应用程序的基本构建块。</p><p>对于 Blazor 服务器应用和 Blazor WebAssembly 应用，我们构建这些组件的方式是相同的。</p><p>因此，只有一个 Blazor 框架，而构建的方式，<strong>Blazor Server</strong>应用程序和 <strong>Blazor WebAssembly</strong> 应用程序非常相似。</p><p><strong>唯一的区别</strong>在于应用程序的<strong>托管方式</strong>。</p>]]></content>
    
    
    <summary type="html">Blazor系列翻译03-Blazor项目结构</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-02】- Blazor的托管模型</title>
    <link href="https://jonty.top/2023/03/23/blazor-hosting-models/"/>
    <id>https://jonty.top/2023/03/23/blazor-hosting-models/</id>
    <published>2023-03-23T01:50:13.000Z</published>
    <updated>2023-03-23T02:20:04.989Z</updated>
    
    <content type="html"><![CDATA[<p>你如果还没有安装开发环境，可以前往<a href="./what-is-blazor.md#Blazor%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">Blazor介绍</a>的下方有机器配置说明</p><p>我们将创建我们的第一个Blazor项目。</p><p>事实上，我们将创建2个Blazor项目。</p><ul><li>一个是服务器端托管:Blazor Server</li><li>另一个是客户端托管: Blazor WebAssembly</li></ul><p>然后，我们将运行这两个项目，看看它们在执行中的区别。</p><ul><li>了解这两种托管模式的区别以及各自的优缺点。</li></ul><h2 id="创建Blazor应用程序"><a href="#创建Blazor应用程序" class="headerlink" title="创建Blazor应用程序"></a>创建Blazor应用程序</h2><p><img data-src="https://cdn.jonty.top/img/image-20220411221907210.png" alt="image-20220411221907210"></p><h2 id="Bloazor托管模式"><a href="#Bloazor托管模式" class="headerlink" title="Bloazor托管模式"></a>Bloazor托管模式</h2><p>Blazor有两种托管模式：Blazor WebAssembly（客户端托管模式）和Blazor Server（服务器托管模式）。</p><p><img data-src="https://cdn.jonty.top/img/blazorhostingmodelsexplained.png"></p><p>正如模板名称所暗示的那样，使用Blazor Server App模板来创建一个带有服务器托管模式的Blazor应用程序，使用Blazor WebAssembly模板来创建一个带有客户端托管模式的Blazor应用程序。</p><p>Blazor服务器与Blazor WebAssembly的比较<br>2种项目类型的项目结构和布局没有太大的区别。</p><h2 id="blazor-server-vs-blazor-webassembly"><a href="#blazor-server-vs-blazor-webassembly" class="headerlink" title="blazor server vs blazor webassembly"></a>blazor server vs blazor webassembly</h2><p>我们将在下一个节中详细讨论这些不同文件和文件夹的目的。</p><p><img data-src="https://cdn.jonty.top/img/blazorservervsblazorwebassembly.png"></p><h2 id="在-Visual-Studio-中配置多个启动项目"><a href="#在-Visual-Studio-中配置多个启动项目" class="headerlink" title="在 Visual Studio 中配置多个启动项目"></a>在 Visual Studio 中配置多个启动项目</h2><p>我们可以在Visual Studio中配置多个项目作为<strong>StartUp项目</strong>。</p><p>具体步骤如下:</p><p>在解决方案资源管理器中右键点击解决方案名称，选择设置<strong>StartUp项目</strong>选项</p><p><img data-src="https://cdn.jonty.top/img/image-20220411222732534.png" alt="image-20220411222732534"></p><p>选择 <strong>多个启动项目</strong>单选按钮。针对每个要设置为启动项目的项目，从 <strong>操作</strong>下拉列表中选择 <strong>启动</strong>。</p><p><img data-src="https://cdn.jonty.top/img/image-20220411222844570.png" alt="image-20220411222844570"></p><h2 id="Blazor-WebAssembly托管模式"><a href="#Blazor-WebAssembly托管模式" class="headerlink" title="Blazor WebAssembly托管模式"></a>Blazor WebAssembly托管模式</h2><p>在这种托管模式下，应用程序直接在浏览器中的WebAssembly上。</p><p>因此，应用程序所需要的一切，即编译后的应用程序，它的依赖关系和.NET运行时都会从服务器下载到客户端浏览器，这一点和Angular、Vue、React等开发模式是一致的。<br>Blazor WebAssembly应用程序可以完全在客户端上运行，而不需要连接到服务器，或者可以使用Web API调用或SignalR来配置它与服务器进行交互。</p><p><img data-src="https://cdn.jonty.top/img/BlazorWebAssemblyhostingmodel.png" alt="Blazor WebAssembly 托管模型"></p><p><img data-src="https://cdn.jonty.top/img/image-20220411223744216.png" alt="image-20220411223744216"></p><h3 id="Blazor-WebAssembly托管模式的好处。"><a href="#Blazor-WebAssembly托管模式的好处。" class="headerlink" title="Blazor WebAssembly托管模式的好处。"></a>Blazor WebAssembly托管模式的好处。</h3><ul><li>一个Blazor WebAssembly应用程序可以完全在客户端机器上运行。它可以离线工作。当失去了与服务器的网络连接时，客户端应用程序可以继续运行</li></ul><ul><li><p>它也可以很容易地作为一个渐进式的Web App运行，这意味着客户可以选择将我们的App安装到他们的设备上，在没有任何网络连接的情况下随时运行。</p></li><li><p>Web Assembly在客户端上运行，在浏览器内部，因此可以作为静态文件部署。尽管如此，由于浏览器的安全限制，Blazor Wasm应用程序不会直接从本地文件系统中运行。</p></li></ul><ul><li>当应用程序从服务器下载到客户端后，平时的计算工作使用的是客户端的资源和能力。在客户机上运行的代码，意味着服务器的负载大大降低。</li></ul><ul><li>我们不需要一个完整的ASP.NET Core web服务器来托管应用程序。我们只需要一台服务器，便可以将应用程序传送到客户端的浏览器上。这意味着我们可以在互联网上的任何地方，在云端，在Azure上作为静态网站，甚至在CDN内容交付网络上，将应用程序托管在自己的服务器上。</li></ul><h3 id="Blazor-WebAssembly托管的缺点"><a href="#Blazor-WebAssembly托管的缺点" class="headerlink" title="Blazor WebAssembly托管的缺点"></a>Blazor WebAssembly托管的缺点</h3><p>Blazor WebAssembly简称为Blazor Wasm。</p><ul><li><p>第一次请求通常需要较长的时间，因为<code>blazor.webassembly.js</code>文件对客户端应用程序进行引导,所以整个应用程序、其依赖关系和.NET运行时必须下载到客户端浏览器。但请记住，这只是第一次请求所花费的时间比平时长。如果那个相同的客户端稍后访问该应用程序，通常会快速启动，因为浏览器会缓存文件。</p></li><li><p>由于应用程序完全在客户端浏览器上运行，所以它受限于浏览器的计算能力。</p></li><li><p>根据应用的性质，需要有一定能力的客户端硬件和软件。例如，从软件的角度来看，至少需要一个支持WebAssembly的浏览器。</p></li></ul><ul><li><p>Mono框架解释的是.NET中间语言，因此比运行服务器端Blazor要慢。Ahead-of-time (AOT) 编译计划在未来的一个版本中进行。</p></li><li><p>Blazor Wasm还不支持一个以上的线程，所以所有的处理都发生在UI线程上–但服务器/JavaScript等的调用是异步进行的，所以不会阻碍UI的响应速度。</p></li><li><p>与服务器端不同的是，Blazor Wasm还不支持在Visual Studio中进行调试。在浏览器内调试C#代码是可能的，但尽管可行，但这并不是最好的体验。</p></li><li><p>此外，Blazor Wasm只适用于较新的浏览器，并且不支持搜索引擎（除非我们启用服务器端预渲染）。</p></li></ul><h2 id="Blazor-Server服务器托管模式"><a href="#Blazor-Server服务器托管模式" class="headerlink" title="Blazor Server服务器托管模式"></a>Blazor Server服务器托管模式</h2><p>在这种托管模式下，应用程序需要在服务器上执行。在客户端和服务器之间建立了一个SignalR连接。当一个事件发生在客户端，例如点击按钮，事件的信息通过SignalR连接发送到服务器。服务器处理该事件，并计算出生成的HTML的差异（差值）。整个HTML不会再次被发送到客户端，只有差值通过SignalR连接发送到客户端。然后浏览器更新UI。由于只应用了差异化的内容来更新UI，所以应用程序感觉更快，对用户的响应也更快。</p><p><img data-src="https://cdn.jonty.top/img/BlazorServerhostingmodel.png" alt="Blazor 服务器托管模型"></p><p><img data-src="https://cdn.jonty.top/img/image-20220411223908163.png" alt="image-20220411223908163"></p><h3 id="Blazor服务器托管模式的好处"><a href="#Blazor服务器托管模式的好处" class="headerlink" title="Blazor服务器托管模式的好处"></a>Blazor服务器托管模式的好处</h3><ul><li><p>Blazor服务器端在将HTML内容发送到客户端的浏览器之前，会预先渲染HTML内容。这使得它对搜索引擎友好，而且没有明显的启动时间。</p></li><li><p>由于下载量明显小于Blazor WebAssembly应用程序，因此加载速度更快</p></li><li><p>由于该应用程序运行在服务器上，因此它可以充分利用服务器的功能，包括使用任何.NET Core兼容的API。<br>客户端只需要一个浏览器就可以使用该应用。即使是不支持WebAssembly的浏览器也可以使用。</p></li><li><p>更加安全，因为应用程序的.NET/C#代码不会被发送到客户端。</p></li></ul><ul><li>Blazor服务器端应用程序可以在旧的浏览器上运行，因为不需要Web汇编，只需要HTML和JavaScript。由于代码是在服务器上执行的，所以也可以在Visual Studio中调试我们的.NET代码。</li></ul><h3 id="Blazor服务器托管-NET的缺点。"><a href="#Blazor服务器托管-NET的缺点。" class="headerlink" title="Blazor服务器托管.NET的缺点。"></a>Blazor服务器托管.NET的缺点。</h3><ul><li>需要一个完整的ASP.NET Core服务器来托管应用程序。在无服务器部署场景，比如希望从CDN中运行应用程序，是不可能实现的。</li><li>需要始终保持与服务器的主动连接。这意味着需要保持服务器24小时不间断地运行。如果服务器瘫痪，应用程序就会停止工作。</li><li>由于每个用户的交互都需要往返于服务器之间，与Blazor WebAssembly托管相比，通常会有较高的延迟。</li></ul><ul><li>Blazor服务器端为当前客户端建立一个内存内会话，并使用SignalR在服务器上运行的.NET和客户端的浏览器之间进行通信。所有的内存和CPU的使用都是以服务器为代价的，对所有用户来说。这也意味着客户端被绑定到最初服务于它的服务器上，所以不具备负载均衡功能，但是我们可以通过使用Azure SignalR服务与Blazor服务器应用程序来克服这个可扩展性问题。这个服务可以让Blazor Server app通过支持大量的并发SignalR连接来实现良好的扩展性。</li></ul>]]></content>
    
    
    <summary type="html">Blazor系列翻译02-Blazor的托管模型</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>AQL抽样方法介绍</title>
    <link href="https://jonty.top/2023/02/17/acceptance-quality-limit/"/>
    <id>https://jonty.top/2023/02/17/acceptance-quality-limit/</id>
    <published>2023-02-17T08:03:55.000Z</published>
    <updated>2023-03-23T01:56:11.471Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="https://cdn.jonty.top/img/AQL-rev-8.jpg" alt="AQL-rev-8"></p><h2 id="AQL的定义"><a href="#AQL的定义" class="headerlink" title="AQL的定义"></a>AQL的定义</h2><p>AQL原来叫<strong>合格质量水平（Acceptable Quality Level）</strong>，在新版国家标准《GB/T 2828.1-2003 计数抽样检验程序 第1部分：按接收质量限（AQL）检索的逐批检验抽样计划》中，AQL的全称被改为了<strong>接收质量限制（Acceptance Quality Limit）</strong>，其定义为：当一个连续系列批被提交验收抽样时，可允许的最差过程平均质量水平。</p><h2 id="检验水平"><a href="#检验水平" class="headerlink" title="检验水平"></a>检验水平</h2><p>在AQL中，有三种一般检验水平（Ⅰ、Ⅱ、Ⅲ）和四种特殊检验水平（S-1、S-2、S-3、S-4）。<br>在三种一般检验水平中，LEVELⅡ是常规水平，也是最经常采用的水平。从LEVELⅠ到LEVELⅢ抽样的数量逐渐增加。LEVELⅠ的抽样数是LEVELⅡ的40％，适用于品质较为稳定或产品出现不一致可能性极小的状况。LEVELⅢ的抽样数是LEVELⅡ的160％，加大检验的样本数量可以降低接受不合格产品的可能性。<br>四种特殊检验水平的特点是抽样数量少，因为在某些情况下，例如检验的成本高、检验所花费的时间长、货物的品质比较稳定（单一产品的重复加工），通过少量的抽样检验就可以反应总体的品质水平。从S-1到S-4抽样检验数逐步增加。在服装辅料的检验中有时会采用特殊检验水平，例如拉链、纽扣等的检验。</p><h2 id="抽样方案"><a href="#抽样方案" class="headerlink" title="抽样方案"></a>抽样方案</h2><p>AQL有一次、二次、多次（五次）3种抽样方案。确定抽样方案可以从下面几个方面来考虑：<br>1）简便易行：一次优于二次，二次优于五次。<br>2）平均样本量：五次少于二次，二次少于一次。<br>3）管理难度：五次难于二次，二次难于一次。<br>4）取样的难易程度：取样麻烦时，一次优于二次，二次优于五次。<br>5）试验时间的长短：根据单个试验时间的长短和是否可以多个样品同时进行试验来确定总的试验时间。</p><h2 id="严格程度"><a href="#严格程度" class="headerlink" title="严格程度"></a>严格程度</h2><p>AQL中制定了三种严格程度：正常（NORMAL）、加严（TIGHTENED）、放宽（REDUCED）。<br>正常检验是最常用的检验水平，刚开始检验新的供应商生产的货物时，应采用正常检验。<br>一旦采用了正常、严格、放宽中的任何一种，那么在以后对同系列或同类型产品的检验中都应采取这一标准，除非供应商的产品品质发生了变动。</p><h3 id="AQL值"><a href="#AQL值" class="headerlink" title="AQL值"></a>AQL值</h3><p>对于不同的质量水平或要求，AQL有多种规定的数值，从0.010~1000。服装业最常用的AQL值是2.5，要求高一些的用1.5，要求稍低的用4.0。不同的AQL值体现了不同的质量水平，通常AQL值越小代表品质要求越高。</p><h2 id="转移规则和程序"><a href="#转移规则和程序" class="headerlink" title="转移规则和程序"></a>转移规则和程序</h2><h3 id="正常到加严"><a href="#正常到加严" class="headerlink" title="正常到加严"></a>正常到加严</h3><p>当正在采用正常检验时，只要初次检验中连续5批或少于5批中有2批是不可接收的，则转移到加严检验。<br>（注：初次检验指第一次检验，区别于拒收后的再次提交批的检验。再次提交批的检验结果不参与转移。）</p><h3 id="加严到正常"><a href="#加严到正常" class="headerlink" title="加严到正常"></a>加严到正常</h3><p>当正在采用加严检验时，如果初次检验的接连5批已被认为是可接收的，应恢复正常检验。</p><h3 id="正常到放宽"><a href="#正常到放宽" class="headerlink" title="正常到放宽"></a>正常到放宽</h3><p>当正在采用正常检验时，如果连续10次检验都合格、并且生产处于稳定状态的话，可以转移到放宽检验。<br>（注：这个跟GB/T 2828.1-2003的规定不同，因为GB/T 2828.1-2003的条件比较负责，所以可以考虑采用这个比较简单的方法。）</p><h3 id="放宽到正常"><a href="#放宽到正常" class="headerlink" title="放宽到正常"></a>放宽到正常</h3><p>当正在执行放宽检验时，如果初次检验出现下列任一情况，应恢复正常检验：<br>a）一个批未被接收；<br>b）生产不稳定或延迟；<br>c）认为恢复正常检验是正当的其他情况。</p><h3 id="暂停检验"><a href="#暂停检验" class="headerlink" title="暂停检验"></a>暂停检验</h3><p>如果在初次加严检验的一系列连续批中未接受批的累计数达到5批，应暂时停止检验。直到供应商为改进所提供产品或服务的质量已采取行动，而且负责部门承认此行动可能有效时，才能恢复检验。恢复检验应从使用加严检验开始。</p><p>放宽检验是非强制性的，在条件不成熟或无把握的情况下可以不执行。<br>暂停检验也可以不执行。<br>至少要执行正常和加严检验之间的转移规则。</p><h3 id="二次抽样方案"><a href="#二次抽样方案" class="headerlink" title="二次抽样方案"></a>二次抽样方案</h3><p>第一次检验的样品数量应等于该方案给出的第一样本量。如果第一样本中发现的不合格数小于或等于第一接收数，则该批可接收；如果第一样本中发现的不合格品数大于或等于第一拒收数，则该批不可接收。<br>如果第一样本中发现的不合格品数介于第一接收数与第二拒收数之间，应检验由方案给出样本量的第二样本并累计在第一样本和第二样本中发现的不合格品数。如果不合格品累计数小于或等于第二接收数，则判定批可接收；如果不合格品累计数大于或等于第二拒收数，则判定该批不可接收。<br>二次抽样方案的目的是通过检验较少样品数而节约时间，然而当必须进行第二次检验时，抽样检验的总数要超过一次抽样检验的数量，所以二次抽样方案适合于质量比较稳定的产品。</p><h3 id="不合格产品的判定"><a href="#不合格产品的判定" class="headerlink" title="不合格产品的判定"></a>不合格产品的判定</h3><p>根据不同类型的服装可参考相应的行业标准或企业标准，如T恤和Polo衫可参考纺织行业标准《FZ/T 73008-2002 针织T恤衫》。<br>有的公司以一件衣服上有一个或以上严重疵点为一个不合格品，一件衣服上有3个轻微疵点也算一件不合格品。<br>有的公司采用的是记点的方式，即计算样本中的不合格数来判定。</p><p>当样本数超过批量时，应该以整批作为样本（全检），判定数不变。</p><h3 id="AQL抽样检验的方法和步骤"><a href="#AQL抽样检验的方法和步骤" class="headerlink" title="AQL抽样检验的方法和步骤"></a>AQL抽样检验的方法和步骤</h3><p>1、决定检验方案（检验水平、抽样方案、严格程度和AQL值）。检验方案一般由客户决定，也有客户和供应商协商决定的。<br>2、根据检验方案查找样本量字码。<br>3、抽样方案。在AQL中给出了一系列的抽样方案表格，这些表格给出了在不同的品质水平下抽样检验的样本数和接收数（Ac）、拒收数（Re）。<br>4、产品检验。从所要检验的产品中，按照以上所述的样本数，随机抽取样品。在检验中应保证100％地检验所抽取的样本，既使在检验若干件后，发现不合格数已经超过拒收数，仍然应该继续检验剩余的样本，因为检验的目的除了要知道“接受”或“拒收”的结果外，还需要了解货物究竟处于何种质量水平，并且可以通过积累历史数据来判断供应商是否合格和决定以后对供应商的检验方案。对供应商来说，也可以清楚如何去改善产品的品质。<br>5、统计不合格数。<br>6、判定是否接受。对照抽样方案表格中的接收数和拒收数来决定是“接受”还是“拒收”。</p><p>例一：<br>检验方案为一般检验水平Ⅱ、正常检验一次抽样方案、AQL 2.5。<br>如有一批衣服的数量为5000件，则找到对应的“样本量字码”为“L”。<br>在“正常检验一次抽样方案（主表）”中找到样本量字码L，对应的样本量为“200”，表示要抽查200件衣服；AQL 2.5对应的“接收/拒收数”为“10 11”，表示抽查的200件样本中，如果发现的不合格品小于或等于10件的话，则该批产品可接受；如果不合格品等于或大于11的话，则该批产品不可接受。</p><p>例二：<br>检验方案为一般检验水平Ⅱ、正常检验二次抽样方案、AQL 4.0。<br>如有一批衣服的数量为20000件，则找到对应的样本量字码为“M”。<br>从“正常检验二次抽样方案（主表）”中查找到对应的样本量和接收/拒收数。<br>第一次抽样200件，接收/拒收数为“11 16”，不合格品数小于或等于11则接受，不合格品数等于或大于16则拒收，不合格品数为12~15之间则进行第二次抽查；<br>第二次再抽查200件，接收/拒收数为“26 27”，累计不合格品数（加上第一次抽查发现的不合格品数）小于或等于26则接受，累计不合格品数等于或大于27则拒收。</p>]]></content>
    
    
    <summary type="html">AQL-接收质量限制（Acceptance Quality Limit）</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="AQL" scheme="https://jonty.top/tags/AQL/"/>
    
  </entry>
  
  <entry>
    <title>【Blazor-01】-什么是Blazor?</title>
    <link href="https://jonty.top/2023/02/15/what-is-blazor/"/>
    <id>https://jonty.top/2023/02/15/what-is-blazor/</id>
    <published>2023-02-14T23:59:05.000Z</published>
    <updated>2023-03-23T02:20:23.171Z</updated>
    
    <content type="html"><![CDATA[<h2 id="现如今如何开发Web应用程序"><a href="#现如今如何开发Web应用程序" class="headerlink" title="现如今如何开发Web应用程序"></a>现如今如何开发Web应用程序</h2><p><img data-src="https://cdn.jonty.top/img/whatisblazor.png" alt="img"></p><ul><li>对于服务端开发，我们使用C#、Java、PHP等编程语言，这些都是服务端编程语言。</li><li>对于客户端开发，使用 Angular、React、Vue 等<strong>JavaScript</strong>框架，这些JavaScript框架也是最近几年开始主导客户端开发。</li></ul><p>作为开发人员，为了在业务中持续保持竞争力，我们不可避免的要同时学习服务端编程语言和客户端编程语言。但问题是，我们为什么要学习和使用两套不同的编程语言和框架呢？</p><h2 id="使用C-同时进行服务端和客户端开发"><a href="#使用C-同时进行服务端和客户端开发" class="headerlink" title="使用C#同时进行服务端和客户端开发"></a>使用C#同时进行服务端和客户端开发</h2><p><img data-src="https://cdn.jonty.top/img/whyshouldweuseblazor.png" alt="我们为什么要使用 blazor"></p><p>可以使用C#同时进行服务端和客户端开发吗？答案是可以的，借助<strong>Blazor</strong>,我们可以使用C#而不是JavaScript构建交互式的Web UI。C#代码可以在服务器和客户端浏览器上执行。这意味着.Net开发人员可以重用他们的C#技能，而不是学习新的JavaScript框架而带来的巨大的学习成本。</p><h2 id="浏览器如何执行C-代码"><a href="#浏览器如何执行C-代码" class="headerlink" title="浏览器如何执行C#代码"></a>浏览器如何执行C#代码</h2><p>众所周知，浏览器只能执行JavaScript代码。那么如何在客户端浏览器执行C#代码？答案是<strong>WebAssembly</strong></p><p><img data-src="https://cdn.jonty.top/img/blazorandwebassembly.png" alt="blazor 和 webassembly"></p><p>Blazor 可以使用 WebAssembly 在浏览器中直接运行 C# 代码。它与 Angular、React、Vue 等 JavaScript 框架在同一个安全沙箱中运行。</p><p>事实上，不仅仅是 C#，我们可以使用 WebAssembly 在浏览器中运行任何类型的代码。</p><p>WebAssembly 基于开放的 Web 标准。所以它是所有现代浏览器的原生部分，包括移动浏览器。这意味着要是Blazor应用程序正常工作，不需要安装任何插件。</p><h2 id="Blazor托管模型"><a href="#Blazor托管模型" class="headerlink" title="Blazor托管模型"></a>Blazor托管模型</h2><p>Blazor 提供 2 种托管模型。</p><ul><li> Blazor WebAssembly</li><li> Blazor Server</li></ul><p><img data-src="https://cdn.jonty.top/img/image-20220411220906408.png" alt="image-20220411220906408"></p><h3 id="Blazor-WebAssembly"><a href="#Blazor-WebAssembly" class="headerlink" title="Blazor WebAssembly"></a>Blazor WebAssembly</h3><p>客户端托管模型：应用程序直接在 WebAssembly 的浏览器中运行。</p><p>因此，应用程序所需的一切，即编译后的应用程序代码本身、它的依赖项和 .NET 运行时都下载到浏览器。</p><blockquote><p> 使用 <code>Blazor WebAssembly App </code>模板来创建具有客户端托管模型的 Blazor 应用程序。</p></blockquote><h3 id="Blazor-server"><a href="#Blazor-server" class="headerlink" title="Blazor server"></a>Blazor server</h3><p>服务器托管模型：应用程序在 ASP.NET Core 应用程序内的服务器上执行。</p><p>在客户端和服务器之间，建立了 <strong>SignalR</strong> 连接。</p><p>例如，当客户端上发生事件（例如单击按钮）时，有关事件的信息将通过 SignalR 连接发送到服务器。服务器处理事件并为生成的 HTML 计算差异。整个 HTML 不会再次发送回客户端，它只是通过已建立的 SignalR 连接发送给客户端的差异。然后浏览器更新 UI。Blazor 采用单页面应用程序体系结构。</p><blockquote><p>使用 Blazor Server应用程序模板来创建具有服务器托管模型的 Blazor 应用程序</p></blockquote><h2 id="Blazor开发环境"><a href="#Blazor开发环境" class="headerlink" title="Blazor开发环境"></a>Blazor开发环境</h2><p><a href="https://dotnet.microsoft.com/en-us/download/dotnet/6.0">安装.NET6或更高版本</a></p><p>验证本地安装的.NET SDK</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet --list-sdks</span><br></pre></td></tr></table></figure><p>可以使用Visual Studio、Visual Studio Code 或 .NET Core CLI 构建 Blazor 应用程序。 </p><p><a href="https://visualstudio.microsoft.com/zh-hans/?rr=https://www.microsoft.com/zh-cn">下载Visual Studio</a></p><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p><img data-src="https://cdn.jonty.top/img/image-20220411220940383.png" alt="image-20220411220940383"></p>]]></content>
    
    
    <summary type="html">Blazor系列翻译01-什么是Blazor?</summary>
    
    
    
    <category term="搬砖那些事儿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
</feed>
